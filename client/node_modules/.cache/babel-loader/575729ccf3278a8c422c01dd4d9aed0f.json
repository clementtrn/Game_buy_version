{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\hugod\\\\decitude\\\\client\\\\src\\\\routes\\\\InterInterface.js\",\n    _s = $RefreshSig$();\n\nimport \"../styles/App.css\";\nimport React, { useState, useEffect, useRef } from 'react';\nimport PlayAPI from \"../API/PlayAPI\";\nimport InterBandeauTop from \"../components/interfaceJoueur/InterBandeauTop\";\nimport InterBandeauBottom from \"../components/interfaceJoueur/InterBandeauBottom\";\nimport Grille from \"../components/interfaceJoueur/Grille\";\nimport InterInterventions from \"../components/interfaceJoueur/InterInterventions\";\nimport { useHistory } from 'react-router-dom';\nimport cookie from 'react-cookies';\nimport InterBandeauDroite from \"../components/interfaceJoueur/InterBandeauDroite\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst InterInterface = () => {\n  _s();\n\n  const history = useHistory();\n  const user = cookie.load(\"user\"); // console.log(user)\n\n  if (user == null || user == undefined) history.push(\"/login\");\n  const [numPompier, setNumPompier] = useState(0);\n  const [currentPomp, setCurrentPomp] = useState(null);\n  const [currentTour, setCurrentTour] = useState(null);\n  const [currentCycle, setCurrentCycle] = useState(null);\n  const [currentSequence, setCurrentSequence] = useState(null);\n  const [session, setSession] = useState(user !== null ? user.session : null);\n  const [equipe, setEquipe] = useState(user !== null ? user.equipe : null);\n  const [configuration, setConfiguration] = useState(null);\n  const [couts, setCouts] = useState(null);\n  const [resultats, setResultats] = useState({\n    Decedes: 0,\n    Sauves: 0,\n    Marqueur: 0\n  });\n  const [budget, setBudget] = useState({\n    sequence: 0,\n    depense: 0\n  });\n  const [cycles, setCycles] = useState(null);\n  useEffect(() => {\n    if (configuration != null) {\n      setCouts({\n        interventions: {\n          coutInterDeplacement: configuration.coutInterDeplacement.valeur,\n          coutInterFeu: configuration.coutInterFeu.valeur,\n          coutInterFeuFum: configuration.coutInterFeuFum.valeur,\n          coutInterFum: configuration.coutInterFum.valeur,\n          coutInterMarqueur: configuration.coutInterMarqueur.valeur,\n          coutInterPorte: configuration.coutInterPorte.valeur,\n          coutInterHab: configuration.coutInterHabitant.valeur\n        },\n        equipements: {\n          coutEqFeu: configuration.coutEqFeu.valeur,\n          coutEqFeuFum: configuration.coutEqFeuFum.valeur,\n          coutEqFum: configuration.coutEqFum.valeur,\n          coutEqMarqueur: configuration.coutEqMarqueur.valeur\n        }\n      });\n      setBudget({\n        sequence: configuration.budgetDefaultInter.valeur,\n        depense: 0\n      });\n\n      if (cycles != null) {\n        initInfos(cycles);\n      }\n    }\n  }, [configuration]);\n  const [budgetSim, setBudgetSim] = useState({});\n\n  const saveBudgets = async cycles => {\n    checkNouveauTour();\n    const response = await PlayAPI.saveBudgetsPompInit(cycles, session, equipe);\n    console.log(\"save budgets\");\n    console.log(cycles);\n  };\n\n  useEffect(() => {\n    if (cycles != null) {\n      saveBudgets(cycles);\n    } // console.log(\"last cycle\",{\n    //   numSeq:cycles.interventions.length>1 ? cycles.interventions.length%2 == 0  ? cycles.interventions[cycles.interventions.length -1].numSeq +1 : cycles.interventions[cycles.interventions.length -1].numSeq : 1 ,\n    //   numCycle: (cycles.interventions.length)%2+1})\n\n\n    if (cycles != null) {\n      if (configuration != null) {\n        initInfos(cycles);\n      }\n\n      setBudgetSim({\n        interventions: {\n          numSeq: cycles.interventions.length > 1 ? cycles.interventions.length % 2 == 0 ? cycles.interventions[cycles.interventions.length - 1].numSeq + 1 : cycles.interventions[cycles.interventions.length - 1].numSeq : 1,\n          numCycle: cycles.interventions.length % 2 + 1,\n          pomp1: 0,\n          pomp2: 0,\n          pomp3: 0,\n          pomp4: 0,\n          pomp5: 0,\n          pomp6: 0\n        },\n        equipements: {\n          numSeq: cycles.equipements.length > 1 ? cycles.equipements.length % 2 == 0 ? cycles.equipements[cycles.equipements.length - 1].numSeq + 1 : cycles.equipements[cycles.equipements.length - 1].numSeq : 1,\n          numCycle: cycles.equipements.length % 2 + 1,\n          Feu: {\n            pomp1: 0,\n            pomp2: 0,\n            pomp3: 0,\n            pomp4: 0,\n            pomp5: 0,\n            pomp6: 0\n          },\n          FeuFum: {\n            pomp1: 0,\n            pomp2: 0,\n            pomp3: 0,\n            pomp4: 0,\n            pomp5: 0,\n            pomp6: 0\n          },\n          Fum: {\n            pomp1: 0,\n            pomp2: 0,\n            pomp3: 0,\n            pomp4: 0,\n            pomp5: 0,\n            pomp6: 0\n          },\n          Marqueur: {\n            pomp1: 0,\n            pomp2: 0,\n            pomp3: 0,\n            pomp4: 0,\n            pomp5: 0,\n            pomp6: 0\n          }\n        }\n      });\n    } // console.log(cycles.equipements)\n\n  }, [cycles]);\n  const [validated, setValidated] = useState({\n    interventions: false,\n    equipements: false\n  });\n  const [page, setPage] = useState({\n    interventions: 0,\n    equipements: 0\n  });\n  const isLoading = useRef(false); // INITIALISATION DE LA CARTE\n\n  const [carte, setCarte] = useState([[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]); // const [carte, setCarte] = useState([])\n\n  const [nbLignesGrille, setNbLignesGrille] = useState(0);\n  const [nbColonnesGrille, setNbColonnesGrille] = useState(0);\n  const [position, setPosition] = useState(null);\n  const [mursH, setMursH] = useState([[1, 1, 1, 1, 1, 1, 2, 6, 1, 1, 1, 1, 2, 5, 1, 1], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [1, 1, 1, 1, 2, 6, 1, 6, 2, 1, 1, 1, 5, 2, 1, 1], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [1, 1, 1, 1, 1, 1, 6, 2, 1, 1, 1, 1, 1, 1, 1, 1]]);\n  const [mursV, setMursV] = useState([[1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1], [2, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1], [5, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1], [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1], [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 2, 0, 0, 0, 0, 0, 1], [1, 0, 0, 0, 0, 0, 2, 0, 0, 0, 5, 0, 0, 0, 0, 0, 1], [1, 0, 0, 0, 0, 0, 5, 0, 0, 0, 5, 0, 0, 0, 0, 0, 2], [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 2, 0, 0, 0, 0, 0, 5]]);\n\n  const getNombreMarqueur = (mursH, mursV) => {\n    let nbMarqueur = 0;\n    mursH.forEach(ligne => {\n      ligne.forEach(valeur => {\n        if (valeur == 3) nbMarqueur = nbMarqueur + 1;\n        if (valeur == 4) nbMarqueur = nbMarqueur + 2;\n      });\n    });\n    mursV.forEach(ligne => {\n      ligne.forEach(valeur => {\n        if (valeur == 3) nbMarqueur = nbMarqueur + 1;\n        if (valeur == 4) nbMarqueur = nbMarqueur + 2;\n      });\n    });\n    return nbMarqueur;\n  }; // GET PLAY PARAMETERS \n\n\n  const initInfos = cycles => {\n    if (cycles !== null && configuration !== null) {\n      const lastCycleEq = [...cycles.equipements].sort((a, b) => (a.numSeq - b.numSeq) * 100 + a.numCycle - b.numCycle)[[...cycles.equipements].length - 1];\n      const lastCycleInter = [...cycles.interventions].sort((a, b) => (a.numSeq - b.numSeq) * 100 + a.numCycle - b.numCycle)[[...cycles.interventions].length - 1];\n      var val = {\n        interventions: false,\n        equipements: false\n      };\n      if (lastCycleInter !== null && lastCycleInter !== undefined && lastCycleInter.numSeq == currentSequence && lastCycleInter.numCycle == currentCycle) val.interventions = true;\n      if (lastCycleEq !== null && lastCycleEq !== undefined && lastCycleEq.numSeq == currentSequence && lastCycleEq.numCycle == currentCycle) val.equipements = true;\n      setValidated(val);\n      var b = {\n        sequence: configuration.budgetDefaultInter.valeur,\n        depense: 0\n      };\n      console.log(configuration);\n      cycles.equipements.forEach(c => {\n        if (c.numSeq == currentSequence) {\n          Object.keys(c).forEach(key => {\n            Object.values(c[key]).forEach(v => {\n              console.log(configuration[\"coutEq\" + key].valeur * v);\n              b.depense += configuration[\"coutEq\" + key].valeur * v;\n            });\n          });\n        }\n      });\n      console.log(b);\n    }\n  };\n\n  const getPlayState = async (session, equipe) => {\n    if (!isLoading.current) {\n      isLoading.current = true;\n      const currentPlayState = await PlayAPI.getPlayState(session, equipe); // console.log(\"get play state\")\n\n      if (Object.keys(currentPlayState).length > 0) {\n        // console.log(currentPlayState)\n        setCurrentPomp(parseInt(JSON.parse(currentPlayState.currentPomp.valeur)));\n        setCurrentTour(parseInt(JSON.parse(currentPlayState.currentTour.valeur)));\n        setCurrentCycle(parseInt(JSON.parse(currentPlayState.currentCycle.valeur)));\n        setCurrentSequence(parseInt(JSON.parse(currentPlayState.currentSequence.valeur)));\n        const mursH = JSON.parse(currentPlayState.mursH.valeur);\n        const mursV = JSON.parse(currentPlayState.mursV.valeur);\n        setMursH(mursH);\n        setMursV(mursV);\n        setCarte(JSON.parse(currentPlayState.carte.valeur));\n        setResultats({\n          Decedes: parseInt(JSON.parse(currentPlayState.resultatsDecedes.valeur)),\n          Sauves: parseInt(JSON.parse(currentPlayState.resultatsSauves.valeur)),\n          Marqueur: getNombreMarqueur(mursH, mursV)\n        });\n        setCycles(JSON.parse(currentPlayState.budgetsPompInit.valeur));\n      } // getPositionFromCarte(JSON.parse(currentPlayState.carte.valeur))\n\n\n      isLoading.current = false;\n    }\n  }; // useEffect(()=>{\n  //   console.log(currentPomp)\n  // },[currentPomp])\n\n\n  useEffect(() => {\n    // console.log(carte)\n    if (carte.length > 0) {\n      setNbLignesGrille(carte.length);\n      setNbColonnesGrille(carte[0].length);\n      setPosition([carte.length + 1, carte[0].length + 1]);\n    }\n  }, [carte]);\n  useEffect(() => {\n    if (session != null && equipe != null && currentTour == null) {\n      if (!isLoading.current) getPlayState(session, equipe);\n      getPlayParameters(); // getPositionFromCarte()\n    }\n  }, [session, equipe, numPompier]);\n\n  const getPlayParameters = async () => {\n    const param = await PlayAPI.getConfiguration(session);\n    setConfiguration(param); // console.log(param)\n  };\n\n  const getBudgetTot = cycle => {\n    let sum = 0;\n\n    if (vue == \"interventions\") {\n      Object.keys(cycle).forEach(key => {\n        if (key != \"numCycle\" && key != \"numSeq\") {\n          sum += cycle[key];\n        }\n      });\n    } else {\n      Object.keys(cycle).forEach(key => {\n        if (key != \"numCycle\" && key != \"numSeq\") {\n          Object.values(cycle[key]).forEach(value => {\n            // console.log(couts.equipements[\"coutEq\"+key],\"coutEq\"+key,couts)\n            sum += value * couts.equipements[\"coutEq\" + key];\n          });\n        }\n      });\n    }\n\n    return sum;\n  };\n\n  const handleBudgetChange = (type, newBudget) => {\n    var bSim = { ...budgetSim\n    };\n    bSim[type] = newBudget;\n    setBudgetSim(bSim); // console.log(bSim)\n  };\n\n  const handleClicValidated = type => {\n    var v = { ...validated\n    };\n    validated[type] = true;\n    setValidated(validated);\n    var p = { ...page\n    };\n    if (type == \"interventions\") p[type] += 1;\n    if (type == \"equipements\") p[type] += 1;\n    setPage(p);\n    var c = { ...cycles\n    };\n    c[type].push(budgetSim[type]);\n    setCycles(c); // console.log(c[type])\n\n    var b = { ...budget\n    };\n    b.depense += getBudgetTot(budgetSim[type]);\n    setBudget(b);\n  };\n\n  const nouveauTour = async () => {\n    console.log(\"nouveau tour\");\n\n    if (configuration != null) {\n      // if(bool){\n      let prochainPomp = 1;\n      let prochainTour = currentTour;\n      let prochainCycle = currentCycle;\n      let prochaineSequence = currentSequence; // if(numPompier==configuration.nbPompEquipe.valeur){ // DERNIER POMP DU TOUR\n      //   if(currentTour==configu  ration.nbToursParCycle.valeur){ // SEND TO INTER\n      //     prochainTour = 1\n      //     prochainPomp=0 // A CHANGER AVEC STRATEGIQUE\n      //     if(prochainCycle==configuration.nbCyclesParSequence.valeur){\n      //       prochainCycle=1\n      //       prochaineSequence=prochaineSequence+1\n      //     }else{\n      //       prochainCycle=prochainCycle+1\n      //     }\n      //   }else{ // PAS DERNIER TOUR DU CYCLE\n      //     console.log(\"pas dernier tour\")\n      //     prochainPomp=1\n      //     prochainTour=prochainTour+1\n      //   }\n      // }\n\n      const response = await PlayAPI.nouveauTour(prochainPomp, carte, mursH, mursV, prochaineSequence, prochainCycle, prochainTour, resultats.Decedes, resultats.Sauves, session, equipe); // }else{\n      //   // retourAction()\n      // }\n    }\n  };\n\n  const checkNouveauTour = async () => {\n    if (validated.interventions && validated.equipements && numPompier == currentPomp) {\n      nouveauTour();\n    }\n  }; // SOCKETS\n\n\n  const socket = PlayAPI.getSocket();\n  useEffect(() => {\n    socket.on('changementTour', data => {\n      console.log(\"changement tour\");\n\n      if (currentPomp != data.currentPomp || currentCycle !== data.currentCycle || currentTour !== data.currentTour || currentSequence !== data.currentSequence) {\n        // console.log(\"socket nouveau tour\")\n        getPlayState(session, equipe);\n      }\n    }); // socket.on('revealHabitant',(data)=>{\n    //   if(carte!==null && carte.length>0){\n    //     // console.log(carte[data.y][data.x])\n    //     // console.log(carte[data.y])\n    //     if(carte[data.y][data.x]==20){\n    //       // console.log([data.y,data.x])\n    //       updateCarte([data.y,data.x],data.type)\n    //       // console.log(\"socket hab\")\n    //       // console.log(data)\n    //     }\n    //   }\n    // })\n  }); // useEffect(() => {\n  //   console.log(budgetSim)\n  // }, [budgetSim])\n\n  const handleDisconnect = () => {\n    cookie.save('user', \"disconnected\", {\n      path: '/',\n      maxAge: 60 * 60 * 1.5 //sec\n\n    });\n    history.push('/login');\n  };\n\n  const [vue, setVue] = useState(\"operations\");\n\n  const handleViewChange = (event, newValue) => {\n    if (newValue != null) {\n      setVue(newValue);\n    }\n  }; // useEffect(() => {\n  //   console.log(vue)\n  // }, [vue])\n\n\n  return carte.length > 0 && position != null && configuration !== null && configuration !== undefined && budget !== null && budget !== undefined ? /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      position: \"absolute\",\n      display: \"flex\",\n      alignItems: \"center\",\n      justifyContent: \"center\",\n      flex: 1,\n      width: \"100%\",\n      height: \"100%\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(InterBandeauTop // stocks={stocks}\n    , {\n      numeroPompier: numPompier,\n      numEquipe: equipe,\n      sequence: currentSequence,\n      cycle: currentCycle,\n      tour: currentTour,\n      pomp: currentPomp,\n      configuration: configuration,\n      handleViewChange: handleViewChange,\n      vue: vue,\n      interventionsValidated: validated.interventions,\n      equipementsValidated: validated.equipements\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 526,\n      columnNumber: 9\n    }, this), vue == \"operations\" ? /*#__PURE__*/_jsxDEV(Grille, {\n      nbColonnesGrille: nbColonnesGrille,\n      nbLignesGrille: nbLignesGrille,\n      carte: carte,\n      position: position,\n      mursH: mursH,\n      mursV: mursV\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 542,\n      columnNumber: 13\n    }, this) : null, vue == \"interventions\" && cycles != null ? /*#__PURE__*/_jsxDEV(InterInterventions, {\n      budget: budget,\n      cycles: [...cycles.interventions],\n      handleBudgetChange: handleBudgetChange,\n      type: \"interventions\",\n      currentCycle: currentCycle,\n      currentSequence: currentSequence,\n      budgetSim: { ...budgetSim.interventions\n      },\n      couts: couts,\n      nbCycleParSeq: configuration !== null ? configuration.nbCyclesParSequence.valeur : 0,\n      configuration: configuration // page={page.interventions}\n\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 557,\n      columnNumber: 13\n    }, this) : null, vue == \"equipements\" && cycles != null ? /*#__PURE__*/_jsxDEV(InterInterventions, {\n      budget: budget,\n      cycles: [...cycles.equipements],\n      handleBudgetChange: handleBudgetChange,\n      type: \"equipements\",\n      currentCycle: currentCycle,\n      currentSequence: currentSequence,\n      budgetSim: { ...budgetSim.equipements\n      },\n      couts: couts,\n      nbCycleParSeq: configuration !== null ? configuration.nbCyclesParSequence.valeur : 0,\n      configuration: configuration // page={page.equipements}\n\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 576,\n      columnNumber: 13\n    }, this) : null, /*#__PURE__*/_jsxDEV(InterBandeauBottom, {\n      numeroPompier: numPompier,\n      tour: currentTour,\n      pomp: currentPomp,\n      resultats: resultats,\n      vue: vue,\n      couts: couts,\n      budget: budget,\n      validated: vue === \"interventions\" ? validated.interventions : validated.equipements,\n      handleClicValidated: handleClicValidated,\n      equipe: equipe\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 595,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(InterBandeauDroite, {\n      handleDisconnect: handleDisconnect,\n      configuration: configuration\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 607,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 525,\n    columnNumber: 7\n  }, this) : null;\n};\n\n_s(InterInterface, \"Po0LNELtGBTxnQCf6KJ47upXOk0=\", false, function () {\n  return [useHistory];\n});\n\n_c = InterInterface;\nexport default InterInterface;\n\nvar _c;\n\n$RefreshReg$(_c, \"InterInterface\");","map":{"version":3,"sources":["C:/Users/hugod/decitude/client/src/routes/InterInterface.js"],"names":["React","useState","useEffect","useRef","PlayAPI","InterBandeauTop","InterBandeauBottom","Grille","InterInterventions","useHistory","cookie","InterBandeauDroite","InterInterface","history","user","load","undefined","push","numPompier","setNumPompier","currentPomp","setCurrentPomp","currentTour","setCurrentTour","currentCycle","setCurrentCycle","currentSequence","setCurrentSequence","session","setSession","equipe","setEquipe","configuration","setConfiguration","couts","setCouts","resultats","setResultats","Decedes","Sauves","Marqueur","budget","setBudget","sequence","depense","cycles","setCycles","interventions","coutInterDeplacement","valeur","coutInterFeu","coutInterFeuFum","coutInterFum","coutInterMarqueur","coutInterPorte","coutInterHab","coutInterHabitant","equipements","coutEqFeu","coutEqFeuFum","coutEqFum","coutEqMarqueur","budgetDefaultInter","initInfos","budgetSim","setBudgetSim","saveBudgets","checkNouveauTour","response","saveBudgetsPompInit","console","log","numSeq","length","numCycle","pomp1","pomp2","pomp3","pomp4","pomp5","pomp6","Feu","FeuFum","Fum","validated","setValidated","page","setPage","isLoading","carte","setCarte","nbLignesGrille","setNbLignesGrille","nbColonnesGrille","setNbColonnesGrille","position","setPosition","mursH","setMursH","mursV","setMursV","getNombreMarqueur","nbMarqueur","forEach","ligne","lastCycleEq","sort","a","b","lastCycleInter","val","c","Object","keys","key","values","v","getPlayState","current","currentPlayState","parseInt","JSON","parse","resultatsDecedes","resultatsSauves","budgetsPompInit","getPlayParameters","param","getConfiguration","getBudgetTot","cycle","sum","vue","value","handleBudgetChange","type","newBudget","bSim","handleClicValidated","p","nouveauTour","prochainPomp","prochainTour","prochainCycle","prochaineSequence","socket","getSocket","on","data","handleDisconnect","save","path","maxAge","setVue","handleViewChange","event","newValue","display","alignItems","justifyContent","flex","width","height","nbCyclesParSequence"],"mappings":"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","sourcesContent":["import \"../styles/App.css\"\r\nimport React, { useState, useEffect, useRef } from 'react'\r\nimport PlayAPI from \"../API/PlayAPI\"\r\nimport InterBandeauTop from \"../components/interfaceJoueur/InterBandeauTop\"\r\nimport InterBandeauBottom from \"../components/interfaceJoueur/InterBandeauBottom\"\r\nimport Grille from \"../components/interfaceJoueur/Grille\"\r\nimport InterInterventions from \"../components/interfaceJoueur/InterInterventions\"\r\nimport { useHistory } from 'react-router-dom';\r\n\r\n\r\nimport cookie from 'react-cookies'\r\nimport InterBandeauDroite from \"../components/interfaceJoueur/InterBandeauDroite\"\r\n\r\n\r\nconst InterInterface = () => {\r\n\r\n  const history = useHistory()\r\n\r\n  const user = cookie.load(\"user\")\r\n  // console.log(user)\r\n  if(user==null || user==undefined) history.push(\"/login\");\r\n\r\n\r\n\r\n  const [numPompier, setNumPompier] = useState(0)\r\n  const [currentPomp, setCurrentPomp] = useState(null)\r\n  const [currentTour, setCurrentTour] = useState(null)\r\n  const [currentCycle, setCurrentCycle] = useState(null)\r\n  const [currentSequence,setCurrentSequence]=useState(null)\r\n  \r\n  const [session,setSession]=useState(user!==null ? user.session: null)\r\n  const [equipe,setEquipe]=useState(user!==null ? user.equipe : null)\r\n  \r\n  \r\n\r\n\r\n\r\n  const [configuration, setConfiguration] = useState(null)\r\n  \r\n\r\n\r\n  const [couts,setCouts] = useState(null)\r\n\r\n \r\n\r\n  const [resultats, setResultats] = useState({\r\n    Decedes: 0,\r\n    Sauves: 0,\r\n    Marqueur: 0\r\n  })\r\n\r\n\r\n  const [budget, setBudget] = useState({\r\n    sequence:0,\r\n    depense:0\r\n  })\r\n\r\n\r\n  const [cycles, setCycles] = useState(null)\r\n\r\n  useEffect(() => {\r\n    \r\n    if (configuration != null) {\r\n      \r\n      setCouts({\r\n        interventions: {\r\n          coutInterDeplacement: configuration.coutInterDeplacement.valeur,\r\n          coutInterFeu: configuration.coutInterFeu.valeur,\r\n          coutInterFeuFum: configuration.coutInterFeuFum.valeur,\r\n          coutInterFum: configuration.coutInterFum.valeur,\r\n          coutInterMarqueur: configuration.coutInterMarqueur.valeur,\r\n          coutInterPorte: configuration.coutInterPorte.valeur,\r\n          coutInterHab: configuration.coutInterHabitant.valeur,\r\n        },\r\n        equipements: {\r\n          coutEqFeu: configuration.coutEqFeu.valeur,\r\n          coutEqFeuFum: configuration.coutEqFeuFum.valeur,\r\n          coutEqFum: configuration.coutEqFum.valeur,\r\n          coutEqMarqueur: configuration.coutEqMarqueur.valeur,\r\n    \r\n        }\r\n      })\r\n      setBudget({\r\n          sequence: configuration.budgetDefaultInter.valeur,\r\n          depense: 0\r\n        })\r\n\r\n        if(cycles!=null){\r\n          initInfos(cycles)\r\n        }\r\n\r\n    }\r\n  }, [configuration])\r\n\r\n  \r\n\r\n  const [budgetSim, setBudgetSim] = useState({\r\n  })\r\n\r\n  const saveBudgets=async(cycles)=>{\r\n    \r\n    checkNouveauTour()\r\n    const response =  await PlayAPI.saveBudgetsPompInit(cycles,session,equipe)\r\n    console.log(\"save budgets\")\r\n    console.log(cycles)\r\n  }\r\n\r\n  useEffect(() => {\r\n    if(cycles!=null){\r\n      saveBudgets(cycles)\r\n    }\r\n    \r\n    \r\n\r\n    // console.log(\"last cycle\",{\r\n    //   numSeq:cycles.interventions.length>1 ? cycles.interventions.length%2 == 0  ? cycles.interventions[cycles.interventions.length -1].numSeq +1 : cycles.interventions[cycles.interventions.length -1].numSeq : 1 ,\r\n    //   numCycle: (cycles.interventions.length)%2+1})\r\n\r\n    if(cycles!=null){\r\n\r\n      if(configuration!=null){\r\n        initInfos(cycles)\r\n      }\r\n      \r\n\r\n      setBudgetSim({\r\n        interventions: {\r\n          numSeq:cycles.interventions.length>1 ? cycles.interventions.length%2 == 0  ? cycles.interventions[cycles.interventions.length -1].numSeq +1 : cycles.interventions[cycles.interventions.length -1].numSeq : 1 ,\r\n          numCycle: (cycles.interventions.length)%2+1,\r\n          pomp1: 0,\r\n          pomp2: 0,\r\n          pomp3: 0,\r\n          pomp4: 0,\r\n          pomp5: 0,\r\n          pomp6: 0,\r\n        },\r\n        equipements: {\r\n          numSeq:cycles.equipements.length>1 ? cycles.equipements.length%2 == 0  ? cycles.equipements[cycles.equipements.length -1].numSeq +1 : cycles.equipements[cycles.equipements.length -1].numSeq : 1 ,\r\n          numCycle: (cycles.equipements.length)%2+1,\r\n          Feu: {\r\n            pomp1: 0,\r\n            pomp2: 0,\r\n            pomp3: 0,\r\n            pomp4: 0,\r\n            pomp5: 0,\r\n            pomp6: 0,\r\n          },\r\n          FeuFum: {\r\n            pomp1: 0,\r\n            pomp2: 0,\r\n            pomp3: 0,\r\n            pomp4: 0,\r\n            pomp5: 0,\r\n            pomp6: 0,\r\n          },\r\n          Fum: {\r\n            pomp1: 0,\r\n            pomp2: 0,\r\n            pomp3: 0,\r\n            pomp4: 0,\r\n            pomp5: 0,\r\n            pomp6: 0\r\n          },\r\n          Marqueur: {\r\n            pomp1: 0,\r\n            pomp2: 0,\r\n            pomp3: 0,\r\n            pomp4: 0,\r\n            pomp5: 0,\r\n            pomp6: 0,\r\n          },\r\n        },\r\n      })\r\n    }\r\n    \r\n\r\n    // console.log(cycles.equipements)\r\n  }, [cycles])\r\n\r\n  const [validated, setValidated] = useState({\r\n    interventions: false,\r\n    equipements: false\r\n  })\r\n  const [page, setPage] = useState({\r\n    interventions: 0,\r\n    equipements: 0\r\n  })\r\n\r\n\r\n  \r\n  const isLoading = useRef(false)\r\n\r\n  // INITIALISATION DE LA CARTE\r\n\r\n  const [carte, setCarte] = useState([\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n  ])\r\n\r\n  // const [carte, setCarte] = useState([])\r\n\r\n  const [nbLignesGrille, setNbLignesGrille] = useState(0)\r\n  const [nbColonnesGrille, setNbColonnesGrille] = useState(0)\r\n  const [position, setPosition] = useState(null)\r\n\r\n\r\n  const [mursH, setMursH] = useState([\r\n    [1, 1, 1, 1, 1, 1, 2, 6, 1, 1, 1, 1, 2, 5, 1, 1],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [1, 1, 1, 1, 2, 6, 1, 6, 2, 1, 1, 1, 5, 2, 1, 1],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [1, 1, 1, 1, 1, 1, 6, 2, 1, 1, 1, 1, 1, 1, 1, 1]\r\n  ])\r\n\r\n  const [mursV, setMursV] = useState([\r\n    [1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],\r\n    [2, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],\r\n    [5, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],\r\n    [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1],\r\n    [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 2, 0, 0, 0, 0, 0, 1],\r\n    [1, 0, 0, 0, 0, 0, 2, 0, 0, 0, 5, 0, 0, 0, 0, 0, 1],\r\n    [1, 0, 0, 0, 0, 0, 5, 0, 0, 0, 5, 0, 0, 0, 0, 0, 2],\r\n    [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 2, 0, 0, 0, 0, 0, 5]\r\n  ])\r\n\r\n\r\n  const getNombreMarqueur = (mursH, mursV) => {\r\n    let nbMarqueur = 0\r\n    mursH.forEach(ligne => {\r\n      ligne.forEach(valeur => {\r\n        if (valeur == 3) nbMarqueur = nbMarqueur + 1\r\n        if (valeur == 4) nbMarqueur = nbMarqueur + 2\r\n      })\r\n    })\r\n    mursV.forEach(ligne => {\r\n      ligne.forEach(valeur => {\r\n        if (valeur == 3) nbMarqueur = nbMarqueur + 1\r\n        if (valeur == 4) nbMarqueur = nbMarqueur + 2\r\n      })\r\n    })\r\n    return nbMarqueur\r\n  }\r\n\r\n  // GET PLAY PARAMETERS \r\n\r\n\r\n\r\n  const initInfos=(cycles)=>{\r\n    if(cycles!==null && configuration!==null){\r\n      const lastCycleEq = [...cycles.equipements].sort((a, b) => (a.numSeq-b.numSeq)*100+a.numCycle - b.numCycle)[[...cycles.equipements].length-1]\r\n      const lastCycleInter = [...cycles.interventions].sort((a, b) => (a.numSeq-b.numSeq)*100+a.numCycle - b.numCycle)[[...cycles.interventions].length-1]\r\n      \r\n      var val = {\r\n        interventions: false,\r\n        equipements: false\r\n      }\r\n      \r\n      if(lastCycleInter!==null && lastCycleInter!==undefined && lastCycleInter.numSeq==currentSequence && lastCycleInter.numCycle==currentCycle) val.interventions=true\r\n      if(lastCycleEq!==null && lastCycleEq!==undefined && lastCycleEq.numSeq==currentSequence && lastCycleEq.numCycle==currentCycle) val.equipements=true\r\n      setValidated(val)\r\n\r\n      var b={\r\n        sequence: configuration.budgetDefaultInter.valeur,\r\n        depense: 0\r\n      }\r\n      console.log(configuration)\r\n\r\n      cycles.equipements.forEach((c)=>{\r\n        if(c.numSeq==currentSequence){\r\n          Object.keys(c).forEach((key)=>{\r\n            Object.values(c[key]).forEach((v)=>{\r\n              console.log(configuration[\"coutEq\"+key].valeur*v)\r\n              b.depense+=configuration[\"coutEq\"+key].valeur*v\r\n            })\r\n            \r\n          })\r\n          \r\n        }\r\n      })\r\n      console.log(b)\r\n    }\r\n    \r\n  }\r\n\r\n\r\n\r\n  const getPlayState=async(session,equipe)=>{\r\n    \r\n    if(!isLoading.current){\r\n      \r\n      isLoading.current=true\r\n      const currentPlayState = await PlayAPI.getPlayState(session,equipe)\r\n      // console.log(\"get play state\")\r\n      if(Object.keys(currentPlayState).length>0 ){\r\n        \r\n        // console.log(currentPlayState)\r\n        setCurrentPomp(parseInt(JSON.parse(currentPlayState.currentPomp.valeur)))\r\n        setCurrentTour(parseInt(JSON.parse(currentPlayState.currentTour.valeur)))\r\n        setCurrentCycle(parseInt(JSON.parse(currentPlayState.currentCycle.valeur)))\r\n        setCurrentSequence(parseInt(JSON.parse(currentPlayState.currentSequence.valeur)))\r\n        const mursH=JSON.parse(currentPlayState.mursH.valeur)\r\n        const mursV=JSON.parse(currentPlayState.mursV.valeur)\r\n        setMursH(mursH)\r\n        setMursV(mursV)\r\n        setCarte(JSON.parse(currentPlayState.carte.valeur))\r\n        setResultats({\r\n          Decedes:parseInt(JSON.parse(currentPlayState.resultatsDecedes.valeur)),\r\n          Sauves:parseInt(JSON.parse(currentPlayState.resultatsSauves.valeur)),\r\n          Marqueur:getNombreMarqueur(mursH,mursV)\r\n        })\r\n        setCycles(JSON.parse(currentPlayState.budgetsPompInit.valeur))\r\n      }\r\n      // getPositionFromCarte(JSON.parse(currentPlayState.carte.valeur))\r\n      isLoading.current=false\r\n    }\r\n\r\n  }\r\n\r\n  // useEffect(()=>{\r\n  //   console.log(currentPomp)\r\n  // },[currentPomp])\r\n\r\n\r\n  useEffect(() => {\r\n    // console.log(carte)\r\n    if (carte.length > 0) {\r\n      setNbLignesGrille(carte.length)\r\n      setNbColonnesGrille(carte[0].length)\r\n      setPosition([carte.length + 1, carte[0].length + 1])\r\n    }\r\n\r\n  }, [carte])\r\n\r\n\r\n  useEffect(()=>{\r\n    if(session!=null && equipe!=null && currentTour==null){\r\n      if(!isLoading.current) getPlayState(session,equipe)\r\n      getPlayParameters()\r\n      // getPositionFromCarte()\r\n    }\r\n  },[session,equipe,numPompier])\r\n\r\n  const getPlayParameters = async () => {\r\n    const param = await PlayAPI.getConfiguration(session)\r\n    setConfiguration(param)\r\n    // console.log(param)\r\n  }\r\n\r\n\r\n\r\n\r\n  const getBudgetTot = (cycle) => {\r\n    let sum = 0\r\n    if(vue==\"interventions\"){\r\n      Object.keys(cycle).forEach((key) => {\r\n        if (key != \"numCycle\" && key != \"numSeq\") {\r\n          sum += cycle[key]\r\n        }\r\n      })\r\n    }else{\r\n      Object.keys(cycle).forEach((key) => {\r\n        if (key != \"numCycle\" && key != \"numSeq\") {\r\n          Object.values(cycle[key]).forEach(value => {\r\n            // console.log(couts.equipements[\"coutEq\"+key],\"coutEq\"+key,couts)\r\n            sum += value*couts.equipements[\"coutEq\"+key]\r\n          });\r\n        }\r\n      })\r\n    }\r\n    return sum\r\n  }\r\n\r\n\r\n  const handleBudgetChange = (type, newBudget) => {\r\n    var bSim = { ...budgetSim }\r\n    bSim[type] = newBudget\r\n    setBudgetSim(bSim)\r\n    // console.log(bSim)\r\n  }\r\n\r\n  const handleClicValidated = (type) => {\r\n    var v = { ...validated }\r\n    validated[type] = true\r\n    setValidated(validated)\r\n\r\n    var p = {...page}\r\n    if(type==\"interventions\") p[type]+=1\r\n    if(type==\"equipements\")  p[type]+=1\r\n    setPage(p)\r\n\r\n    var c = { ...cycles }\r\n    c[type].push(budgetSim[type])\r\n    setCycles(c)\r\n\r\n    // console.log(c[type])\r\n    var b = { ...budget }\r\n    b.depense += getBudgetTot(budgetSim[type])\r\n    setBudget(b)\r\n\r\n  }\r\n\r\n  const nouveauTour=async()=>{\r\n    console.log(\"nouveau tour\")\r\n    if(configuration!=null){\r\n      // if(bool){\r\n\r\n        \r\n        let prochainPomp = 1\r\n        let prochainTour = currentTour\r\n        let prochainCycle = currentCycle\r\n        let prochaineSequence=currentSequence\r\n\r\n\r\n\r\n        // if(numPompier==configuration.nbPompEquipe.valeur){ // DERNIER POMP DU TOUR\r\n        //   if(currentTour==configu  ration.nbToursParCycle.valeur){ // SEND TO INTER\r\n        //     prochainTour = 1\r\n        //     prochainPomp=0 // A CHANGER AVEC STRATEGIQUE\r\n\r\n        //     if(prochainCycle==configuration.nbCyclesParSequence.valeur){\r\n        //       prochainCycle=1\r\n        //       prochaineSequence=prochaineSequence+1\r\n        //     }else{\r\n        //       prochainCycle=prochainCycle+1\r\n        //     }\r\n\r\n\r\n        //   }else{ // PAS DERNIER TOUR DU CYCLE\r\n        //     console.log(\"pas dernier tour\")\r\n        //     prochainPomp=1\r\n        //     prochainTour=prochainTour+1\r\n\r\n\r\n        //   }\r\n\r\n        // }\r\n      const response =  await PlayAPI.nouveauTour(prochainPomp,carte,mursH,mursV,prochaineSequence,prochainCycle,prochainTour,resultats.Decedes,resultats.Sauves,session,equipe)      \r\n      // }else{\r\n      //   // retourAction()\r\n      // }\r\n    }\r\n  }\r\n\r\n\r\n\r\n\r\n  const checkNouveauTour = async()=>{\r\n    if(validated.interventions && validated.equipements && numPompier==currentPomp){\r\n      nouveauTour()\r\n    }\r\n  }\r\n\r\n// SOCKETS\r\nconst socket = PlayAPI.getSocket()\r\n  useEffect(() => {\r\n    \r\n    socket.on('changementTour', (data) => {\r\n     \r\n      console.log(\"changement tour\")\r\n      \r\n      if(currentPomp!=data.currentPomp || currentCycle!==data.currentCycle || currentTour!==data.currentTour || currentSequence!==data.currentSequence){\r\n        // console.log(\"socket nouveau tour\")\r\n        getPlayState(session,equipe)\r\n      }\r\n\r\n     \r\n      \r\n    })\r\n\r\n\r\n    // socket.on('revealHabitant',(data)=>{\r\n    //   if(carte!==null && carte.length>0){\r\n    //     // console.log(carte[data.y][data.x])\r\n    //     // console.log(carte[data.y])\r\n    //     if(carte[data.y][data.x]==20){\r\n    //       // console.log([data.y,data.x])\r\n    //       updateCarte([data.y,data.x],data.type)\r\n    //       // console.log(\"socket hab\")\r\n    //       // console.log(data)\r\n    //     }\r\n    //   }\r\n    // })\r\n  });\r\n\r\n\r\n  // useEffect(() => {\r\n  //   console.log(budgetSim)\r\n  // }, [budgetSim])\r\n\r\n  const handleDisconnect=()=>{\r\n    cookie.save('user', \"disconnected\", { \r\n      path: '/',\r\n      maxAge: 60*60*1.5, //sec\r\n    })\r\n    history.push('/login');\r\n  }\r\n\r\n\r\n  const [vue, setVue] = useState(\"operations\")\r\n\r\n  const handleViewChange = (event, newValue) => {\r\n    if (newValue != null) {\r\n      setVue(newValue)\r\n    }\r\n  }\r\n  // useEffect(() => {\r\n  //   console.log(vue)\r\n  // }, [vue])\r\n\r\n  \r\n  return (\r\n\r\n    carte.length > 0 && position != null && configuration!==null && configuration!==undefined && budget!==null && budget!==undefined?\r\n\r\n      <div style={{position:\"absolute\",display:\"flex\",alignItems:\"center\",justifyContent:\"center\",flex:1,width:\"100%\",height:\"100%\"}}>\r\n        <InterBandeauTop\r\n          // stocks={stocks}\r\n          numeroPompier={numPompier}\r\n          numEquipe={equipe}\r\n          sequence={currentSequence}\r\n          cycle={currentCycle}\r\n          tour={currentTour}\r\n          pomp={currentPomp}\r\n          configuration={configuration}\r\n          handleViewChange={handleViewChange}\r\n          vue={vue}\r\n          interventionsValidated={validated.interventions}\r\n          equipementsValidated={validated.equipements}\r\n        />\r\n        {\r\n          vue == \"operations\" ?\r\n            <Grille\r\n              nbColonnesGrille={nbColonnesGrille}\r\n              nbLignesGrille={nbLignesGrille}\r\n              carte={carte}\r\n              position={position}\r\n              mursH={mursH}\r\n              mursV={mursV}\r\n            />\r\n            : null\r\n        }\r\n\r\n\r\n        {\r\n          vue == \"interventions\" && cycles!=null ?\r\n\r\n            <InterInterventions\r\n              budget={budget}\r\n              cycles={[...cycles.interventions]}\r\n              handleBudgetChange={handleBudgetChange}\r\n              type=\"interventions\"\r\n              currentCycle={currentCycle}\r\n              currentSequence={currentSequence}\r\n              budgetSim={{...budgetSim.interventions}}\r\n              couts={couts}\r\n              nbCycleParSeq={configuration!==null ? configuration.nbCyclesParSequence.valeur : 0}\r\n              configuration={configuration}\r\n              // page={page.interventions}\r\n            />\r\n            : null\r\n        }\r\n\r\n        {\r\n          vue == \"equipements\" && cycles!=null ?\r\n\r\n            <InterInterventions\r\n              budget={budget}\r\n              cycles={[...cycles.equipements]}\r\n              handleBudgetChange={handleBudgetChange}\r\n              type=\"equipements\"\r\n              currentCycle={currentCycle}\r\n              currentSequence={currentSequence}\r\n              budgetSim={{...budgetSim.equipements}}\r\n              couts={couts}\r\n              nbCycleParSeq={configuration!==null ? configuration.nbCyclesParSequence.valeur : 0}\r\n              configuration={configuration}\r\n              // page={page.equipements}\r\n            />\r\n            : null\r\n        }\r\n\r\n\r\n        \r\n\r\n        <InterBandeauBottom\r\n          numeroPompier={numPompier}\r\n          tour={currentTour}\r\n          pomp={currentPomp}\r\n          resultats={resultats}\r\n          vue={vue}\r\n          couts={couts}\r\n          budget={budget}\r\n          validated={vue === \"interventions\" ? validated.interventions : validated.equipements}\r\n          handleClicValidated={handleClicValidated}\r\n          equipe={equipe}\r\n        />\r\n        <InterBandeauDroite\r\n            handleDisconnect={handleDisconnect}\r\n            configuration={configuration}\r\n          />\r\n      </div>\r\n\r\n      : null\r\n\r\n  );\r\n\r\n}\r\n\r\nexport default InterInterface;\r\n\r\n"]},"metadata":{},"sourceType":"module"}