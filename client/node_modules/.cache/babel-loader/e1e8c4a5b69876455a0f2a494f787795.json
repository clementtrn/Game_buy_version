{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\hugod\\\\decitude\\\\client\\\\src\\\\routes\\\\TactInterface.js\",\n    _s = $RefreshSig$();\n\nimport \"../styles/App.css\";\nimport React, { useState, useEffect, useRef } from 'react';\nimport PlayAPI from \"../API/PlayAPI\";\nimport TactBandeauTop from \"../components/interfaceJoueur/TactBandeauTop\";\nimport TactBandeauBottom from \"../components/interfaceJoueur/TactBandeauBottom\";\nimport Grille from \"../components/interfaceJoueur/Grille\";\nimport { useHistory } from 'react-router-dom';\nimport { Typography } from \"@material-ui/core\";\nimport cookie from 'react-cookies';\nimport TactBandeauDroite from \"../components/interfaceJoueur/TactBandeauDroite\";\nimport ContentsAPI from \"../API/ContentsAPI\";\nimport io from 'socket.io-client';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst TactInterface = () => {\n  _s();\n\n  const history = useHistory();\n  const user = cookie.load(\"user\");\n\n  const handleDisconnect = () => {\n    cookie.save('user', \"disconnected\", {\n      path: '/',\n      maxAge: 60 * 60 * 1.5 //sec\n\n    });\n    history.push('/login');\n  };\n\n  if (user === null || user === undefined || user == \"disconnected\") history.push(\"/login\");\n  if (user !== null && user !== undefined && user.role !== undefined && !user.role.includes(\"TACT\")) handleDisconnect();\n  const [play, setPlay] = useState(false);\n  const [numPompier, setNumPompier] = useState(user !== null && user !== undefined && user.role !== undefined ? user.role.replace(\"TACT\", \"\") : null);\n  const [currentPomp, setCurrentPomp] = useState(null);\n  const [currentTour, setCurrentTour] = useState(null);\n  const [currentCycle, setCurrentCycle] = useState(null);\n  const [currentSequence, setCurrentSequence] = useState(null);\n  const [session, setSession] = useState(user != null ? user.session : null);\n  const [equipe, setEquipe] = useState(user != null ? user.equipe : null);\n  const [position, setPosition] = useState(null);\n  const [deplacementEnCours, setDeplacementEnCours] = useState({\n    type: 0,\n    rotation: 1\n  });\n  const [histActions, setHistActions] = useState([]);\n  const [chrono, setChrono] = useState(null);\n  useEffect(() => {\n    if (numPompier == null) handleDisconnect();\n  }, [numPompier]);\n  const [configuration, setConfiguration] = useState(null);\n  const [stocks, setStocks] = useState(null);\n  const [resultats, setResultats] = useState({\n    Decedes: 0,\n    Sauves: 0\n  });\n  const [interventions, setInterventions] = useState({\n    Deplacement: 0,\n    Feu: 0,\n    FeuFum: 0,\n    Fum: 0,\n    Marqueur: 0,\n    Porte: 0,\n    Habitant: 0\n  });\n  const [budget, setBudget] = useState(0);\n  const [budgetDepense, setBudgetDepense] = useState(0);\n  const isLoading = useRef(false); // INITIALISATION DE LA CARTE\n  // const [carte, setCarte] = useState([\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n  // ])\n\n  const [carte, setCarte] = useState([]);\n  const [nbLignesGrille, setNbLignesGrille] = useState(0);\n  const [nbColonnesGrille, setNbColonnesGrille] = useState(0);\n  const [mursH, setMursH] = useState([[1, 1, 1, 1, 1, 1, 2, 6, 1, 1, 1, 1, 2, 5, 1, 1], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [1, 1, 1, 1, 2, 6, 1, 6, 2, 1, 1, 1, 5, 2, 1, 1], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [1, 1, 1, 1, 1, 1, 6, 2, 1, 1, 1, 1, 1, 1, 1, 1]]);\n  const [mursV, setMursV] = useState([[1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1], [2, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1], [5, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1], [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1], [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 2, 0, 0, 0, 0, 0, 1], [1, 0, 0, 0, 0, 0, 2, 0, 0, 0, 5, 0, 0, 0, 0, 0, 1], [1, 0, 0, 0, 0, 0, 5, 0, 0, 0, 5, 0, 0, 0, 0, 0, 2], [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 2, 0, 0, 0, 0, 0, 5]]); // GET PLAY PARAMETERS \n\n  const getPlayState = async (session, equipe) => {\n    // console.log(\"get play state\")\n    if (!isLoading.current) {\n      isLoading.current = true;\n      const currentPlayState = await PlayAPI.getPlayState(session, equipe); // console.log(currentPlayState)\n\n      if (Object.keys(currentPlayState).length > 0) {\n        // console.log(parseInt(JSON.parse(currentPlayState.currentTour.valeur)))\n        setCurrentPomp(parseInt(JSON.parse(currentPlayState.currentPomp.valeur)));\n        setCurrentTour(parseInt(JSON.parse(currentPlayState.currentTour.valeur)));\n        setCurrentCycle(parseInt(JSON.parse(currentPlayState.currentCycle.valeur)));\n        setCurrentSequence(parseInt(JSON.parse(currentPlayState.currentSequence.valeur)));\n        setMursH(JSON.parse(currentPlayState.mursH.valeur));\n        setMursV(JSON.parse(currentPlayState.mursV.valeur));\n        setCarte(JSON.parse(currentPlayState.carte.valeur));\n        setResultats({\n          Decedes: parseInt(JSON.parse(currentPlayState.resultatsDecedes.valeur)),\n          Sauves: parseInt(JSON.parse(currentPlayState.resultatsSauves.valeur))\n        });\n        setPlay(JSON.parse(currentPlayState.play.valeur)); // if(parseInt(JSON.parse(currentPlayState.currentPomp.valeur))==1 && parseInt(JSON.parse(currentPlayState.currentTour.valeur))==1){\n\n        getBudget(parseInt(JSON.parse(currentPlayState.currentCycle.valeur)), parseInt(JSON.parse(currentPlayState.currentSequence.valeur))); //  }\n\n        const c = parseInt(JSON.parse(currentPlayState.currrentChrono.valeur));\n\n        if (configuration !== null && c <= configuration.chronoTour.valeur && parseInt(JSON.parse(currentPlayState.currentPomp.valeur)) == numPompier) {\n          setChrono(c);\n        } else {\n          setChrono(null); // console.log(\"chrono\")\n        }\n      }\n\n      getPositionFromCarte(JSON.parse(currentPlayState.carte.valeur));\n      isLoading.current = false;\n    }\n  };\n\n  useEffect(() => {\n    // console.log(carte)\n    if (carte.length > 0) {\n      setNbLignesGrille(carte.length);\n      setNbColonnesGrille(carte[0].length);\n      getPositionFromCarte(carte);\n    }\n  }, [carte]); // useEffect(()=>{\n  //   console.log(currentTour)\n  // },[currentTour])\n\n  useEffect(() => {\n    if (session != null && equipe != null && currentTour == null) {\n      if (!isLoading.current && configuration !== null) getPlayState(session, equipe);\n      getPlayParameters();\n      getPositionFromCarte(carte);\n    }\n  }, [session, equipe, numPompier, configuration]);\n\n  const getPlayParameters = async () => {\n    const param = await PlayAPI.getConfiguration(session);\n    setConfiguration(param);\n  };\n\n  const getPositionFromCarte = carte => {\n    if (carte != null && carte.length > 0) {\n      carte.forEach((ligne, indexI) => {\n        ligne.forEach((valeur, indexJ) => {\n          if (Math.floor(valeur / 1000) == 1 && Math.floor(valeur % 1000 / 100) == numPompier) {\n            setPosition([indexI, indexJ]);\n            setDeplacementEnCours({\n              type: 0,\n              rotation: valeur % 10\n            });\n          }\n        });\n      });\n    }\n  }; // const onTextChange = (e) => {\n  //   setNumPompier(e.target.value)\n  //   console.log(typeof (e.target.value))\n  // }\n  // const onXChange = (e) => {\n  //   e.preventDefault()\n  //   if (e.target.value.length > 0) {\n  //     updateCarte(position, 0)\n  //     setPosition(position => [position[0], parseInt(e.target.value)])\n  //   } else {\n  //     updateCarte(position, 0)\n  //     setPosition(position => [position[0], 0])\n  //   }\n  // }\n  // const onYChange = (e) => {\n  //   e.preventDefault()\n  //   if (e.target.value.length > 0) {\n  //     updateCarte(position, 0)\n  //     setPosition(position => [parseInt(e.target.value), position[1]])\n  //   } else {\n  //     updateCarte(position, 0)\n  //     setPosition(position => [0, position[1]])\n  //   }\n  // }\n  // UPDATES\n\n\n  const updateCarte = (coords, value) => {\n    if (coords[0] < nbLignesGrille && coords[1] < nbColonnesGrille) {\n      try {\n        var c = [...carte];\n        c[coords[0]][coords[1]] = value;\n        setCarte(c);\n      } catch (error) {// console.log(error)\n      }\n    }\n  };\n\n  const updateMurH = (coords, value) => {\n    if (coords[0] < mursH.length && coords[1] < mursH[0].length) {\n      try {\n        var m = [...mursH];\n        m[coords[0]][coords[1]] = value;\n        setMursH(m);\n      } catch (error) {// console.log(error)\n      }\n    }\n  };\n\n  const updateMurV = (coords, value) => {\n    if (coords[0] < mursV.length && coords[1] < mursV[0].length) {\n      try {\n        var m = [...mursV];\n        m[coords[0]][coords[1]] = value;\n        setMursV(m);\n      } catch (error) {// console.log(error)\n      }\n    }\n  }; // ACTIONS\n\n\n  const updateBudget = action => {\n    var depenses = 0;\n    if (configuration[\"coutEq\" + action] != null) depenses += configuration[\"coutEq\" + action].valeur;\n    if (configuration[\"coutInter\" + action] != null) depenses += configuration[\"coutInter\" + action].valeur;\n    setBudget(budget => budget - depenses);\n    setBudgetDepense(bd => bd + depenses);\n  };\n\n  const addHistAction = (budget, budgetDepense) => {\n    const h = [...histActions, {\n      carte: JSON.stringify(carte),\n      budget: JSON.stringify(budget),\n      budgetDepense: JSON.stringify(budgetDepense),\n      mursH: JSON.stringify(mursH),\n      mursV: JSON.stringify(mursV),\n      stocks: JSON.stringify(stocks),\n      resultats: JSON.stringify(resultats),\n      interventions: JSON.stringify(interventions),\n      deplacementEnCours: JSON.stringify({\n        type: 0,\n        rotation: deplacementEnCours.rotation\n      })\n    }];\n    setHistActions(h);\n  };\n\n  const retourAction = () => {\n    isLoading.current = true;\n    var h = [...histActions];\n    h.pop();\n    const state = h[h.length - 1];\n    setCarte(JSON.parse(state.carte));\n    setMursH(JSON.parse(state.mursH));\n    setMursV(JSON.parse(state.mursV));\n    setStocks(JSON.parse(state.stocks));\n    setInterventions(JSON.parse(state.interventions));\n    setResultats(JSON.parse(state.resultats));\n    setBudget(JSON.parse(state.budget));\n    setBudgetDepense(JSON.parse(state.budgetDepense));\n    setDeplacementEnCours(JSON.parse(state.deplacementEnCours));\n    setHistActions(h);\n    isLoading.current = false;\n  };\n\n  useEffect(() => {\n    if (position !== null && stocks !== null && budget > 0 && deplacementEnCours.type == 0 && (histActions[histActions.length - 1] == undefined || budget < histActions[histActions.length - 1].budget)) {\n      addHistAction(budget, budgetDepense);\n    }\n  }, [deplacementEnCours, budgetDepense, stocks]); // useEffect(() => {\n  //   console.log(\"hist Actions\")\n  //   console.log(histActions)\n  // }, [histActions])\n  // useEffect(()=>{\n  //   if( position!==null && budget>0){\n  //     if(histActions[histActions.length-1]!==undefined && budget<histActions[histActions.length-1].budget ){\n  //       addHistAction(budget)\n  //     }\n  //   }\n  // },[budget])\n\n  const doAction = action => {\n    try {\n      if (Object.keys(stocks).includes(action)) {\n        var s = stocks;\n        s[action] = s[action] - 1;\n        setStocks(s);\n      }\n    } catch (error) {}\n\n    try {\n      if (Object.keys(interventions).includes(action)) {\n        var i = interventions;\n        i[action] = i[action] - 1;\n        setInterventions(i);\n      }\n    } catch (error) {} // setTimeout(() => {\n\n\n    updateBudget(action); // }, 1000);\n  };\n\n  const updateResultats = sauve => {\n    var res = { ...resultats\n    };\n\n    if (sauve) {\n      res.Sauves += 1;\n    } else {\n      res.Decedes += 1;\n    } // console.log(res)\n\n\n    setResultats(res);\n  };\n\n  useEffect(() => {\n    setBtnClickedBottom(null);\n    revealHabitant();\n  }, [position]);\n  useEffect(() => {\n    if (carte.length > 0) relacherHabitant();\n  }, [position, mursH, mursV]); // useEffect(() => {\n  //   console.log(\"Stocks\")\n  //   console.log(stocks)\n  // }, [stocks])\n\n  useEffect(() => {\n    if (configuration != null) {\n      var inter = interventions;\n      const interKeys = Object.keys(inter);\n      interKeys.forEach(action => {\n        try {\n          if (configuration[\"coutInter\" + action].valeur > 0) {\n            inter[action] = Math.min(configuration[\"coutEq\" + action] != null && configuration[\"coutEq\" + action] != undefined ? Math.floor(budget / (configuration[\"coutInter\" + action].valeur + configuration[\"coutEq\" + action].valeur)) : Math.floor(budget / configuration[\"coutInter\" + action].valeur), stocks !== null && stocks[action] != null && stocks[action] != undefined && stocks[action] != \"NaN\" ? stocks[action] : 1000);\n          }\n        } catch (error) {// console.log(error, action)\n        }\n      });\n      setInterventions(inter);\n    } else {// getPlayParameters()\n    }\n  }, [budget, configuration, numPompier, stocks]); // SOCKETS\n  // SOCKETS \n\n  const onTourChange = async e => {\n    e.preventDefault(); // console.log(\"nouveau tour todo\")\n  };\n\n  const modifyBudgetsFin = async (cycle, sequence, prochainPomp, prochainTour, prochainCycle, prochaineSequence) => {\n    // console.log(\"budgets modified 0\")\n    PlayAPI.getBudgetsPompFin(session, equipe).then(res => {\n      // console.log(res)\n      var budgetsFin = JSON.parse(res.valeur);\n\n      try {\n        budgetsFin.interventions.forEach((b, index) => {\n          if (b.numCycle == cycle && b.numSeq == sequence) {\n            budgetsFin[\"interventions\"][index][\"pomp\" + numPompier] = budget;\n          }\n        });\n      } catch (error) {}\n\n      try {\n        budgetsFin.equipements.forEach((e, index) => {\n          if (e.numCycle == cycle && e.numSeq == sequence) {\n            budgetsFin[\"equipements\"][index][\"Feu\"][\"pomp\" + numPompier] = stocks.Feu;\n            budgetsFin[\"equipements\"][index][\"FeuFum\"][\"pomp\" + numPompier] = stocks.FeuFum;\n            budgetsFin[\"equipements\"][index][\"Fum\"][\"pomp\" + numPompier] = stocks.Fum;\n            budgetsFin[\"equipements\"][index][\"Marqueur\"][\"pomp\" + numPompier] = stocks.Marqueur;\n          }\n        });\n      } catch (error) {} // console.log(\"budgets modified 1\")\n\n\n      PlayAPI.saveBudgetsPompFin(budgetsFin, session, equipe).then(() => {\n        const newCarte = evenementsAleatoire();\n        PlayAPI.nouveauTour(socket, prochainPomp, newCarte, mursH, mursV, prochaineSequence, prochainCycle, prochainTour, resultats.Decedes, resultats.Sauves, session, equipe, configuration.chronoTour.valeur); // return budgetsFin\n      });\n    });\n  };\n\n  const getBudget = async (cycle, sequence) => {\n    var nouveauBudget = await PlayAPI.getBudgetsPompFin(session, equipe);\n    nouveauBudget = nouveauBudget.valeur;\n    nouveauBudget = JSON.parse(nouveauBudget);\n    let budgetInter = 0;\n    let stocksEq = stocks !== null && stocks !== undefined ? { ...stocks\n    } : {\n      Feu: 0,\n      FeuFum: 0,\n      Fum: 0,\n      Marqueur: 0\n    };\n\n    try {\n      nouveauBudget.interventions.forEach(b => {\n        if (b.numCycle == cycle && b.numSeq == sequence) {\n          budgetInter = b[\"pomp\" + numPompier];\n        }\n      });\n    } catch (error) {}\n\n    try {\n      nouveauBudget.equipements.forEach(e => {\n        if (e.numCycle == cycle && e.numSeq == sequence) {\n          stocksEq.Feu += e.Feu[\"pomp\" + numPompier];\n          stocksEq.FeuFum += e.FeuFum[\"pomp\" + numPompier];\n          stocksEq.Fum += e.Fum[\"pomp\" + numPompier];\n          stocksEq.Marqueur += e.Marqueur[\"pomp\" + numPompier];\n        }\n      });\n    } catch (error) {} // console.log(nouveauBudget)\n\n\n    if (budgetInter !== budget) {\n      setBudget(budgetInter);\n      setBudgetDepense(0);\n    }\n\n    setStocks(stocksEq);\n  };\n\n  const [socket, setSocket] = useState(null); // console.log(socket)\n\n  useEffect(() => {\n    if (socket === null && configuration !== null) {\n      const s = io.connect(\"https://www.back.leaders-extreme.fr\");\n      setSocket(s);\n      s.on('changementTour', data => {\n        if (currentPomp != data.currentPomp || currentCycle !== data.currentCycle || currentTour !== data.currentTour || currentSequence !== data.currentSequence) {\n          console.log(\"changement tour\");\n          getPlayState(session, equipe);\n        }\n      });\n      s.on('revealHabitant', data => {\n        if (carte !== null && carte.length > 0) {\n          // console.log(carte[data.y][data.x])\n          // console.log(carte[data.y])\n          if (carte[data.y][data.x] == 20) {\n            // console.log([data.y,data.x])\n            updateCarte([data.y, data.x], data.type); // console.log(\"socket hab\")\n            // console.log(data)\n          }\n        }\n      });\n      s.on('startStopPartie', data => {\n        getPlayState(session, equipe);\n      });\n    }\n  }, [socket, configuration]); // TESTS\n\n  const test = async () => {\n    console.log(\"test function\");\n  }; // AUTORISATIONS \n\n\n  const deplacementAutorise = deplacement => {\n    // return true\n    var dpl = [...deplacement];\n    if (dpl[0] == 0 && dpl[1] == 0) return false;\n    if (position[0] + dpl[0] > carte.length - 1 || position[1] + dpl[1] > carte[0].length - 1 || position[0] + dpl[0] < 0 || position[1] + dpl[1] < 0) return false;\n    const dplInterditsCases = [1000, 20, 3, 4];\n\n    try {\n      const valeurCaseDeplacement = carte[position[0] + dpl[0]][position[1] + dpl[1]];\n      if (Math.floor(valeurCaseDeplacement / 1000) == 1) return false;\n      if (Math.floor(valeurCaseDeplacement / 10) == 2) return false;\n      if (dplInterditsCases.includes(valeurCaseDeplacement)) return false;\n    } catch (error) {}\n\n    const dplInterditsMurs = [1, 2, 3, 5];\n\n    try {\n      if (dpl[0] != 0) {\n        // haut bas\n        if (dpl[0] < 0) {\n          dpl[0] = 0;\n        }\n\n        if (typeof mursH[position[0] + dpl[0]][position[1]] === 'undefined') return false;\n        if (dplInterditsMurs.includes(mursH[position[0] + dpl[0]][position[1]])) return false;\n      } else {\n        // gauche droite\n        if (dpl[1] < 0) {\n          dpl[1] = 0;\n        }\n\n        if (typeof mursV[position[0]][position[1] + dpl[1]] === 'undefined') return false;\n        if (dplInterditsMurs.includes(mursV[position[0]][position[1] + dpl[1]])) return false;\n      }\n    } catch (error) {}\n\n    return true;\n  };\n\n  const testRelacherHabitant = () => {\n    if (carte[position[0]][position[1]] % 100 < 10) return false; // pas de transport d'habitant\n\n    const mursBloquants = [1, 2, 3, 5];\n    if (position[0] == 0 && !mursBloquants.includes(mursH[position[0]][position[1]])) return true; // haut\n\n    if (position[0] == nbLignesGrille - 1 && !mursBloquants.includes(mursH[position[0] + 1][position[1]])) return true; // bas\n\n    if (position[1] == 0 && !mursBloquants.includes(mursV[position[0]][position[1]])) return true; // gauche\n\n    if (position[1] == nbColonnesGrille - 1 && !mursBloquants.includes(mursV[position[0]][position[1] + 1])) return true; // droite\n\n    return false;\n  };\n\n  const relacherHabitant = () => {\n    if (testRelacherHabitant()) {\n      setTimeout(() => {\n        updateResultats(true);\n        updateCarte(position, carte[position[0]][position[1]] - (carte[position[0]][position[1]] % 100 - carte[position[0]][position[1]] % 10));\n      }, 1000);\n    }\n  };\n\n  const revealHabitant = async () => {\n    if (configuration != null) {\n      const casesAutour = getCasesAutour();\n\n      try {\n        if (casesAutour.dessus == 20) {\n          updateCarte([position[0] - 1, position[1]], 0);\n          resetHistAction();\n          const response = await PlayAPI.revealHabitant(socket, [position[0] - 1, position[1]], 0);\n        }\n      } catch (error) {}\n\n      try {\n        if (casesAutour.droite == 20) {\n          updateCarte([position[0], position[1] + 1], 0);\n          resetHistAction();\n          const response = await PlayAPI.revealHabitant(socket, [position[0], position[1] + 1], 0);\n        }\n      } catch (error) {}\n\n      try {\n        if (casesAutour.dessous == 20) {\n          updateCarte([position[0] + 1, position[1]], 0);\n          resetHistAction();\n          const response = await PlayAPI.revealHabitant(socket, [position[0] + 1, position[1]], 0);\n        }\n      } catch (error) {}\n\n      try {\n        if (casesAutour.gauche == 20) {\n          updateCarte([position[0], position[1] - 1], 0);\n          resetHistAction();\n          const response = await PlayAPI.revealHabitant(socket, [position[0], position[1] - 1], 0);\n        }\n      } catch (error) {}\n    }\n  };\n\n  const getCasesAutour = () => {\n    var cases = {};\n\n    try {\n      cases[\"dessus\"] = carte[position[0] - 1][position[1]]; // dessus\n    } catch (error) {}\n\n    try {\n      cases[\"droite\"] = carte[position[0]][position[1] + 1]; // droite\n    } catch (error) {}\n\n    try {\n      cases[\"dessous\"] = carte[position[0] + 1][position[1]]; // dessous\n    } catch (error) {}\n\n    try {\n      cases[\"gauche\"] = carte[position[0]][position[1] - 1]; // gauche\n    } catch (error) {}\n\n    return cases;\n  };\n\n  const getMursAutour = position => {\n    var murs = [];\n\n    try {\n      if (mursH[position[0]][position[1]] != 4 || mursH[position[0]][position[1] - 1] < 6 && mursH[position[0]][position[1] + 1] < 6) {\n        murs.push(mursH[position[0]][position[1]]); // dessus\n      } else {\n        murs.push(0);\n      }\n    } catch (error) {}\n\n    try {\n      if (mursV[position[0]][position[1] + 1] != 4 || mursV[position[0] - 1][position[1] + 1] < 6 && mursV[position[0] + 1][position[1] + 1] < 6) {\n        murs.push(mursV[position[0]][position[1] + 1]); // droite\n      } else {\n        murs.push(0);\n      }\n    } catch (error) {}\n\n    try {\n      if (mursH[position[0] + 1][position[1]] != 4 || mursH[position[0] + 1][position[1] - 1] < 6 && mursH[position[0] + 1][position[1] + 1] < 6) {\n        murs.push(mursH[position[0] + 1][position[1]]); // dessous\n      } else {\n        murs.push(0);\n      }\n    } catch (error) {}\n\n    try {\n      if (mursV[position[0]][position[1]] != 4 || mursV[position[0] - 1][position[1]] < 6 && mursV[position[0] + 1][position[1]] < 6) {\n        murs.push(mursV[position[0]][position[1]]); // gauche\n      } else {\n        murs.push(0);\n      }\n    } catch (error) {} // console.log(murs)\n\n\n    return murs;\n  };\n\n  const resetHistAction = () => {\n    setTimeout(() => {\n      setHistActions([{\n        carte: JSON.stringify(carte),\n        budget: JSON.stringify(budget),\n        budgetDepense: JSON.stringify(budgetDepense),\n        mursH: JSON.stringify(mursH),\n        mursV: JSON.stringify(mursV),\n        stocks: JSON.stringify(stocks),\n        resultats: JSON.stringify(resultats),\n        interventions: JSON.stringify(interventions)\n      }]);\n    }, 300);\n  };\n\n  const [btnClickedBottom, setBtnClickedBottom] = useState(null);\n  const [propositionsCase, setPropositionsCase] = useState([]); // Extincteurs\n\n  const [propositionMursDetruire, setPropositionMursDetruire] = useState([[], []]); // Horizontaux  , Verticaux\n\n  useEffect(() => {\n    if (btnClickedBottom != 3 || btnClickedBottom == null) {\n      setPropositionMursDetruire([[], []]);\n    }\n\n    if (btnClickedBottom > 2 && btnClickedBottom < 6 || btnClickedBottom == null) {\n      setPropositionsCase([]);\n    }\n  }, [btnClickedBottom]); // HANDLERS CLIC GRILLE\n\n  const handleClicCase = (valeurAvant, valeurApres, coordX, coordY) => {\n    // console.log(valeurAvant, valeurApres, coordX, coordY)\n    try {\n      updateCarte([coordY, coordX], valeurApres);\n      setPropositionsCase([]);\n      setBtnClickedBottom(null);\n\n      if (valeurAvant == 4 && valeurApres == 0) {\n        // Extincteur flamme\n        doAction(\"Feu\");\n      }\n\n      if (valeurAvant == 4 && valeurApres == 3) {\n        // Feu Fumée\n        doAction(\"FeuFum\");\n      }\n\n      if (valeurAvant == 3 && valeurApres == 0) {\n        // Fumée\n        doAction(\"Fum\");\n      }\n\n      if (Math.floor(valeurAvant / 10) == 2 && valeurApres == 0) {\n        // Habitant\n        doAction(\"Habitant\");\n        updateCarte(position, carte[position[0]][position[1]] + valeurAvant % 10);\n      }\n    } catch (error) {}\n  };\n\n  const handleClicMur = (num, valeurAvant, coordX, coordY) => {\n    // marqueur dégat\n    if (propositionMursDetruire[0].length > 0 || propositionMursDetruire[1].length > 0) {\n      const checkInCoords = index => {\n        // console.log(\"coordx\",coordX,\"coordy\",coordY,\"position\",position)\n        let numClic = null;\n\n        if (coordX == position[1] && (coordY < position[0] || coordY == position[0] && num == 0)) {\n          // top\n          numClic = 0; // case en question\n          // console.log(\"top\",numClic)\n        }\n\n        if (coordX == position[1] && (coordY > position[0] || coordY == position[0] && num == 2)) {\n          // bottom\n          numClic = 2; // case en question\n          // console.log(\"bottom\",numClic)\n        }\n\n        if (coordY == position[0] && (coordX < position[1] || coordX == position[1] && num == 3)) {\n          // left\n          numClic = 3; // case en question\n          // console.log(\"left\",numClic)\n        }\n\n        if (coordY == position[0] && (coordX > position[1] || coordX == position[1] && num == 1)) {\n          // right\n          numClic = 1; // case en question\n          // console.log(\"right\",numClic)\n        }\n\n        return numClic;\n      };\n\n      var cote = checkInCoords(num % 2);\n      let valeurApres = 4;\n      if (valeurAvant == 1) valeurApres = 3;\n\n      if (cote != null) {\n        try {\n          switch (cote) {\n            case 0:\n              updateMurH([position[0], position[1]], valeurApres); // if(valeurAvant==5 ||)\n\n              break;\n\n            case 1:\n              updateMurV([position[0], position[1] + 1], valeurApres);\n              break;\n\n            case 2:\n              updateMurH([position[0] + 1, position[1]], valeurApres);\n              break;\n\n            case 3:\n              updateMurV([position[0], position[1]], valeurApres);\n              break;\n          }\n\n          doAction(\"Marqueur\");\n        } catch (error) {}\n\n        setPropositionMursDetruire([[], []]);\n        setBtnClickedBottom(null);\n      }\n    }\n  }; // HANDLER CLICS BOUTONS\n\n\n  const handleClicFleche = num => {\n    // Position y x\n    let deplacement;\n    let rotation;\n\n    switch (num) {\n      case 0:\n        // haut\n        // console.log(\"haut\")\n        deplacement = [-1, 0];\n        rotation = 1;\n        break;\n\n      case 1:\n        // droite\n        // console.log(\"droite\")\n        deplacement = [0, 1];\n        rotation = 2;\n        break;\n\n      case 2:\n        // bas\n        // console.log(\"bas\")\n        deplacement = [1, 0];\n        rotation = 3;\n        break;\n\n      case 3:\n        // gauche\n        // console.log(\"gauche\")\n        deplacement = [0, -1];\n        rotation = 4;\n        break;\n    }\n\n    if (deplacementAutorise(deplacement)) {\n      // ANIMATION MARCHE\n      setDeplacementEnCours({\n        type: 1,\n        rotation: rotation\n      });\n      setTimeout(() => {\n        updateCarte([position[0] + deplacement[0], position[1] + deplacement[1]], carte[position[0]][position[1]] - carte[position[0]][position[1]] % 10 + rotation); // setPosition(position => [position[0] + deplacement[0], position[1] + deplacement[1]])\n\n        doAction(\"Deplacement\");\n        updateCarte(position, 0);\n        setDeplacementEnCours({\n          type: 2,\n          rotation: rotation\n        });\n        setTimeout(() => {\n          setDeplacementEnCours({\n            type: 0,\n            rotation: rotation\n          });\n        }, 500);\n      }, 500);\n    }\n  };\n\n  const handleChangePiece = () => {\n    resetHistAction();\n  };\n\n  const handleClicDoor = ouvrir => {\n    // position, ouvert/fermé\n    setBtnClickedBottom(ouvrir ? 4 : 5);\n    let valueAvant;\n    let valueApres;\n\n    if (ouvrir) {\n      valueAvant = 5;\n      valueApres = 6;\n    } else {\n      valueAvant = 6;\n      valueApres = 5;\n    }\n\n    doAction(\"Porte\");\n\n    try {\n      if (mursH[position[0]][position[1]] == valueAvant) updateMurH([position[0], position[1]], valueApres);\n      if (mursH[position[0] + 1][position[1]] == valueAvant) updateMurH([position[0] + 1, position[1]], valueApres);\n      if (mursV[position[0]][position[1]] == valueAvant) updateMurV([position[0], position[1]], valueApres);\n      if (mursV[position[0]][position[1] + 1] == valueAvant) updateMurV([position[0], position[1] + 1], valueApres);\n    } catch (error) {}\n  };\n\n  const handleClicExtincteur = num => {\n    // 0 FEU, 1 FEUFUM, 2 FUM\n    if (btnClickedBottom != num) {\n      var listeCasesAction = [];\n      let valeurAvant = 4;\n      let valeurApres = 0;\n      setBtnClickedBottom(num);\n\n      switch (num) {\n        case 0:\n          // ETEINDRE FEU\n          break;\n\n        case 1:\n          // FEU FUM\n          valeurApres = 3;\n          break;\n\n        case 2:\n          // ETEINDRE FUMEE\n          valeurAvant = 3;\n          break;\n      }\n\n      try {\n        if (carte[position[0] - 1][position[1]] == valeurAvant) listeCasesAction.push([position[0] - 1, position[1], valeurAvant, valeurApres]); // TOP\n      } catch (error) {}\n\n      try {\n        if (carte[position[0]][position[1] + 1] == valeurAvant) listeCasesAction.push([position[0], position[1] + 1, valeurAvant, valeurApres]); // RIGHT\n      } catch (error) {}\n\n      try {\n        if (carte[position[0] + 1][position[1]] == valeurAvant) listeCasesAction.push([position[0] + 1, position[1], valeurAvant, valeurApres]); // BOTTOM\n      } catch (error) {}\n\n      try {\n        if (carte[position[0]][position[1] - 1] == valeurAvant) listeCasesAction.push([position[0], position[1] - 1, valeurAvant, valeurApres]); // LEFT\n      } catch (error) {}\n\n      setPropositionsCase(listeCasesAction);\n    } else {\n      setBtnClickedBottom(null);\n    }\n  };\n\n  const handleClicMarqueur = () => {\n    if (btnClickedBottom != 3) {\n      setBtnClickedBottom(3);\n\n      if (propositionMursDetruire[0].length > 0 || propositionMursDetruire[1].length > 0) {\n        setPropositionMursDetruire([[], []]);\n      } else {\n        const mursADetruire = [1, 3, 5, 6];\n        var propositions = [[], []];\n        const mursAutour = getMursAutour(position);\n\n        try {\n          if (mursADetruire.includes(mursAutour[0])) propositions[0].push([position[1], position[0]]); // top\n\n          if (mursADetruire.includes(mursAutour[1])) propositions[1].push([position[1] + 1, position[0]]); // right\n\n          if (mursADetruire.includes(mursAutour[2])) propositions[0].push([position[1], position[0] + 1]); // bottom\n\n          if (mursADetruire.includes(mursAutour[3])) propositions[1].push([position[1], position[0]]); // left\n        } catch (error) {}\n\n        setPropositionMursDetruire(propositions);\n      }\n    } else {\n      setBtnClickedBottom(null);\n    }\n  };\n\n  const handleClicValidated = async bool => {\n    // console.log(\"handle Clic\")\n    if (configuration != null) {\n      if (bool) {\n        let prochainPomp = currentPomp + 1;\n        let prochainTour = currentTour;\n        let prochainCycle = currentCycle;\n        let prochaineSequence = currentSequence;\n\n        if (numPompier == configuration.nbPompEquipe.valeur) {\n          // DERNIER POMP DU TOUR\n          if (currentTour == configuration.nbToursParCycle.valeur) {\n            // SEND TO INTER\n            prochainTour = 1;\n            prochainPomp = 0; // A CHANGER AVEC STRATEGIQUE\n\n            if (prochainCycle == configuration.nbCyclesParSequence.valeur) {\n              prochainCycle = 1;\n              prochaineSequence = prochaineSequence + 1;\n            } else {\n              prochainCycle = prochainCycle + 1;\n            }\n          } else {\n            // PAS DERNIER TOUR DU CYCLE\n            // console.log(\"pas dernier tour\")\n            prochainPomp = 1;\n            prochainTour = prochainTour + 1;\n          }\n        } // console.log(prochainPomp,prochainTour,prochainCycle)\n        // console.log(\"budgets fin 1\")\n\n\n        const res = modifyBudgetsFin(currentCycle, currentSequence, prochainPomp, prochainTour, prochainCycle, prochaineSequence);\n        resetHistAction(); // setChrono(null)\n      } else {\n        retourAction();\n        console.log(\"retour\");\n      }\n    }\n  };\n\n  const handleNoClicked = () => {\n    setPropositionMursDetruire([[], []]);\n    setPropositionsCase([]);\n  };\n\n  const handleClicHabitant = () => {\n    if (btnClickedBottom != 6) {\n      setBtnClickedBottom(6);\n      const valeurApres = 0;\n      var listeCasesAction = [];\n\n      try {\n        const valeurDessus = carte[position[0] - 1][position[1]];\n        if (Math.floor(valeurDessus / 10) == 2) listeCasesAction.push([position[0] - 1, position[1], valeurDessus, valeurApres]); // TOP\n      } catch (error) {}\n\n      try {\n        const valeurDroite = carte[position[0]][position[1] + 1];\n        if (Math.floor(valeurDroite / 10) == 2) listeCasesAction.push([position[0], position[1] + 1, valeurDroite, valeurApres]); // RIGHT\n      } catch (error) {}\n\n      try {\n        const valeurDessous = carte[position[0] + 1][position[1]];\n        if (Math.floor(valeurDessous / 10) == 2) listeCasesAction.push([position[0] + 1, position[1], valeurDessous, valeurApres]); // BOTTOM\n      } catch (error) {}\n\n      try {\n        const valeurGauche = carte[position[0]][position[1] - 1];\n        if (Math.floor(valeurGauche / 10) == 2) listeCasesAction.push([position[0], position[1] - 1, valeurGauche, valeurApres]); // LEFT\n      } catch (error) {}\n\n      setPropositionsCase(listeCasesAction); // console.log(\"handle clic habitant\")\n    } else {\n      setBtnClickedBottom(null);\n    }\n  };\n\n  const getRandomCoords = (mini, maxi) => {\n    if (carte !== null && carte !== undefined && carte.length > 0) {\n      var y = Math.floor(Math.random() * (maxi[0] - mini[0])) + mini[0];\n      var x = Math.floor(Math.random() * (maxi[1] - mini[1])) + mini[1];\n      var type = carte[y][x];\n\n      while (Math.floor(type / 1000) == 1 || Math.floor(type / 10) == 2) {\n        y = Math.floor(Math.random() * (maxi[0] - mini[0])) + mini[0];\n        x = Math.floor(Math.random() * (maxi[1] - mini[1])) + mini[1];\n        type = carte[y][x];\n      } // console.log(\"getRandomCoords\", y, x)\n\n\n      return [y, x];\n    }\n\n    return null;\n  };\n\n  const handleMortHab = () => {\n    var r = { ...resultats\n    };\n    r.Decedes = r.Decedes + 1;\n    setResultats(r); // console.log(\"mort d'un habitant\")\n  };\n\n  const handleExplosion = (randomPos, c) => {\n    const mursAutour = getMursAutour(randomPos); // console.log(mursAutour)\n    // MARQUEURS SUR LA CASE QUI EXPLOSE\n\n    mursAutour.forEach((val, index) => {\n      var valeurFin = val;\n      if ([3, 5].includes(val)) valeurFin = 4; // DESTRUCTION TOTALE\n\n      if (valeurFin == 1) valeurFin = 3;\n\n      if (valeurFin == 3 || valeurFin == 4) {\n        switch (index) {\n          case 0:\n            try {\n              updateMurH([randomPos[0], randomPos[1]], valeurFin);\n            } catch {}\n\n            break;\n\n          case 1:\n            try {\n              updateMurV([randomPos[0], randomPos[1] + 1], valeurFin);\n            } catch {}\n\n            break;\n\n          case 2:\n            try {\n              updateMurH([randomPos[0] + 1, randomPos[1]], valeurFin);\n            } catch {}\n\n            break;\n\n          case 3:\n            try {\n              updateMurV([randomPos[0], randomPos[1]], valeurFin);\n            } catch {}\n\n            break;\n        }\n      }\n    }); // PROPAGATION DANS LES DIFFERENTES DIRECTIONS\n\n    const mursInterdits = [1, 2, 3, 5];\n\n    if (randomPos[1] < nbColonnesGrille - 1 && c[randomPos[0]][randomPos[1] + 1] == 4) {\n      // Propagation droite\n      // console.log(\"propa droite\")\n      let j = 1;\n\n      while (randomPos[1] + 1 + j < nbColonnesGrille) {\n        const type = c[randomPos[0]][randomPos[1] + 1 + j];\n\n        if (Math.floor(type / 10) == 2) {\n          c[randomPos[0]][randomPos[1] + 1 + j] = 4;\n          handleMortHab();\n        }\n\n        if (Math.floor(type / 1000) == 1) {\n          if (type % 100 < 10) {\n            c[randomPos[0]][randomPos[1] + 1 + j] = type - (type % 100 - type % 10);\n            handleMortHab();\n          } else {// console.log(\"mort d'un pompier solo\")\n          }\n        }\n\n        if (c[randomPos[0]][randomPos[1] + 1 + j] == 3 || c[randomPos[0]][randomPos[1] + 1 + j] == 0) {\n          c[randomPos[0]][randomPos[1] + 1 + j] = 4;\n          break;\n        }\n\n        const mur = getMursAutour([randomPos[0], randomPos[1] + 1 + j])[1];\n\n        if (mursInterdits.includes(mur)) {\n          try {\n            updateMurV([randomPos[0], randomPos[1] + 2 + j], 4);\n            break;\n          } catch {}\n        }\n\n        j += 1;\n      }\n    }\n\n    if (randomPos[1] > 0 && c[randomPos[0]][randomPos[1] - 1] == 4) {\n      // Propagation gauche\n      // console.log(\"propa gauche\")\n      let j = 1;\n\n      while (randomPos[1] - 1 - j >= 0) {\n        const type = c[randomPos[0]][randomPos[1] - 1 - j];\n\n        if (Math.floor(type / 10) == 2) {\n          c[randomPos[0]][randomPos[1] - 1 - j] = 4;\n          handleMortHab();\n        }\n\n        if (Math.floor(type / 1000) == 1) {\n          if (type % 100 < 10) {\n            c[randomPos[0]][randomPos[1] - 1 - j] = type - (type % 100 - type % 10);\n            handleMortHab();\n          } else {// console.log(\"mort d'un pompier solo\")\n          }\n        }\n\n        if (c[randomPos[0]][randomPos[1] - 1 - j] == 3 || c[randomPos[0]][randomPos[1] - 1 - j] == 0) {\n          c[randomPos[0]][randomPos[1] - 1 - j] = 4; // console.log(\"break type\",randomPos[1]-1-j)\n\n          break;\n        }\n\n        const mur = getMursAutour([randomPos[0], randomPos[1] - 1 - j])[3]; // console.log(murs)\n\n        if (mursInterdits.includes(mur)) {\n          try {\n            updateMurV([randomPos[0], randomPos[1] - j - 1], 4);\n            break;\n          } catch {}\n        }\n\n        j -= 1;\n      }\n    }\n\n    if (randomPos[0] > 0 && c[randomPos[0] - 1][randomPos[1]] == 4) {\n      // Propagation haut\n      // console.log(\"propa haut\")\n      let i = 1;\n\n      while (randomPos[0] - 1 - i >= 0) {\n        const type = c[randomPos[0] - 1 - i][randomPos[1]];\n\n        if (Math.floor(type / 10) == 2) {\n          c[randomPos[0] - 1 - i][randomPos[1]] = 4;\n          handleMortHab();\n        }\n\n        if (Math.floor(type / 1000) == 1) {\n          if (type % 100 < 10) {\n            c[randomPos[0] - 1 - i][randomPos[1]] = type - (type % 100 - type % 10);\n            handleMortHab();\n          } else {// console.log(\"mort d'un pompier solo\")\n          }\n        }\n\n        if (c[randomPos[0] - 1 - i][randomPos[1]] == 3 || c[randomPos[0] - 1 - i][randomPos[1]] == 0) {\n          c[randomPos[0] - 1 - i][randomPos[1]] = 4; // console.log(\"break type\",randomPos[1]-1-j)\n\n          break;\n        }\n\n        const mur = getMursAutour([randomPos[0] - 1 - i, randomPos[1]])[0]; // console.log(murs)\n\n        if (mursInterdits.includes(mur)) {\n          try {\n            updateMurH([randomPos[0] - 1 - i, randomPos[1]], 4);\n            break;\n          } catch {}\n        }\n\n        i -= 1;\n      }\n    }\n\n    if (randomPos[0] < nbLignesGrille - 1 && c[randomPos[0] + 1][randomPos[1]] == 4) {\n      // Propagation bas\n      // console.log(\"propa bas\")\n      let i = 0;\n\n      while (randomPos[0] + 1 + i >= 0) {\n        const type = c[randomPos[0] + 1 + i][randomPos[1]];\n\n        if (Math.floor(type / 10) == 2) {\n          c[randomPos[0] + 1 + i][randomPos[1]] = 4;\n          handleMortHab();\n        }\n\n        if (Math.floor(type / 1000) == 1) {\n          if (type % 100 < 10) {\n            c[randomPos[0] + 1 + i][randomPos[1]] = type - (type % 100 - type % 10);\n            handleMortHab();\n          } else {// console.log(\"mort d'un pompier solo\")\n          }\n        }\n\n        if (c[randomPos[0] + 1 + i][randomPos[1]] == 3 || c[randomPos[0] + 1 + i][randomPos[1]] == 0) {\n          c[randomPos[0] + 1 + i][randomPos[1]] = 4; // console.log(\"break type\")\n\n          break;\n        }\n\n        const mur = getMursAutour([randomPos[0] + 1 + i, randomPos[1]])[2];\n\n        if (mursInterdits.includes(mur)) {\n          try {\n            updateMurH([randomPos[0] + 2 + i, randomPos[1]], 4);\n            break;\n          } catch {}\n        }\n\n        i += 1;\n      }\n    }\n\n    return c;\n  };\n\n  const addFumToCarte = randomPos => {\n    var c = [...carte];\n\n    if (carte !== null && carte !== undefined && carte.length > 0 && randomPos !== null) {\n      // console.log(\"addFumToCarte\", randomPos[0], randomPos[1])\n      switch (c[randomPos[0]][randomPos[1]]) {\n        case 0:\n          // VIDE\n          // console.log(\"vide => fum\")\n          c[randomPos[0]][randomPos[1]] = 3;\n          break;\n\n        case 3:\n          // FUMEE\n          // console.log(\"fum => feu\")\n          c[randomPos[0]][randomPos[1]] = 4;\n          break;\n\n        case 4:\n          // FEU\n          c = handleExplosion(randomPos, c); // console.log(\"feu => explosion\")\n\n          break;\n\n        default:\n          // console.log(\"error\")\n          break;\n      }\n    }\n\n    return c;\n  };\n\n  const embrasementFum = c => {\n    var modified = false;\n\n    if (c !== null && c !== undefined && c.length > 0) {\n      const mursInterdits = [1, 2, 3, 5];\n      var i = -1;\n      var j = -1;\n\n      while (i < nbLignesGrille - 1) {\n        i = i + 1;\n\n        while (j < nbColonnesGrille - 1) {\n          j = j + 1;\n          const mursCote = [mursH[i][j], mursV[i][j + 1], mursH[i + 1][j], mursV[i][j]];\n\n          if (i < c.length && j < c[0].length && c[i][j] == 4) {\n            // ON PARCOURT LES FEUX\n            if (i > 0 && c[i - 1][j] == 3 && !mursInterdits.includes(mursCote[0])) {\n              // juste dessus\n              c[i - 1][j] = 4;\n              modified = true;\n            }\n\n            if (j < nbColonnesGrille - 1 && c[i][j + 1] == 3 && !mursInterdits.includes(mursCote[1])) {\n              // juste droite\n              c[i][j + 1] = 4;\n              modified = true;\n            }\n\n            if (i < nbLignesGrille - 1 && c[i + 1][j] == 3 && !mursInterdits.includes(mursCote[2])) {\n              // juste dessous\n              c[i + 1][j] = 4;\n              modified = true;\n            } else {}\n\n            if (j > 0 && c[i][j - 1] == 3 && !mursInterdits.includes(mursCote[3])) {\n              // GAUCHE\n              c[i][j - 1] = 4;\n              modified = true;\n            }\n          }\n        }\n\n        j = -1;\n      }\n\n      if (modified) {\n        embrasementFum(c);\n        modified = false;\n      } // console.log(mursCote)\n\n    } else {// console.log(\"test\")\n      } // console.log(\"embrasementFum\")\n\n\n    return c;\n  };\n\n  const countHab = carte => {\n    if (carte != null && carte.length > 0) {\n      var count = 0;\n      carte.forEach((ligne, indexI) => {\n        ligne.forEach((valeur, indexJ) => {\n          if (Math.floor(valeur / 10) == 2) {\n            count += 1;\n          }\n        });\n      });\n      return count;\n    }\n  };\n\n  const addHabitants = c => {\n    const count = countHab(c); // console.log(count)\n\n    for (let i = 0; i < configuration.nbHabitantsASauver.valeur - count; i++) {\n      const newPos = getRandomCoords([0, 0], [nbLignesGrille, nbColonnesGrille]);\n      c[newPos[0]][newPos[1]] = 20 + Math.round(Math.random());\n    } // console.log(countHab(c))\n\n\n    return c;\n  };\n\n  const evenementsAleatoire = () => {\n    const randomPos = getRandomCoords([0, 0], [nbLignesGrille, nbColonnesGrille]); // const randomPos=[2,9]\n\n    var c = addFumToCarte(randomPos);\n    c = embrasementFum(c);\n    c = addHabitants(c);\n    return c;\n  }; // const [tester,setTester]=useState(false)\n  // useEffect(()=>{\n  //   if(!tester && carte !== null && carte !== undefined && carte.length>0 && nbLignesGrille>0 && nbColonnesGrille>0){\n  //     setTester(true)\n  //     console.log([...carte])\n  //     evenementsAleatoire()\n  //   }\n  // },[tester,carte,nbLignesGrille,nbColonnesGrille])\n\n\n  const [textes, setTextes] = useState(null);\n  useEffect(() => {\n    const getTextes = async () => {\n      const textes = ContentsAPI.getTexts(\"jeuTactInterface\").then(res => {\n        setTextes(res);\n      });\n    };\n\n    if (textes == null) {\n      getTextes();\n    } // console.log(textes)\n\n  }, [textes]);\n\n  const getText = name => {\n    if (textes == null) {\n      return name;\n    } else {\n      try {\n        return textes[name].contenu;\n      } catch (error) {\n        // console.log(textes)\n        return name;\n      }\n    }\n  };\n\n  const renderAttenteLancement = () => {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        color: \"gray\",\n        textAlign: \"center\",\n        fontSize: 20\n      },\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        children: getText('attenteLancement')\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1571,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        children: getText('infoLancement')\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1572,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1570,\n      columnNumber: 7\n    }, this);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      position: \"absolute\",\n      display: \"flex\",\n      alignItems: \"center\",\n      flexDirection: \"column\",\n      justifyContent: \"center\",\n      flex: 1,\n      width: \"100%\",\n      height: \"100%\"\n    },\n    children: carte.length > 0 && position != null && stocks !== null && numPompier !== null && play ? /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Grille, {\n        nbColonnesGrille: nbColonnesGrille,\n        nbLignesGrille: nbLignesGrille,\n        carte: carte,\n        position: position,\n        mursH: mursH,\n        mursV: mursV,\n        propositionMursDetruire: propositionMursDetruire,\n        propositionsCase: propositionsCase,\n        handleClicMur: handleClicMur,\n        handleClicCase: handleClicCase,\n        handleChangePiece: handleChangePiece,\n        deplacementEnCours: deplacementEnCours\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1586,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(TactBandeauTop, {\n        stocks: stocks,\n        resultats: resultats,\n        numeroPompier: numPompier,\n        sequence: currentSequence,\n        cycle: currentCycle,\n        tour: currentTour,\n        pomp: currentPomp,\n        configuration: configuration,\n        budget: budget,\n        budgetDepense: budgetDepense,\n        equipe: equipe,\n        handleClicValidated: handleClicValidated,\n        play: play,\n        chronoInit: chrono,\n        numEquipe: equipe,\n        numSession: session\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1602,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(TactBandeauBottom, {\n        interventions: interventions,\n        stocks: stocks,\n        numeroPompier: numPompier,\n        tour: currentTour,\n        pomp: currentPomp,\n        handleClicFleche: handleClicFleche,\n        handleClicValidated: handleClicValidated,\n        handleClicDoor: handleClicDoor,\n        handleClicMarqueur: handleClicMarqueur,\n        handleClicExt: handleClicExtincteur,\n        handleNoClicked: handleNoClicked,\n        handleClicHabitant: handleClicHabitant,\n        btnClickedBottom: btnClickedBottom,\n        mursAutour: getMursAutour(position),\n        casesAutour: getCasesAutour(),\n        currentCase: carte[position[0]][position[1]],\n        histActions: histActions,\n        configuration: configuration,\n        deplacementEnCours: deplacementEnCours,\n        budgetMaxAtteint: budgetDepense >= configuration.budgetTourMax.valeur,\n        isLoading: isLoading.current\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1621,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(TactBandeauDroite, {\n        handleDisconnect: handleDisconnect,\n        configuration: configuration\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1644,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true) : renderAttenteLancement()\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 1580,\n    columnNumber: 5\n  }, this);\n};\n\n_s(TactInterface, \"1pEU6O6k99NJu+ZAkZS3+u+IGwI=\", false, function () {\n  return [useHistory];\n});\n\n_c = TactInterface;\nexport default TactInterface;\n\nvar _c;\n\n$RefreshReg$(_c, \"TactInterface\");","map":{"version":3,"sources":["C:/Users/hugod/decitude/client/src/routes/TactInterface.js"],"names":["React","useState","useEffect","useRef","PlayAPI","TactBandeauTop","TactBandeauBottom","Grille","useHistory","Typography","cookie","TactBandeauDroite","ContentsAPI","io","TactInterface","history","user","load","handleDisconnect","save","path","maxAge","push","undefined","role","includes","play","setPlay","numPompier","setNumPompier","replace","currentPomp","setCurrentPomp","currentTour","setCurrentTour","currentCycle","setCurrentCycle","currentSequence","setCurrentSequence","session","setSession","equipe","setEquipe","position","setPosition","deplacementEnCours","setDeplacementEnCours","type","rotation","histActions","setHistActions","chrono","setChrono","configuration","setConfiguration","stocks","setStocks","resultats","setResultats","Decedes","Sauves","interventions","setInterventions","Deplacement","Feu","FeuFum","Fum","Marqueur","Porte","Habitant","budget","setBudget","budgetDepense","setBudgetDepense","isLoading","carte","setCarte","nbLignesGrille","setNbLignesGrille","nbColonnesGrille","setNbColonnesGrille","mursH","setMursH","mursV","setMursV","getPlayState","current","currentPlayState","Object","keys","length","parseInt","JSON","parse","valeur","resultatsDecedes","resultatsSauves","getBudget","c","currrentChrono","chronoTour","getPositionFromCarte","getPlayParameters","param","getConfiguration","forEach","ligne","indexI","indexJ","Math","floor","updateCarte","coords","value","error","updateMurH","m","updateMurV","updateBudget","action","depenses","bd","addHistAction","h","stringify","retourAction","pop","state","doAction","s","i","updateResultats","sauve","res","setBtnClickedBottom","revealHabitant","relacherHabitant","inter","interKeys","min","onTourChange","e","preventDefault","modifyBudgetsFin","cycle","sequence","prochainPomp","prochainTour","prochainCycle","prochaineSequence","getBudgetsPompFin","then","budgetsFin","b","index","numCycle","numSeq","equipements","saveBudgetsPompFin","newCarte","evenementsAleatoire","nouveauTour","socket","nouveauBudget","budgetInter","stocksEq","setSocket","connect","on","data","console","log","y","x","test","deplacementAutorise","deplacement","dpl","dplInterditsCases","valeurCaseDeplacement","dplInterditsMurs","testRelacherHabitant","mursBloquants","setTimeout","casesAutour","getCasesAutour","dessus","resetHistAction","response","droite","dessous","gauche","cases","getMursAutour","murs","btnClickedBottom","propositionsCase","setPropositionsCase","propositionMursDetruire","setPropositionMursDetruire","handleClicCase","valeurAvant","valeurApres","coordX","coordY","handleClicMur","num","checkInCoords","numClic","cote","handleClicFleche","handleChangePiece","handleClicDoor","ouvrir","valueAvant","valueApres","handleClicExtincteur","listeCasesAction","handleClicMarqueur","mursADetruire","propositions","mursAutour","handleClicValidated","bool","nbPompEquipe","nbToursParCycle","nbCyclesParSequence","handleNoClicked","handleClicHabitant","valeurDessus","valeurDroite","valeurDessous","valeurGauche","getRandomCoords","mini","maxi","random","handleMortHab","r","handleExplosion","randomPos","val","valeurFin","mursInterdits","j","mur","addFumToCarte","embrasementFum","modified","mursCote","countHab","count","addHabitants","nbHabitantsASauver","newPos","round","textes","setTextes","getTextes","getTexts","getText","name","contenu","renderAttenteLancement","color","textAlign","fontSize","display","alignItems","flexDirection","justifyContent","flex","width","height","budgetTourMax"],"mappings":"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","sourcesContent":["import \"../styles/App.css\"\r\nimport React, { useState, useEffect, useRef } from 'react'\r\nimport PlayAPI from \"../API/PlayAPI\"\r\nimport TactBandeauTop from \"../components/interfaceJoueur/TactBandeauTop\"\r\nimport TactBandeauBottom from \"../components/interfaceJoueur/TactBandeauBottom\"\r\nimport Grille from \"../components/interfaceJoueur/Grille\"\r\nimport { useHistory } from 'react-router-dom';\r\nimport { Typography } from \"@material-ui/core\"\r\n\r\nimport cookie from 'react-cookies'\r\nimport TactBandeauDroite from \"../components/interfaceJoueur/TactBandeauDroite\"\r\nimport ContentsAPI from \"../API/ContentsAPI\"\r\nimport io from 'socket.io-client'\r\n\r\n\r\nconst TactInterface = () => {\r\n\r\n  const history = useHistory()\r\n  const user = cookie.load(\"user\")\r\n  const handleDisconnect = () => {\r\n    cookie.save('user', \"disconnected\", {\r\n      path: '/',\r\n      maxAge: 60 * 60 * 1.5, //sec\r\n    })\r\n    history.push('/login');\r\n  }\r\n\r\n  if (user === null || user === undefined || user == \"disconnected\") history.push(\"/login\");\r\n  if (user !== null && user !== undefined && user.role !== undefined && !user.role.includes(\"TACT\")) handleDisconnect()\r\n  const [play, setPlay] = useState(false)\r\n\r\n\r\n\r\n  const [numPompier, setNumPompier] = useState(user !== null && user !== undefined && user.role !== undefined ? user.role.replace(\"TACT\", \"\") : null)\r\n  const [currentPomp, setCurrentPomp] = useState(null)\r\n  const [currentTour, setCurrentTour] = useState(null)\r\n  const [currentCycle, setCurrentCycle] = useState(null)\r\n  const [currentSequence, setCurrentSequence] = useState(null)\r\n  const [session, setSession] = useState(user != null ? user.session : null)\r\n  const [equipe, setEquipe] = useState(user != null ? user.equipe : null)\r\n  const [position, setPosition] = useState(null)\r\n  const [deplacementEnCours, setDeplacementEnCours] = useState({\r\n    type: 0,\r\n    rotation: 1\r\n  })\r\n  const [histActions, setHistActions] = useState([])\r\n  const [chrono, setChrono] = useState(null)\r\n  useEffect(() => {\r\n    if (numPompier == null) handleDisconnect()\r\n  }, [numPompier])\r\n\r\n\r\n\r\n\r\n  const [configuration, setConfiguration] = useState(null)\r\n\r\n  const [stocks, setStocks] = useState(null)\r\n\r\n  const [resultats, setResultats] = useState({\r\n    Decedes: 0,\r\n    Sauves: 0\r\n  })\r\n\r\n  const [interventions, setInterventions] = useState({\r\n    Deplacement: 0,\r\n    Feu: 0,\r\n    FeuFum: 0,\r\n    Fum: 0,\r\n    Marqueur: 0,\r\n    Porte: 0,\r\n    Habitant: 0\r\n  })\r\n\r\n  const [budget, setBudget] = useState(0)\r\n  const [budgetDepense, setBudgetDepense] = useState(0)\r\n\r\n\r\n  const isLoading = useRef(false)\r\n\r\n  // INITIALISATION DE LA CARTE\r\n\r\n  // const [carte, setCarte] = useState([\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  // ])\r\n\r\n  const [carte, setCarte] = useState([])\r\n\r\n  const [nbLignesGrille, setNbLignesGrille] = useState(0)\r\n  const [nbColonnesGrille, setNbColonnesGrille] = useState(0)\r\n\r\n  const [mursH, setMursH] = useState([\r\n    [1, 1, 1, 1, 1, 1, 2, 6, 1, 1, 1, 1, 2, 5, 1, 1],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [1, 1, 1, 1, 2, 6, 1, 6, 2, 1, 1, 1, 5, 2, 1, 1],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [1, 1, 1, 1, 1, 1, 6, 2, 1, 1, 1, 1, 1, 1, 1, 1]\r\n  ])\r\n\r\n  const [mursV, setMursV] = useState([\r\n    [1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],\r\n    [2, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],\r\n    [5, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],\r\n    [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1],\r\n    [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 2, 0, 0, 0, 0, 0, 1],\r\n    [1, 0, 0, 0, 0, 0, 2, 0, 0, 0, 5, 0, 0, 0, 0, 0, 1],\r\n    [1, 0, 0, 0, 0, 0, 5, 0, 0, 0, 5, 0, 0, 0, 0, 0, 2],\r\n    [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 2, 0, 0, 0, 0, 0, 5]\r\n  ])\r\n\r\n\r\n\r\n  // GET PLAY PARAMETERS \r\n  const getPlayState = async (session, equipe) => {\r\n    // console.log(\"get play state\")\r\n    if (!isLoading.current) {\r\n      isLoading.current = true\r\n      const currentPlayState = await PlayAPI.getPlayState(session, equipe)\r\n      // console.log(currentPlayState)\r\n      if (Object.keys(currentPlayState).length > 0) {\r\n        // console.log(parseInt(JSON.parse(currentPlayState.currentTour.valeur)))\r\n\r\n        setCurrentPomp(parseInt(JSON.parse(currentPlayState.currentPomp.valeur)))\r\n        setCurrentTour(parseInt(JSON.parse(currentPlayState.currentTour.valeur)))\r\n        setCurrentCycle(parseInt(JSON.parse(currentPlayState.currentCycle.valeur)))\r\n        setCurrentSequence(parseInt(JSON.parse(currentPlayState.currentSequence.valeur)))\r\n\r\n        setMursH(JSON.parse(currentPlayState.mursH.valeur))\r\n        setMursV(JSON.parse(currentPlayState.mursV.valeur))\r\n        setCarte(JSON.parse(currentPlayState.carte.valeur))\r\n        setResultats({\r\n          Decedes: parseInt(JSON.parse(currentPlayState.resultatsDecedes.valeur)),\r\n          Sauves: parseInt(JSON.parse(currentPlayState.resultatsSauves.valeur)),\r\n        })\r\n        setPlay(JSON.parse(currentPlayState.play.valeur))\r\n        // if(parseInt(JSON.parse(currentPlayState.currentPomp.valeur))==1 && parseInt(JSON.parse(currentPlayState.currentTour.valeur))==1){\r\n        getBudget(parseInt(JSON.parse(currentPlayState.currentCycle.valeur)), parseInt(JSON.parse(currentPlayState.currentSequence.valeur)))\r\n        //  }\r\n        const c = parseInt(JSON.parse(currentPlayState.currrentChrono.valeur))\r\n        if (configuration !== null && c <= configuration.chronoTour.valeur && parseInt(JSON.parse(currentPlayState.currentPomp.valeur)) == numPompier) {\r\n          setChrono(c)\r\n        } else {\r\n          setChrono(null)\r\n          // console.log(\"chrono\")\r\n        }\r\n      }\r\n      getPositionFromCarte(JSON.parse(currentPlayState.carte.valeur))\r\n      isLoading.current = false\r\n    }\r\n\r\n  }\r\n\r\n\r\n  useEffect(() => {\r\n    // console.log(carte)\r\n    if (carte.length > 0) {\r\n      setNbLignesGrille(carte.length)\r\n      setNbColonnesGrille(carte[0].length)\r\n      getPositionFromCarte(carte)\r\n    }\r\n\r\n  }, [carte])\r\n\r\n  // useEffect(()=>{\r\n  //   console.log(currentTour)\r\n  // },[currentTour])\r\n\r\n\r\n  useEffect(() => {\r\n    if (session != null && equipe != null && currentTour == null) {\r\n      if (!isLoading.current && configuration !== null) getPlayState(session, equipe)\r\n      getPlayParameters()\r\n      getPositionFromCarte(carte)\r\n    }\r\n  }, [session, equipe, numPompier, configuration])\r\n\r\n  const getPlayParameters = async () => {\r\n    const param = await PlayAPI.getConfiguration(session)\r\n    setConfiguration(param)\r\n  }\r\n\r\n  const getPositionFromCarte = (carte) => {\r\n    if (carte != null && carte.length > 0) {\r\n      carte.forEach((ligne, indexI) => {\r\n        ligne.forEach((valeur, indexJ) => {\r\n\r\n          if (Math.floor(valeur / 1000) == 1 && Math.floor(valeur % 1000 / 100) == numPompier) {\r\n            setPosition([indexI, indexJ])\r\n            setDeplacementEnCours({\r\n              type: 0,\r\n              rotation: valeur % 10\r\n            })\r\n          }\r\n\r\n        })\r\n      });\r\n    }\r\n  }\r\n \r\n\r\n\r\n\r\n\r\n\r\n  // const onTextChange = (e) => {\r\n  //   setNumPompier(e.target.value)\r\n  //   console.log(typeof (e.target.value))\r\n  // }\r\n\r\n  // const onXChange = (e) => {\r\n  //   e.preventDefault()\r\n  //   if (e.target.value.length > 0) {\r\n  //     updateCarte(position, 0)\r\n  //     setPosition(position => [position[0], parseInt(e.target.value)])\r\n  //   } else {\r\n  //     updateCarte(position, 0)\r\n  //     setPosition(position => [position[0], 0])\r\n  //   }\r\n\r\n  // }\r\n  // const onYChange = (e) => {\r\n  //   e.preventDefault()\r\n  //   if (e.target.value.length > 0) {\r\n  //     updateCarte(position, 0)\r\n  //     setPosition(position => [parseInt(e.target.value), position[1]])\r\n  //   } else {\r\n  //     updateCarte(position, 0)\r\n  //     setPosition(position => [0, position[1]])\r\n  //   }\r\n  // }\r\n\r\n\r\n  // UPDATES\r\n  const updateCarte = (coords, value) => {\r\n    if (coords[0] < nbLignesGrille && coords[1] < nbColonnesGrille) {\r\n      try {\r\n        var c = [...carte]\r\n        c[coords[0]][coords[1]] = value\r\n        setCarte(c)\r\n      } catch (error) {\r\n        // console.log(error)\r\n      }\r\n    }\r\n\r\n\r\n  }\r\n  const updateMurH = (coords, value) => {\r\n    if (coords[0] < mursH.length && coords[1] < mursH[0].length) {\r\n      try {\r\n        var m = [...mursH]\r\n        m[coords[0]][coords[1]] = value\r\n        setMursH(m)\r\n\r\n      } catch (error) {\r\n        // console.log(error)\r\n      }\r\n    }\r\n  }\r\n  const updateMurV = (coords, value) => {\r\n    if (coords[0] < mursV.length && coords[1] < mursV[0].length) {\r\n      try {\r\n        var m = [...mursV]\r\n        m[coords[0]][coords[1]] = value\r\n        setMursV(m)\r\n      } catch (error) {\r\n        // console.log(error)\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  // ACTIONS\r\n\r\n  const updateBudget = (action) => {\r\n    var depenses = 0\r\n    if (configuration[\"coutEq\" + action] != null) depenses += configuration[\"coutEq\" + action].valeur\r\n    if (configuration[\"coutInter\" + action] != null) depenses += configuration[\"coutInter\" + action].valeur\r\n    setBudget(budget => budget - depenses)\r\n    setBudgetDepense(bd => bd + depenses)\r\n  }\r\n\r\n\r\n\r\n\r\n  const addHistAction = (budget, budgetDepense) => {\r\n    const h = [...histActions, {\r\n      carte: JSON.stringify(carte),\r\n      budget: JSON.stringify(budget),\r\n      budgetDepense: JSON.stringify(budgetDepense),\r\n      mursH: JSON.stringify(mursH),\r\n      mursV: JSON.stringify(mursV),\r\n      stocks: JSON.stringify(stocks),\r\n      resultats: JSON.stringify(resultats),\r\n      interventions: JSON.stringify(interventions),\r\n      deplacementEnCours: JSON.stringify({\r\n        type: 0,\r\n        rotation: deplacementEnCours.rotation\r\n      })\r\n    }]\r\n\r\n\r\n    setHistActions(h)\r\n  }\r\n\r\n  const retourAction = () => {\r\n    isLoading.current = true\r\n    var h = [...histActions]\r\n    h.pop()\r\n    const state = h[h.length - 1]\r\n\r\n\r\n    setCarte(JSON.parse(state.carte))\r\n    setMursH(JSON.parse(state.mursH))\r\n    setMursV(JSON.parse(state.mursV))\r\n    setStocks(JSON.parse(state.stocks))\r\n    setInterventions(JSON.parse(state.interventions))\r\n    setResultats(JSON.parse(state.resultats))\r\n    setBudget(JSON.parse(state.budget))\r\n    setBudgetDepense(JSON.parse(state.budgetDepense))\r\n\r\n    setDeplacementEnCours(JSON.parse(state.deplacementEnCours))\r\n    setHistActions(h)\r\n\r\n    isLoading.current = false\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (position !== null && stocks !== null && budget > 0 && deplacementEnCours.type == 0 && (histActions[histActions.length - 1] == undefined || budget < histActions[histActions.length - 1].budget)) {\r\n      addHistAction(budget, budgetDepense)\r\n    }\r\n  }, [deplacementEnCours, budgetDepense, stocks])\r\n\r\n  // useEffect(() => {\r\n  //   console.log(\"hist Actions\")\r\n  //   console.log(histActions)\r\n  // }, [histActions])\r\n\r\n  // useEffect(()=>{\r\n  //   if( position!==null && budget>0){\r\n\r\n  //     if(histActions[histActions.length-1]!==undefined && budget<histActions[histActions.length-1].budget ){\r\n\r\n  //       addHistAction(budget)\r\n  //     }\r\n  //   }\r\n  // },[budget])\r\n\r\n  const doAction = (action) => {\r\n    try {\r\n      if (Object.keys(stocks).includes(action)) {\r\n        var s = stocks\r\n        s[action] = s[action] - 1\r\n        setStocks(s)\r\n      }\r\n\r\n    } catch (error) { }\r\n\r\n    try {\r\n      if (Object.keys(interventions).includes(action)) {\r\n        var i = interventions\r\n        i[action] = i[action] - 1\r\n        setInterventions(i)\r\n      }\r\n    } catch (error) { }\r\n\r\n    // setTimeout(() => {\r\n    updateBudget(action)\r\n    // }, 1000);\r\n\r\n  }\r\n\r\n  const updateResultats = (sauve) => {\r\n    var res = { ...resultats }\r\n    if (sauve) {\r\n      res.Sauves += 1\r\n    } else {\r\n      res.Decedes += 1\r\n    }\r\n    // console.log(res)\r\n    setResultats(res)\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n  useEffect(() => {\r\n    setBtnClickedBottom(null)\r\n    revealHabitant()\r\n  }, [position])\r\n\r\n\r\n  useEffect(() => {\r\n    if (carte.length > 0) relacherHabitant()\r\n\r\n  }, [position, mursH, mursV])\r\n\r\n\r\n\r\n\r\n  // useEffect(() => {\r\n  //   console.log(\"Stocks\")\r\n  //   console.log(stocks)\r\n  // }, [stocks])\r\n\r\n\r\n\r\n  useEffect(() => {\r\n    if (configuration != null) {\r\n      var inter = interventions\r\n      const interKeys = Object.keys(inter)\r\n      interKeys.forEach(action => {\r\n        try {\r\n          if (configuration[\"coutInter\" + action].valeur > 0) {\r\n            inter[action] = Math.min(\r\n              configuration[\"coutEq\" + action] != null && configuration[\"coutEq\" + action] != undefined ? Math.floor(budget / (configuration[\"coutInter\" + action].valeur + configuration[\"coutEq\" + action].valeur)) : Math.floor(budget / configuration[\"coutInter\" + action].valeur),\r\n              stocks !== null && stocks[action] != null && stocks[action] != undefined && stocks[action] != \"NaN\" ? stocks[action] : 1000\r\n            )\r\n          }\r\n        } catch (error) {\r\n          // console.log(error, action)\r\n        }\r\n\r\n      })\r\n      setInterventions(inter)\r\n\r\n    } else {\r\n      // getPlayParameters()\r\n    }\r\n  }, [budget, configuration, numPompier, stocks])\r\n\r\n  // SOCKETS\r\n\r\n  // SOCKETS \r\n  const onTourChange = async (e) => {\r\n    e.preventDefault()\r\n    // console.log(\"nouveau tour todo\")\r\n  }\r\n\r\n  const modifyBudgetsFin = async (cycle, sequence,prochainPomp,prochainTour,prochainCycle,prochaineSequence) => {\r\n    // console.log(\"budgets modified 0\")\r\n    PlayAPI.getBudgetsPompFin(session, equipe).then(\r\n      (res) => {\r\n        // console.log(res)\r\n        var budgetsFin = JSON.parse(res.valeur)\r\n\r\n        try {\r\n          budgetsFin.interventions.forEach((b, index) => {\r\n            if (b.numCycle == cycle && b.numSeq == sequence) {\r\n\r\n              budgetsFin[\"interventions\"][index][\"pomp\" + numPompier] = budget\r\n            }\r\n\r\n          })\r\n        } catch (error) {\r\n\r\n        }\r\n\r\n        try {\r\n          budgetsFin.equipements.forEach((e, index) => {\r\n            if (e.numCycle == cycle && e.numSeq == sequence) {\r\n              budgetsFin[\"equipements\"][index][\"Feu\"][\"pomp\" + numPompier] = stocks.Feu\r\n              budgetsFin[\"equipements\"][index][\"FeuFum\"][\"pomp\" + numPompier] = stocks.FeuFum\r\n              budgetsFin[\"equipements\"][index][\"Fum\"][\"pomp\" + numPompier] = stocks.Fum\r\n              budgetsFin[\"equipements\"][index][\"Marqueur\"][\"pomp\" + numPompier] = stocks.Marqueur\r\n            }\r\n\r\n          })\r\n        } catch (error) {\r\n\r\n        }\r\n        // console.log(\"budgets modified 1\")\r\n        PlayAPI.saveBudgetsPompFin(budgetsFin, session, equipe).then(() => {\r\n          const newCarte = evenementsAleatoire()\r\n           PlayAPI.nouveauTour(socket, prochainPomp, newCarte, mursH, mursV, prochaineSequence, prochainCycle, prochainTour, resultats.Decedes, resultats.Sauves, session, equipe, configuration.chronoTour.valeur)\r\n          // return budgetsFin\r\n        }\r\n\r\n\r\n        )\r\n      })\r\n\r\n  }\r\n\r\n  const getBudget = async (cycle, sequence) => {\r\n    var nouveauBudget = await PlayAPI.getBudgetsPompFin(session, equipe)\r\n    nouveauBudget = nouveauBudget.valeur\r\n    nouveauBudget = JSON.parse(nouveauBudget)\r\n\r\n    let budgetInter = 0\r\n    let stocksEq = stocks !== null && stocks !== undefined ? { ...stocks } : { Feu: 0, FeuFum: 0, Fum: 0, Marqueur: 0 }\r\n\r\n    try {\r\n      nouveauBudget.interventions.forEach((b) => {\r\n        if (b.numCycle == cycle && b.numSeq == sequence) {\r\n\r\n          budgetInter = b[\"pomp\" + numPompier]\r\n        }\r\n\r\n      })\r\n    } catch (error) {\r\n\r\n    }\r\n\r\n    try {\r\n      nouveauBudget.equipements.forEach((e) => {\r\n        if (e.numCycle == cycle && e.numSeq == sequence) {\r\n          stocksEq.Feu += e.Feu[\"pomp\" + numPompier]\r\n          stocksEq.FeuFum += e.FeuFum[\"pomp\" + numPompier]\r\n          stocksEq.Fum += e.Fum[\"pomp\" + numPompier]\r\n          stocksEq.Marqueur += e.Marqueur[\"pomp\" + numPompier]\r\n        }\r\n\r\n      })\r\n    } catch (error) {\r\n\r\n    }\r\n\r\n    // console.log(nouveauBudget)\r\n    if (budgetInter !== budget) {\r\n      setBudget(budgetInter)\r\n      setBudgetDepense(0)\r\n\r\n    }\r\n    setStocks(stocksEq)\r\n\r\n\r\n  }\r\n\r\n  const [socket, setSocket] = useState(null)\r\n\r\n  // console.log(socket)\r\n  useEffect(() => {\r\n    if (socket === null && configuration!==null) {\r\n      const s = io.connect(\"https://www.back.leaders-extreme.fr\")\r\n      setSocket(s)\r\n\r\n\r\n      s.on('changementTour', (data) => {\r\n        if (currentPomp != data.currentPomp || currentCycle !== data.currentCycle || currentTour !== data.currentTour || currentSequence !== data.currentSequence) {\r\n          console.log(\"changement tour\")\r\n          getPlayState(session, equipe)\r\n        }\r\n      })\r\n\r\n\r\n      s.on('revealHabitant', (data) => {\r\n        if (carte !== null && carte.length > 0) {\r\n          // console.log(carte[data.y][data.x])\r\n          // console.log(carte[data.y])\r\n          if (carte[data.y][data.x] == 20) {\r\n            // console.log([data.y,data.x])\r\n            updateCarte([data.y, data.x], data.type)\r\n            // console.log(\"socket hab\")\r\n            // console.log(data)\r\n          }\r\n        }\r\n      })\r\n\r\n      s.on('startStopPartie', (data) => {\r\n        getPlayState(session, equipe)\r\n      });\r\n    }\r\n\r\n\r\n\r\n  },[socket,configuration]);\r\n\r\n\r\n\r\n  // TESTS\r\n\r\n  const test = async () => {\r\n\r\n    console.log(\"test function\")\r\n\r\n  }\r\n\r\n\r\n\r\n\r\n  // AUTORISATIONS \r\n  const deplacementAutorise = (deplacement) => {\r\n    // return true\r\n    var dpl = [...deplacement]\r\n    if (dpl[0] == 0 && dpl[1] == 0) return false\r\n    if (position[0] + dpl[0] > carte.length - 1 || position[1] + dpl[1] > carte[0].length - 1 || position[0] + dpl[0] < 0 || position[1] + dpl[1] < 0) return false\r\n\r\n\r\n    const dplInterditsCases = [1000, 20, 3, 4]\r\n\r\n    try {\r\n      const valeurCaseDeplacement = carte[position[0] + dpl[0]][position[1] + dpl[1]]\r\n      if (Math.floor(valeurCaseDeplacement / 1000) == 1) return false\r\n      if (Math.floor(valeurCaseDeplacement / 10) == 2) return false\r\n      if (dplInterditsCases.includes(valeurCaseDeplacement)) return false\r\n    } catch (error) { }\r\n\r\n    const dplInterditsMurs = [1, 2, 3, 5]\r\n    try {\r\n      if (dpl[0] != 0) { // haut bas\r\n        if (dpl[0] < 0) {\r\n          dpl[0] = 0\r\n        }\r\n        if (typeof (mursH[position[0] + dpl[0]][position[1]]) === 'undefined') return false\r\n        if (dplInterditsMurs.includes(mursH[position[0] + dpl[0]][position[1]])) return false\r\n      } else { // gauche droite\r\n        if (dpl[1] < 0) {\r\n          dpl[1] = 0\r\n        }\r\n        if (typeof (mursV[position[0]][position[1] + dpl[1]]) === 'undefined') return false\r\n        if (dplInterditsMurs.includes(mursV[position[0]][position[1] + dpl[1]])) return false\r\n      }\r\n    } catch (error) { }\r\n\r\n\r\n\r\n\r\n    return true\r\n  }\r\n  const testRelacherHabitant = () => {\r\n    if (carte[position[0]][position[1]] % 100 < 10) return false // pas de transport d'habitant\r\n\r\n    const mursBloquants = [1, 2, 3, 5]\r\n\r\n    if (position[0] == 0 && !mursBloquants.includes(mursH[position[0]][position[1]])) return true // haut\r\n    if (position[0] == nbLignesGrille - 1 && !mursBloquants.includes(mursH[position[0] + 1][position[1]])) return true // bas\r\n\r\n    if (position[1] == 0 && !mursBloquants.includes(mursV[position[0]][position[1]])) return true // gauche\r\n    if (position[1] == nbColonnesGrille - 1 && !mursBloquants.includes(mursV[position[0]][position[1] + 1])) return true // droite\r\n\r\n    return false\r\n  }\r\n  const relacherHabitant = () => {\r\n    if (testRelacherHabitant()) {\r\n      setTimeout(() => {\r\n        updateResultats(true)\r\n        updateCarte(position, carte[position[0]][position[1]] - (carte[position[0]][position[1]] % 100 - carte[position[0]][position[1]] % 10))\r\n      }, 1000);\r\n    }\r\n  }\r\n\r\n  const revealHabitant = async () => {\r\n\r\n    if (configuration != null) {\r\n      const casesAutour = getCasesAutour()\r\n\r\n      try {\r\n        if (casesAutour.dessus == 20) {\r\n          updateCarte([position[0] - 1, position[1]], 0)\r\n          resetHistAction()\r\n          const response = await PlayAPI.revealHabitant(socket, [position[0] - 1, position[1]], 0)\r\n        }\r\n      } catch (error) { }\r\n      try {\r\n        if (casesAutour.droite == 20) {\r\n          updateCarte([position[0], position[1] + 1], 0)\r\n          resetHistAction()\r\n          const response = await PlayAPI.revealHabitant(socket, [position[0], position[1] + 1], 0)\r\n\r\n        }\r\n      } catch (error) { }\r\n      try {\r\n        if (casesAutour.dessous == 20) {\r\n          updateCarte([position[0] + 1, position[1]], 0)\r\n          resetHistAction()\r\n          const response = await PlayAPI.revealHabitant(socket, [position[0] + 1, position[1]], 0)\r\n\r\n        }\r\n      } catch (error) { }\r\n      try {\r\n        if (casesAutour.gauche == 20) {\r\n          updateCarte([position[0], position[1] - 1], 0)\r\n          resetHistAction()\r\n          const response = await PlayAPI.revealHabitant(socket, [position[0], position[1] - 1], 0)\r\n\r\n        }\r\n      } catch (error) { }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  const getCasesAutour = () => {\r\n    var cases = {}\r\n\r\n    try {\r\n      cases[\"dessus\"] = (carte[position[0] - 1][position[1]]) // dessus\r\n    } catch (error) { }\r\n    try {\r\n      cases[\"droite\"] = (carte[position[0]][position[1] + 1]) // droite\r\n    } catch (error) { }\r\n    try {\r\n      cases[\"dessous\"] = (carte[position[0] + 1][position[1]]) // dessous\r\n    } catch (error) { }\r\n    try {\r\n      cases[\"gauche\"] = (carte[position[0]][position[1] - 1]) // gauche\r\n    } catch (error) { }\r\n    return cases\r\n  }\r\n  const getMursAutour = (position) => {\r\n    var murs = []\r\n\r\n    try {\r\n      if (mursH[position[0]][position[1]] != 4 || (mursH[position[0]][position[1] - 1] < 6 && mursH[position[0]][position[1] + 1] < 6)) {\r\n        murs.push(mursH[position[0]][position[1]]) // dessus\r\n      } else {\r\n        murs.push(0)\r\n      }\r\n    } catch (error) { }\r\n\r\n    try {\r\n      if (mursV[position[0]][position[1] + 1] != 4 || (mursV[position[0] - 1][position[1] + 1] < 6 && mursV[position[0] + 1][position[1] + 1] < 6)) {\r\n        murs.push(mursV[position[0]][position[1] + 1])  // droite\r\n      } else {\r\n        murs.push(0)\r\n      }\r\n    } catch (error) { }\r\n\r\n    try {\r\n      if (mursH[position[0] + 1][position[1]] != 4 || (mursH[position[0] + 1][position[1] - 1] < 6 && mursH[position[0] + 1][position[1] + 1] < 6)) {\r\n        murs.push(mursH[position[0] + 1][position[1]]) // dessous\r\n      } else {\r\n        murs.push(0)\r\n      }\r\n\r\n    } catch (error) { }\r\n    try {\r\n      if (mursV[position[0]][position[1]] != 4 || (mursV[position[0] - 1][position[1]] < 6 && mursV[position[0] + 1][position[1]] < 6)) {\r\n        murs.push(mursV[position[0]][position[1]])  // gauche\r\n      } else {\r\n        murs.push(0)\r\n      }\r\n    } catch (error) { }\r\n    // console.log(murs)\r\n    return murs\r\n  }\r\n\r\n  const resetHistAction = () => {\r\n    setTimeout(() => {\r\n      setHistActions([{\r\n        carte: JSON.stringify(carte),\r\n        budget: JSON.stringify(budget),\r\n        budgetDepense: JSON.stringify(budgetDepense),\r\n        mursH: JSON.stringify(mursH),\r\n        mursV: JSON.stringify(mursV),\r\n        stocks: JSON.stringify(stocks),\r\n        resultats: JSON.stringify(resultats),\r\n        interventions: JSON.stringify(interventions)\r\n      }])\r\n    }, 300);\r\n  }\r\n\r\n\r\n  const [btnClickedBottom, setBtnClickedBottom] = useState(null)\r\n  const [propositionsCase, setPropositionsCase] = useState([]) // Extincteurs\r\n  const [propositionMursDetruire, setPropositionMursDetruire] = useState([[], []]) // Horizontaux  , Verticaux\r\n  useEffect(() => {\r\n    if (btnClickedBottom != 3 || btnClickedBottom == null) {\r\n      setPropositionMursDetruire([[], []])\r\n    }\r\n    if ((btnClickedBottom > 2 && btnClickedBottom < 6) || btnClickedBottom == null) {\r\n      setPropositionsCase([])\r\n    }\r\n  }, [btnClickedBottom])\r\n\r\n\r\n\r\n\r\n  // HANDLERS CLIC GRILLE\r\n\r\n  const handleClicCase = (valeurAvant, valeurApres, coordX, coordY) => {\r\n\r\n    // console.log(valeurAvant, valeurApres, coordX, coordY)\r\n    try {\r\n      updateCarte([coordY, coordX], valeurApres)\r\n      setPropositionsCase([])\r\n      setBtnClickedBottom(null)\r\n\r\n      if (valeurAvant == 4 && valeurApres == 0) { // Extincteur flamme\r\n        doAction(\"Feu\")\r\n      }\r\n      if (valeurAvant == 4 && valeurApres == 3) { // Feu Fumée\r\n        doAction(\"FeuFum\")\r\n      }\r\n      if (valeurAvant == 3 && valeurApres == 0) { // Fumée\r\n        doAction(\"Fum\")\r\n      }\r\n      if (Math.floor(valeurAvant / 10) == 2 && valeurApres == 0) { // Habitant\r\n        doAction(\"Habitant\")\r\n        updateCarte(position, carte[position[0]][position[1]] + valeurAvant % 10)\r\n      }\r\n    } catch (error) { }\r\n  }\r\n\r\n  const handleClicMur = (num, valeurAvant, coordX, coordY) => { // marqueur dégat\r\n    if (propositionMursDetruire[0].length > 0 || propositionMursDetruire[1].length > 0) {\r\n\r\n      const checkInCoords = (index) => {\r\n        // console.log(\"coordx\",coordX,\"coordy\",coordY,\"position\",position)\r\n\r\n        let numClic = null\r\n\r\n        if (coordX == position[1] && (coordY < position[0] || (coordY == position[0] && num == 0))) { // top\r\n          numClic = 0  // case en question\r\n          // console.log(\"top\",numClic)\r\n        }\r\n        if (coordX == position[1] && (coordY > position[0] || (coordY == position[0] && num == 2))) { // bottom\r\n          numClic = 2  // case en question\r\n          // console.log(\"bottom\",numClic)\r\n        }\r\n        if (coordY == position[0] && (coordX < position[1] || (coordX == position[1] && num == 3))) { // left\r\n          numClic = 3  // case en question\r\n          // console.log(\"left\",numClic)\r\n        }\r\n        if (coordY == position[0] && (coordX > position[1] || (coordX == position[1] && num == 1))) { // right\r\n          numClic = 1  // case en question\r\n          // console.log(\"right\",numClic)\r\n        }\r\n\r\n        return numClic\r\n      }\r\n\r\n      var cote = checkInCoords(num % 2)\r\n      let valeurApres = 4\r\n      if (valeurAvant == 1) valeurApres = 3\r\n\r\n      if (cote != null) {\r\n        try {\r\n          switch (cote) {\r\n            case 0:\r\n              updateMurH([position[0], position[1]], valeurApres)\r\n              // if(valeurAvant==5 ||)\r\n              break;\r\n            case 1:\r\n              updateMurV([position[0], position[1] + 1], valeurApres)\r\n              break;\r\n            case 2:\r\n              updateMurH([position[0] + 1, position[1]], valeurApres)\r\n              break;\r\n            case 3:\r\n              updateMurV([position[0], position[1]], valeurApres)\r\n              break;\r\n          }\r\n\r\n          doAction(\"Marqueur\")\r\n\r\n\r\n        } catch (error) {\r\n        }\r\n\r\n\r\n\r\n        setPropositionMursDetruire([[], []])\r\n        setBtnClickedBottom(null)\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n\r\n  // HANDLER CLICS BOUTONS\r\n\r\n  const handleClicFleche = (num) => {\r\n    // Position y x\r\n    let deplacement\r\n    let rotation\r\n    switch (num) {\r\n      case 0: // haut\r\n        // console.log(\"haut\")\r\n        deplacement = [-1, 0]\r\n        rotation = 1\r\n        break;\r\n\r\n      case 1: // droite\r\n        // console.log(\"droite\")\r\n        deplacement = [0, 1]\r\n        rotation = 2\r\n        break;\r\n\r\n      case 2: // bas\r\n        // console.log(\"bas\")\r\n        deplacement = [1, 0]\r\n        rotation = 3\r\n        break;\r\n\r\n      case 3: // gauche\r\n        // console.log(\"gauche\")\r\n        deplacement = [0, -1]\r\n        rotation = 4\r\n        break;\r\n    }\r\n    if (deplacementAutorise(deplacement)) {\r\n\r\n      // ANIMATION MARCHE\r\n\r\n      setDeplacementEnCours({\r\n        type: 1,\r\n        rotation: rotation\r\n      })\r\n      setTimeout(() => {\r\n        updateCarte([position[0] + deplacement[0], position[1] + deplacement[1]], carte[position[0]][position[1]] - carte[position[0]][position[1]] % 10 + rotation)\r\n        // setPosition(position => [position[0] + deplacement[0], position[1] + deplacement[1]])\r\n        doAction(\"Deplacement\")\r\n        updateCarte(position, 0)\r\n\r\n\r\n        setDeplacementEnCours({\r\n          type: 2,\r\n          rotation: rotation\r\n        })\r\n        setTimeout(() => {\r\n          setDeplacementEnCours({\r\n            type: 0,\r\n            rotation: rotation\r\n          })\r\n        }, 500);\r\n\r\n      }, 500);\r\n\r\n\r\n    }\r\n  }\r\n\r\n  const handleChangePiece = () => {\r\n    resetHistAction()\r\n  }\r\n\r\n  const handleClicDoor = (ouvrir) => { // position, ouvert/fermé\r\n    setBtnClickedBottom(ouvrir ? 4 : 5)\r\n    let valueAvant\r\n    let valueApres\r\n\r\n    if (ouvrir) {\r\n      valueAvant = 5\r\n      valueApres = 6\r\n\r\n    } else {\r\n      valueAvant = 6\r\n      valueApres = 5\r\n    }\r\n    doAction(\"Porte\")\r\n    try {\r\n      if (mursH[position[0]][position[1]] == valueAvant) updateMurH([position[0], position[1]], valueApres)\r\n      if (mursH[position[0] + 1][position[1]] == valueAvant) updateMurH([position[0] + 1, position[1]], valueApres)\r\n      if (mursV[position[0]][position[1]] == valueAvant) updateMurV([position[0], position[1]], valueApres)\r\n      if (mursV[position[0]][position[1] + 1] == valueAvant) updateMurV([position[0], position[1] + 1], valueApres)\r\n    } catch (error) {\r\n\r\n    }\r\n  }\r\n\r\n  const handleClicExtincteur = (num) => {\r\n    // 0 FEU, 1 FEUFUM, 2 FUM\r\n    if (btnClickedBottom != num) {\r\n      var listeCasesAction = []\r\n      let valeurAvant = 4\r\n      let valeurApres = 0\r\n      setBtnClickedBottom(num)\r\n      switch (num) {\r\n        case 0: // ETEINDRE FEU\r\n          break;\r\n\r\n        case 1: // FEU FUM\r\n          valeurApres = 3\r\n          break;\r\n        case 2: // ETEINDRE FUMEE\r\n          valeurAvant = 3\r\n          break;\r\n      }\r\n\r\n      try {\r\n        if (carte[position[0] - 1][position[1]] == valeurAvant) listeCasesAction.push([position[0] - 1, position[1], valeurAvant, valeurApres]) // TOP\r\n      } catch (error) { }\r\n      try {\r\n        if (carte[position[0]][position[1] + 1] == valeurAvant) listeCasesAction.push([position[0], position[1] + 1, valeurAvant, valeurApres]) // RIGHT\r\n      } catch (error) { }\r\n      try {\r\n        if (carte[position[0] + 1][position[1]] == valeurAvant) listeCasesAction.push([position[0] + 1, position[1], valeurAvant, valeurApres]) // BOTTOM\r\n      } catch (error) { }\r\n      try {\r\n        if (carte[position[0]][position[1] - 1] == valeurAvant) listeCasesAction.push([position[0], position[1] - 1, valeurAvant, valeurApres]) // LEFT\r\n      } catch (error) { }\r\n\r\n      setPropositionsCase(listeCasesAction)\r\n    } else {\r\n      setBtnClickedBottom(null)\r\n    }\r\n\r\n  }\r\n\r\n  const handleClicMarqueur = () => {\r\n    if (btnClickedBottom != 3) {\r\n      setBtnClickedBottom(3)\r\n      if (propositionMursDetruire[0].length > 0 || propositionMursDetruire[1].length > 0) {\r\n        setPropositionMursDetruire([[], []])\r\n      } else {\r\n        const mursADetruire = [1, 3, 5, 6]\r\n        var propositions = [\r\n          [],\r\n          []\r\n        ]\r\n        const mursAutour = getMursAutour(position)\r\n\r\n        try {\r\n          if (mursADetruire.includes(mursAutour[0])) propositions[0].push([position[1], position[0]]) // top\r\n          if (mursADetruire.includes(mursAutour[1])) propositions[1].push([position[1] + 1, position[0]]) // right\r\n          if (mursADetruire.includes(mursAutour[2])) propositions[0].push([position[1], position[0] + 1]) // bottom\r\n          if (mursADetruire.includes(mursAutour[3])) propositions[1].push([position[1], position[0]]) // left\r\n\r\n        } catch (error) {\r\n\r\n        }\r\n        setPropositionMursDetruire(propositions)\r\n\r\n      }\r\n    } else {\r\n      setBtnClickedBottom(null)\r\n    }\r\n\r\n\r\n  }\r\n\r\n  const handleClicValidated = async (bool) => {\r\n    // console.log(\"handle Clic\")\r\n    if (configuration != null) {\r\n      if (bool) {\r\n\r\n\r\n        let prochainPomp = currentPomp + 1\r\n        let prochainTour = currentTour\r\n        let prochainCycle = currentCycle\r\n        let prochaineSequence = currentSequence\r\n\r\n\r\n\r\n        if (numPompier == configuration.nbPompEquipe.valeur) { // DERNIER POMP DU TOUR\r\n          if (currentTour == configuration.nbToursParCycle.valeur) { // SEND TO INTER\r\n            prochainTour = 1\r\n            prochainPomp = 0 // A CHANGER AVEC STRATEGIQUE\r\n\r\n            if (prochainCycle == configuration.nbCyclesParSequence.valeur) {\r\n              prochainCycle = 1\r\n              prochaineSequence = prochaineSequence + 1\r\n            } else {\r\n              prochainCycle = prochainCycle + 1\r\n            }\r\n\r\n\r\n\r\n          } else { // PAS DERNIER TOUR DU CYCLE\r\n            // console.log(\"pas dernier tour\")\r\n            prochainPomp = 1\r\n            prochainTour = prochainTour + 1\r\n\r\n\r\n          }\r\n\r\n        }\r\n\r\n        // console.log(prochainPomp,prochainTour,prochainCycle)\r\n\r\n\r\n\r\n        // console.log(\"budgets fin 1\")\r\n        const res = modifyBudgetsFin(currentCycle, currentSequence,prochainPomp,prochainTour,prochainCycle,prochaineSequence)\r\n        \r\n        resetHistAction()\r\n\r\n        // setChrono(null)\r\n      } else {\r\n        retourAction()\r\n        console.log(\"retour\")\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  const handleNoClicked = () => {\r\n    setPropositionMursDetruire([[], []])\r\n    setPropositionsCase([])\r\n  }\r\n\r\n  const handleClicHabitant = () => {\r\n    if (btnClickedBottom != 6) {\r\n      setBtnClickedBottom(6)\r\n      const valeurApres = 0\r\n      var listeCasesAction = []\r\n      try {\r\n        const valeurDessus = carte[position[0] - 1][position[1]]\r\n        if (Math.floor(valeurDessus / 10) == 2) listeCasesAction.push([position[0] - 1, position[1], valeurDessus, valeurApres]) // TOP\r\n      } catch (error) { }\r\n      try {\r\n        const valeurDroite = carte[position[0]][position[1] + 1]\r\n        if (Math.floor(valeurDroite / 10) == 2) listeCasesAction.push([position[0], position[1] + 1, valeurDroite, valeurApres]) // RIGHT\r\n      } catch (error) { }\r\n      try {\r\n        const valeurDessous = carte[position[0] + 1][position[1]]\r\n        if (Math.floor(valeurDessous / 10) == 2) listeCasesAction.push([position[0] + 1, position[1], valeurDessous, valeurApres]) // BOTTOM\r\n      } catch (error) { }\r\n      try {\r\n        const valeurGauche = carte[position[0]][position[1] - 1]\r\n        if (Math.floor(valeurGauche / 10) == 2) listeCasesAction.push([position[0], position[1] - 1, valeurGauche, valeurApres]) // LEFT\r\n      } catch (error) { }\r\n\r\n      setPropositionsCase(listeCasesAction)\r\n\r\n\r\n      // console.log(\"handle clic habitant\")\r\n    } else {\r\n      setBtnClickedBottom(null)\r\n    }\r\n\r\n  }\r\n\r\n\r\n\r\n\r\n  const getRandomCoords = (mini, maxi) => {\r\n    if (carte !== null && carte !== undefined && carte.length > 0) {\r\n      var y = Math.floor(Math.random() * (maxi[0] - mini[0])) + mini[0]\r\n      var x = Math.floor(Math.random() * (maxi[1] - mini[1])) + mini[1]\r\n\r\n      var type = carte[y][x]\r\n      while (Math.floor(type / 1000) == 1 || Math.floor(type / 10) == 2) {\r\n        y = Math.floor(Math.random() * (maxi[0] - mini[0])) + mini[0]\r\n        x = Math.floor(Math.random() * (maxi[1] - mini[1])) + mini[1]\r\n        type = carte[y][x]\r\n      }\r\n      // console.log(\"getRandomCoords\", y, x)\r\n      return [y, x]\r\n    }\r\n    return null\r\n  }\r\n\r\n\r\n\r\n  const handleMortHab=()=>{\r\n    var r = {...resultats}\r\n    r.Decedes=r.Decedes+1\r\n    setResultats(r)\r\n    // console.log(\"mort d'un habitant\")\r\n    \r\n  }\r\n\r\n\r\n  const handleExplosion=(randomPos,c)=>{\r\n    const mursAutour = getMursAutour(randomPos)\r\n    // console.log(mursAutour)\r\n\r\n    // MARQUEURS SUR LA CASE QUI EXPLOSE\r\n    mursAutour.forEach((val,index)=>{\r\n      var valeurFin =val\r\n      if([3,5].includes(val)) valeurFin = 4 // DESTRUCTION TOTALE\r\n      if(valeurFin==1) valeurFin=3\r\n\r\n\r\n\r\n      if(valeurFin==3 || valeurFin==4){\r\n        switch (index) {\r\n          case 0:\r\n            try {\r\n              updateMurH([randomPos[0], randomPos[1]], valeurFin)\r\n            }catch{}\r\n            break;\r\n          case 1:\r\n            try {\r\n              updateMurV([randomPos[0], randomPos[1] + 1], valeurFin)\r\n            }catch{}\r\n            \r\n            break;\r\n          case 2:\r\n            try {\r\n              updateMurH([randomPos[0] + 1, randomPos[1]], valeurFin)\r\n            }catch{}\r\n           \r\n            break;\r\n          case 3:\r\n            try {\r\n              updateMurV([randomPos[0], randomPos[1]], valeurFin)\r\n            }catch{}\r\n            \r\n            break;\r\n        }\r\n      \r\n      }\r\n    })\r\n\r\n    // PROPAGATION DANS LES DIFFERENTES DIRECTIONS\r\n\r\n    const mursInterdits= [1,2,3,5]\r\n    if(randomPos[1]<nbColonnesGrille-1 && c[randomPos[0]][randomPos[1]+1]==4){ // Propagation droite\r\n      // console.log(\"propa droite\")\r\n      let j=1\r\n      while(randomPos[1]+1+j<nbColonnesGrille){\r\n        \r\n        const type = c[randomPos[0]][randomPos[1]+1+j]\r\n        if(Math.floor( type/ 10)==2){\r\n          c[randomPos[0]][randomPos[1]+1+j]=4\r\n          handleMortHab()\r\n        }\r\n\r\n        if(Math.floor(type / 1000) == 1){\r\n          if (type % 100 < 10){\r\n            c[randomPos[0]][randomPos[1]+1+j]=type - (type % 100 - type % 10)\r\n            handleMortHab()\r\n          }else{\r\n            // console.log(\"mort d'un pompier solo\")\r\n          }\r\n        } \r\n\r\n\r\n        if(c[randomPos[0]][randomPos[1]+1+j]==3 || c[randomPos[0]][randomPos[1]+1+j] ==0) {\r\n          c[randomPos[0]][randomPos[1]+1+j]=4\r\n          break\r\n        }\r\n        const mur = getMursAutour([randomPos[0],randomPos[1]+1+j])[1]\r\n        if(mursInterdits.includes(mur)) {\r\n            try {\r\n              updateMurV([randomPos[0], randomPos[1] + 2 +j], 4)\r\n              break\r\n            }catch{}\r\n          \r\n        }\r\n        j+=1\r\n        \r\n      }\r\n    }\r\n    if(randomPos[1]>0 && c[randomPos[0]][randomPos[1]-1]==4){ // Propagation gauche\r\n      // console.log(\"propa gauche\")\r\n      let j=1\r\n      while(randomPos[1]-1-j>=0){\r\n        \r\n        const type = c[randomPos[0]][randomPos[1]-1-j]\r\n        if(Math.floor( type/ 10)==2){\r\n          c[randomPos[0]][randomPos[1]-1-j]=4\r\n          handleMortHab()\r\n        }\r\n\r\n        if(Math.floor(type / 1000) == 1){\r\n          if (type % 100 < 10){\r\n            c[randomPos[0]][randomPos[1]-1-j]=type - (type % 100 - type % 10)\r\n            handleMortHab()\r\n          }else{\r\n            // console.log(\"mort d'un pompier solo\")\r\n          }\r\n        } \r\n\r\n\r\n        if(c[randomPos[0]][randomPos[1]-1-j]==3 || c[randomPos[0]][randomPos[1]-1-j] ==0) {\r\n          c[randomPos[0]][randomPos[1]-1-j]=4\r\n          // console.log(\"break type\",randomPos[1]-1-j)\r\n          break\r\n        }\r\n        const mur = getMursAutour([randomPos[0],randomPos[1]-1-j])[3]\r\n        // console.log(murs)\r\n        if(mursInterdits.includes(mur)) {\r\n            try {\r\n              updateMurV([randomPos[0], randomPos[1]-j-1], 4)\r\n              break\r\n            }catch{}\r\n          \r\n        }\r\n        j-=1\r\n        \r\n      }\r\n    }\r\n    if(randomPos[0]>0 && c[randomPos[0]-1][randomPos[1]]==4){ // Propagation haut\r\n      // console.log(\"propa haut\")\r\n      let i=1\r\n      while(randomPos[0]-1-i>=0){\r\n        \r\n        const type = c[randomPos[0]-1-i][randomPos[1]]\r\n        if(Math.floor( type/ 10)==2){\r\n          c[randomPos[0]-1-i][randomPos[1]]=4\r\n          handleMortHab()\r\n        }\r\n\r\n        if(Math.floor(type / 1000) == 1){\r\n          if (type % 100 < 10){\r\n            c[randomPos[0]-1-i][randomPos[1]]=type - (type % 100 - type % 10)\r\n            handleMortHab()\r\n          }else{\r\n            // console.log(\"mort d'un pompier solo\")\r\n          }\r\n        } \r\n\r\n\r\n        if(c[randomPos[0]-1-i][randomPos[1]]==3 || c[randomPos[0]-1-i][randomPos[1]] ==0) {\r\n          c[randomPos[0]-1-i][randomPos[1]]=4\r\n          // console.log(\"break type\",randomPos[1]-1-j)\r\n          break\r\n        }\r\n        const mur = getMursAutour([randomPos[0]-1-i,randomPos[1]])[0]\r\n        // console.log(murs)\r\n        if(mursInterdits.includes(mur)) {\r\n            try {\r\n              updateMurH([randomPos[0]-1-i,randomPos[1]], 4)\r\n              break\r\n            }catch{}\r\n          \r\n        }\r\n        i-=1\r\n        \r\n      }\r\n    }\r\n\r\n    if(randomPos[0]<nbLignesGrille-1 && c[randomPos[0]+1][randomPos[1]]==4){ // Propagation bas\r\n      // console.log(\"propa bas\")\r\n      let i=0\r\n      while(randomPos[0]+1+i>=0){\r\n        \r\n        const type = c[randomPos[0]+1+i][randomPos[1]]\r\n        if(Math.floor( type/ 10)==2){\r\n          c[randomPos[0]+1+i][randomPos[1]]=4\r\n          handleMortHab()\r\n        }\r\n\r\n        if(Math.floor(type / 1000) == 1){\r\n          if (type % 100 < 10){\r\n            c[randomPos[0]+1+i][randomPos[1]]=type - (type % 100 - type % 10)\r\n            handleMortHab()\r\n          }else{\r\n            // console.log(\"mort d'un pompier solo\")\r\n          }\r\n        } \r\n\r\n\r\n        if(c[randomPos[0]+1+i][randomPos[1]]==3 || c[randomPos[0]+1+i][randomPos[1]] ==0) {\r\n          c[randomPos[0]+1+i][randomPos[1]]=4\r\n          // console.log(\"break type\")\r\n\r\n          break\r\n        }\r\n        const mur = getMursAutour([randomPos[0]+1+i,randomPos[1]])[2]\r\n        if(mursInterdits.includes(mur)) {\r\n            try {\r\n              updateMurH([randomPos[0]+2+i,randomPos[1]], 4)\r\n              break\r\n            }catch{}\r\n          \r\n        }\r\n        i+=1\r\n        \r\n      }\r\n    }\r\n    return c\r\n\r\n  }\r\n\r\n  const addFumToCarte = (randomPos) => {\r\n\r\n    var c = [...carte]\r\n    if (carte !== null && carte !== undefined && carte.length > 0 && randomPos !== null) {\r\n      // console.log(\"addFumToCarte\", randomPos[0], randomPos[1])\r\n\r\n      switch (c[randomPos[0]][randomPos[1]]) {\r\n        case 0: // VIDE\r\n        // console.log(\"vide => fum\")\r\n          c[randomPos[0]][randomPos[1]] = 3\r\n          break;\r\n\r\n        case 3: // FUMEE\r\n        // console.log(\"fum => feu\")\r\n          c[randomPos[0]][randomPos[1]] = 4\r\n          break;\r\n\r\n        case 4: // FEU\r\n\r\n          c=handleExplosion(randomPos,c)\r\n\r\n          // console.log(\"feu => explosion\")\r\n          break;\r\n\r\n        default:\r\n          // console.log(\"error\")\r\n          break;\r\n      }\r\n    }\r\n    return c\r\n  }\r\n\r\n\r\n  const embrasementFum = (c) => {\r\n    var modified = false\r\n    if (c !== null && c !== undefined && c.length > 0) {\r\n      const mursInterdits = [1, 2, 3, 5]\r\n      var i = -1\r\n      var j = -1\r\n      \r\n      while (i < nbLignesGrille - 1 ) {\r\n        i = i + 1\r\n        while (j < nbColonnesGrille - 1 ) {\r\n          j = j + 1\r\n          const mursCote = [mursH[i][j], mursV[i][j + 1], mursH[i + 1][j], mursV[i][j]]\r\n\r\n          if (i < c.length && j < c[0].length && c[i][j] == 4) { // ON PARCOURT LES FEUX\r\n            if (i > 0 && c[i - 1][j] == 3 && !mursInterdits.includes(mursCote[0])) {// juste dessus\r\n              c[i - 1][j] = 4\r\n              modified = true\r\n            }\r\n            if (j < nbColonnesGrille - 1 && c[i][j + 1] == 3 && !mursInterdits.includes(mursCote[1])) { // juste droite\r\n              c[i][j + 1] = 4\r\n              modified = true\r\n            }\r\n            if (i < nbLignesGrille - 1 && c[i + 1][j] == 3 && !mursInterdits.includes(mursCote[2])) { // juste dessous\r\n              c[i + 1][j] = 4\r\n              modified = true\r\n            }else{\r\n              \r\n            }\r\n            if (j > 0 && c[i][j - 1] == 3 && !mursInterdits.includes(mursCote[3])) { // GAUCHE\r\n              c[i][j - 1] = 4 \r\n              modified = true\r\n            }\r\n            \r\n          }\r\n        }\r\n        j = -1\r\n      }\r\n\r\n      if(modified){\r\n          embrasementFum(c)\r\n        \r\n        modified = false\r\n      }\r\n\r\n\r\n\r\n\r\n      // console.log(mursCote)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n      \r\n    }else{\r\n      // console.log(\"test\")\r\n    }\r\n    // console.log(\"embrasementFum\")\r\n    return c\r\n  }\r\n  const countHab = (carte) => {\r\n    if (carte != null && carte.length > 0) {\r\n      var count = 0\r\n      carte.forEach((ligne, indexI) => {\r\n        ligne.forEach((valeur, indexJ) => {\r\n\r\n          if (Math.floor(valeur / 10) == 2) {\r\n            count+=1\r\n          }\r\n\r\n        })\r\n      });\r\n      return count\r\n    }\r\n   \r\n  }\r\n\r\n  const addHabitants=(c)=>{\r\n    const count = countHab(c)\r\n    // console.log(count)\r\n    for(let i=0;i<configuration.nbHabitantsASauver.valeur-count;i++){\r\n      const newPos = getRandomCoords([0, 0], [nbLignesGrille, nbColonnesGrille])\r\n      c[newPos[0]][newPos[1]]=20+Math.round(Math.random())\r\n    }\r\n    // console.log(countHab(c))\r\n    return c\r\n\r\n  }\r\n\r\n\r\n  const evenementsAleatoire = () => {\r\n    const randomPos = getRandomCoords([0, 0], [nbLignesGrille, nbColonnesGrille])\r\n    // const randomPos=[2,9]\r\n    var c = addFumToCarte(randomPos)\r\n    c = embrasementFum(c)\r\n    c = addHabitants(c)\r\n    return c\r\n  }\r\n\r\n\r\n  // const [tester,setTester]=useState(false)\r\n\r\n\r\n  // useEffect(()=>{\r\n  //   if(!tester && carte !== null && carte !== undefined && carte.length>0 && nbLignesGrille>0 && nbColonnesGrille>0){\r\n  //     setTester(true)\r\n  //     console.log([...carte])\r\n  //     evenementsAleatoire()\r\n      \r\n  //   }\r\n\r\n    \r\n  // },[tester,carte,nbLignesGrille,nbColonnesGrille])\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  const [textes, setTextes] = useState(null)\r\n\r\n  useEffect(() => {\r\n    const getTextes = async () => {\r\n      const textes = ContentsAPI.getTexts(\"jeuTactInterface\").then(\r\n        (res) => { setTextes(res) }\r\n      )\r\n    }\r\n    if (textes == null) {\r\n      getTextes()\r\n    }\r\n    // console.log(textes)\r\n  }, [textes])\r\n\r\n\r\n\r\n\r\n  const getText = (name) => {\r\n    if (textes == null) {\r\n      return name\r\n    } else {\r\n      try {\r\n        return textes[name].contenu\r\n      } catch (error) {\r\n        // console.log(textes)\r\n        return name\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  const renderAttenteLancement = () => {\r\n\r\n    return (\r\n      <div style={{ color: \"gray\", textAlign: \"center\", fontSize: 20 }}>\r\n        <Typography >{getText('attenteLancement')}</Typography>\r\n        <Typography >{getText('infoLancement')}</Typography>\r\n      </div>\r\n    )\r\n  }\r\n  return (\r\n\r\n\r\n\r\n    <div style={{ position: \"absolute\", display: \"flex\", alignItems: \"center\", flexDirection: \"column\", justifyContent: \"center\", flex: 1, width: \"100%\", height: \"100%\" }}>\r\n\r\n      {\r\n        carte.length > 0 && position != null && stocks !== null && numPompier !== null && play ?\r\n          <>\r\n\r\n            <Grille\r\n              nbColonnesGrille={nbColonnesGrille}\r\n              nbLignesGrille={nbLignesGrille}\r\n              carte={carte}\r\n              position={position}\r\n              mursH={mursH}\r\n              mursV={mursV}\r\n              propositionMursDetruire={propositionMursDetruire}\r\n              propositionsCase={propositionsCase}\r\n              handleClicMur={handleClicMur}\r\n              handleClicCase={handleClicCase}\r\n              handleChangePiece={handleChangePiece}\r\n              deplacementEnCours={deplacementEnCours}\r\n\r\n            />\r\n\r\n            <TactBandeauTop\r\n              stocks={stocks}\r\n              resultats={resultats}\r\n              numeroPompier={numPompier}\r\n              sequence={currentSequence}\r\n              cycle={currentCycle}\r\n              tour={currentTour}\r\n              pomp={currentPomp}\r\n              configuration={configuration}\r\n              budget={budget}\r\n              budgetDepense={budgetDepense}\r\n              equipe={equipe}\r\n              handleClicValidated={handleClicValidated}\r\n              play={play}\r\n              chronoInit={chrono}\r\n              numEquipe={equipe}\r\n              numSession={session}\r\n            />\r\n\r\n            <TactBandeauBottom\r\n              interventions={interventions}\r\n              stocks={stocks}\r\n              numeroPompier={numPompier}\r\n              tour={currentTour}\r\n              pomp={currentPomp}\r\n              handleClicFleche={handleClicFleche}\r\n              handleClicValidated={handleClicValidated}\r\n              handleClicDoor={handleClicDoor}\r\n              handleClicMarqueur={handleClicMarqueur}\r\n              handleClicExt={handleClicExtincteur}\r\n              handleNoClicked={handleNoClicked}\r\n              handleClicHabitant={handleClicHabitant}\r\n              btnClickedBottom={btnClickedBottom}\r\n              mursAutour={getMursAutour(position)}\r\n              casesAutour={getCasesAutour()}\r\n              currentCase={carte[position[0]][position[1]]}\r\n              histActions={histActions}\r\n              configuration={configuration}\r\n              deplacementEnCours={deplacementEnCours}\r\n              budgetMaxAtteint={budgetDepense >= configuration.budgetTourMax.valeur}\r\n              isLoading={isLoading.current}\r\n            />\r\n            <TactBandeauDroite\r\n              handleDisconnect={handleDisconnect}\r\n              configuration={configuration}\r\n            />\r\n          </>\r\n          :\r\n          renderAttenteLancement()\r\n\r\n      }\r\n    </div>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  );\r\n\r\n}\r\n\r\nexport default TactInterface;\r\n"]},"metadata":{},"sourceType":"module"}