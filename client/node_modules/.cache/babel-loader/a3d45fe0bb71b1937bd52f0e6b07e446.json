{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/hugod/decitude/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/hugod/decitude/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/hugod/decitude/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import\"../styles/AdminInterface.css\";import\"../styles/App.css\";import React,{useState,useEffect,useRef}from'react';import PlayAPI from\"../API/PlayAPI\";import{useHistory}from'react-router-dom';import{TextField,Button,Divider,Typography}from\"@material-ui/core\";import io from'socket.io-client';import cookie from'react-cookies';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var AdminInterface=function AdminInterface(){console.log(\"admin\");var history=useHistory();var user=cookie.load(\"user\");var handleDisconnect=function handleDisconnect(){console.log(\"handleDisconnect\");cookie.save('user',\"disconnected\",{path:'/',maxAge:60*60*1.5//sec\n});history.push('/login');};if(user===null||user===undefined||user==\"disconnected\")history.push(\"/login\");if(user!==null&&user!==undefined&&user.role!==undefined&&!user.role.includes(\"ADMIN\"))handleDisconnect();var _useState=useState(user!==null&&user!==undefined?user.session:null),_useState2=_slicedToArray(_useState,2),session=_useState2[0],setSession=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),configuration=_useState4[0],setConfiguration=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),lancement=_useState6[0],setLancement=_useState6[1];var isLoading=useRef(false);var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),socket=_useState8[0],setSocket=_useState8[1];useEffect(function(){if(socket==null&&configuration!==null){var s=io.connect(\"https://www.back.leaders-extreme.fr\");setSocket(s);s.on('startStopPartie',function(data){setLancement(!data.start);console.log(!data.start);});}});var getPlayParameters=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(configuration===null)){_context.next=6;break;}_context.t0=setConfiguration;_context.next=4;return PlayAPI.getConfiguration(session);case 4:_context.t1=_context.sent;(0,_context.t0)(_context.t1);case 6:case\"end\":return _context.stop();}}},_callee);}));return function getPlayParameters(){return _ref.apply(this,arguments);};}();useEffect(function(){getPlayState(session);},[configuration]);var getPlayState=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(session){var currentPlayState;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(!isLoading.current&&configuration!=null)){_context2.next=9;break;}isLoading.current=true;_context2.next=4;return PlayAPI.getPlayState(session,null);case 4:currentPlayState=_context2.sent;if(currentPlayState!==undefined){setLancement(!JSON.parse(currentPlayState.valeur));}else{console.log(\"error\");}// getPositionFromCarte(JSON.parse(currentPlayState.carte.valeur))\nisLoading.current=false;_context2.next=10;break;case 9:console.log(configuration);case 10:case\"end\":return _context2.stop();}}},_callee2);}));return function getPlayState(_x){return _ref2.apply(this,arguments);};}();useEffect(function(){getPlayParameters();});var handleClicLancement=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return PlayAPI.startStopPartie(socket,session,lancement);case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function handleClicLancement(){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"body-admin\",children:[/*#__PURE__*/_jsx(Typography,{variant:\"h1\",color:\"primary\",children:\"Espace administrateur\"}),/*#__PURE__*/_jsx(\"div\",{className:\"admin-buttons-container\",children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",className:\"admin-button\",color:lancement?\"default\":\"primary\",onClick:handleClicLancement// disabled={lancement}\n,children:lancement?\"Lancer la partie\":\"Arrêter la partie\"})})]});};export default AdminInterface;","map":{"version":3,"sources":["C:/Users/hugod/decitude/client/src/routes/AdminInterface.js"],"names":["React","useState","useEffect","useRef","PlayAPI","useHistory","TextField","Button","Divider","Typography","io","cookie","AdminInterface","console","log","history","user","load","handleDisconnect","save","path","maxAge","push","undefined","role","includes","session","setSession","configuration","setConfiguration","lancement","setLancement","isLoading","socket","setSocket","s","connect","on","data","start","getPlayParameters","getConfiguration","getPlayState","current","currentPlayState","JSON","parse","valeur","handleClicLancement","startStopPartie"],"mappings":"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","sourcesContent":["import \"../styles/AdminInterface.css\"\r\nimport \"../styles/App.css\"\r\nimport React, { useState, useEffect, useRef } from 'react'\r\nimport PlayAPI from \"../API/PlayAPI\"\r\nimport { useHistory } from 'react-router-dom';\r\nimport { TextField, Button, Divider, Typography } from \"@material-ui/core\"\r\nimport io from 'socket.io-client'\r\n\r\nimport cookie from 'react-cookies'\r\n\r\nconst AdminInterface = () => {\r\n  console.log(\"admin\")\r\n  const history = useHistory()\r\n\r\n\r\n  const user = cookie.load(\"user\")\r\n  \r\n  const handleDisconnect = () => {\r\n    console.log(\"handleDisconnect\")\r\n    cookie.save('user', \"disconnected\", {\r\n      path: '/',\r\n      maxAge: 60 * 60 * 1.5, //sec\r\n    })\r\n    history.push('/login');\r\n  }\r\n\r\n\r\n  if (user === null || user === undefined || user==\"disconnected\") history.push(\"/login\");\r\n  if(user !== null && user !== undefined && user.role!==undefined && !user.role.includes(\"ADMIN\")) handleDisconnect()\r\n\r\n  const [session, setSession] = useState(user !== null && user !== undefined ? user.session : null)\r\n \r\n  const [configuration, setConfiguration] = useState(null)\r\n\r\n\r\n  const [lancement,setLancement]=useState(true)\r\n  const isLoading = useRef(false)\r\n\r\n  const [socket, setSocket] = useState(null)\r\n  useEffect(() => {\r\n    if (socket == null && configuration!==null) {\r\n      const s = io.connect(\"https://www.back.leaders-extreme.fr\")\r\n      setSocket(s)\r\n      s.on('startStopPartie', (data) => {\r\n        setLancement(!data.start)\r\n        console.log(!data.start)\r\n    });  \r\n}\r\n  })\r\n\r\nconst getPlayParameters=async()=>{\r\n  if(configuration===null){\r\n    setConfiguration(await PlayAPI.getConfiguration(session))\r\n  }\r\n}\r\nuseEffect(()=>{\r\n  getPlayState(session)\r\n},[configuration])\r\n\r\nconst getPlayState = async(session) => {\r\n    \r\n  if (!isLoading.current && configuration != null) {\r\n    \r\n    isLoading.current = true\r\n    const currentPlayState = await PlayAPI.getPlayState(session, null)\r\n    if (currentPlayState!==undefined) {\r\n      setLancement(!JSON.parse(currentPlayState.valeur))\r\n    }else{\r\n      console.log(\"error\")\r\n    }\r\n    // getPositionFromCarte(JSON.parse(currentPlayState.carte.valeur))\r\n    isLoading.current = false\r\n  }else{\r\n    console.log(configuration)\r\n  }\r\n\r\n}\r\n\r\nuseEffect(()=>{\r\n  getPlayParameters()\r\n})\r\n\r\n\r\n  const handleClicLancement=async()=>{\r\n    await PlayAPI.startStopPartie(socket,session,lancement)\r\n  }\r\n\r\n  return (\r\n  <div\r\n        className=\"body-admin\"\r\n      >\r\n\r\n        <Typography variant=\"h1\" color=\"primary\">Espace administrateur</Typography>\r\n\r\n    <div className=\"admin-buttons-container\">\r\n        <Button\r\n          variant=\"contained\"\r\n          \r\n          className=\"admin-button\"\r\n          color={lancement ?   \"default\" : \"primary\"}\r\n          onClick={handleClicLancement}\r\n          // disabled={lancement}\r\n        >\r\n          {lancement ? \"Lancer la partie\" : \"Arrêter la partie\"}\r\n        </Button>\r\n       \r\n      </div>\r\n \r\n</div>\r\n );\r\n}\r\n\r\nexport default AdminInterface;\r\n\r\n"]},"metadata":{},"sourceType":"module"}