{"ast":null,"code":"import _objectSpread from\"C:/Users/hugod/decitude/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"C:/Users/hugod/decitude/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"C:/Users/hugod/decitude/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/hugod/decitude/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/hugod/decitude/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import\"../styles/App.css\";import React,{useState,useEffect,useRef}from'react';import PlayAPI from\"../API/PlayAPI\";import TactBandeauTop from\"../components/interfaceJoueur/TactBandeauTop\";import TactBandeauBottom from\"../components/interfaceJoueur/TactBandeauBottom\";import Grille from\"../components/interfaceJoueur/Grille\";import{useHistory}from'react-router-dom';import cookie from'react-cookies';import TactBandeauDroite from\"../components/interfaceJoueur/TactBandeauDroite\";import{Typography}from\"@material-ui/core\";import ContentsAPI from\"../API/ContentsAPI\";import io from'socket.io-client';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var TactInterface=function TactInterface(){var history=useHistory();var user=cookie.load(\"user\");var _useState=useState(null),_useState2=_slicedToArray(_useState,2),socket=_useState2[0],setSocket=_useState2[1];var handleDisconnect=function handleDisconnect(){if(socket!==null){socket.disconnect();}cookie.save('user',\"disconnected\",{path:'/',maxAge:60*60*1.5//sec\n});history.push('/login');};if(user===null||user===undefined||user==\"disconnected\")history.push(\"/login\");if(user!==null&&user!==undefined&&user.role!==undefined&&!user.role.includes(\"TACT\"))handleDisconnect();var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),play=_useState4[0],setPlay=_useState4[1];var _useState5=useState(user!==null&&user!==undefined&&user.role!==undefined?user.role.replace(\"TACT\",\"\"):null),_useState6=_slicedToArray(_useState5,2),numPompier=_useState6[0],setNumPompier=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),currentPomp=_useState8[0],setCurrentPomp=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),currentTour=_useState10[0],setCurrentTour=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),currentCycle=_useState12[0],setCurrentCycle=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),currentSequence=_useState14[0],setCurrentSequence=_useState14[1];var _useState15=useState(user!=null?user.session:null),_useState16=_slicedToArray(_useState15,2),session=_useState16[0],setSession=_useState16[1];var _useState17=useState(user!=null?user.equipe:null),_useState18=_slicedToArray(_useState17,2),equipe=_useState18[0],setEquipe=_useState18[1];var _useState19=useState(null),_useState20=_slicedToArray(_useState19,2),position=_useState20[0],setPosition=_useState20[1];var _useState21=useState({type:0,rotation:1}),_useState22=_slicedToArray(_useState21,2),deplacementEnCours=_useState22[0],setDeplacementEnCours=_useState22[1];var _useState23=useState([]),_useState24=_slicedToArray(_useState23,2),histActions=_useState24[0],setHistActions=_useState24[1];var _useState25=useState(null),_useState26=_slicedToArray(_useState25,2),chrono=_useState26[0],setChrono=_useState26[1];useEffect(function(){if(numPompier==null)handleDisconnect();},[numPompier]);var _useState27=useState(null),_useState28=_slicedToArray(_useState27,2),configuration=_useState28[0],setConfiguration=_useState28[1];var _useState29=useState(null),_useState30=_slicedToArray(_useState29,2),stocks=_useState30[0],setStocks=_useState30[1];var _useState31=useState({Decedes:0,Sauves:0}),_useState32=_slicedToArray(_useState31,2),resultats=_useState32[0],setResultats=_useState32[1];var _useState33=useState({Deplacement:0,Feu:0,FeuFum:0,Fum:0,Marqueur:0,Porte:0,Habitant:0}),_useState34=_slicedToArray(_useState33,2),interventions=_useState34[0],setInterventions=_useState34[1];var _useState35=useState(0),_useState36=_slicedToArray(_useState35,2),budget=_useState36[0],setBudget=_useState36[1];var _useState37=useState(0),_useState38=_slicedToArray(_useState37,2),budgetDepense=_useState38[0],setBudgetDepense=_useState38[1];var isLoading=useRef(false);// INITIALISATION DE LA CARTE\n// const [carte, setCarte] = useState([\n//   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n//   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n//   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n//   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n//   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n//   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n//   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n//   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n// ])\nvar _useState39=useState([]),_useState40=_slicedToArray(_useState39,2),carte=_useState40[0],setCarte=_useState40[1];var _useState41=useState(0),_useState42=_slicedToArray(_useState41,2),nbLignesGrille=_useState42[0],setNbLignesGrille=_useState42[1];var _useState43=useState(0),_useState44=_slicedToArray(_useState43,2),nbColonnesGrille=_useState44[0],setNbColonnesGrille=_useState44[1];var _useState45=useState([[1,1,1,1,1,1,2,6,1,1,1,1,2,5,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,2,6,1,6,2,1,1,1,5,2,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,6,2,1,1,1,1,1,1,1,1]]),_useState46=_slicedToArray(_useState45,2),mursH=_useState46[0],setMursH=_useState46[1];var _useState47=useState([[1,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,1],[2,0,0,5,0,0,0,0,0,0,0,1,0,0,0,0,1],[5,0,0,2,0,0,0,0,0,0,0,1,0,0,0,0,1],[1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1],[1,0,0,0,0,0,1,0,0,0,2,0,0,0,0,0,1],[1,0,0,0,0,0,2,0,0,0,5,0,0,0,0,0,1],[1,0,0,0,0,0,5,0,0,0,5,0,0,0,0,0,2],[1,0,0,0,0,0,1,0,0,0,2,0,0,0,0,0,5]]),_useState48=_slicedToArray(_useState47,2),mursV=_useState48[0],setMursV=_useState48[1];// GET PLAY PARAMETERS \nvar getPlayState=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(session,equipe){var currentPlayState,c;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(isLoading.current){_context.next=8;break;}isLoading.current=true;_context.next=4;return PlayAPI.getPlayState(session,equipe);case 4:currentPlayState=_context.sent;// console.log(currentPlayState)\nif(Object.keys(currentPlayState).length>0){// console.log(parseInt(JSON.parse(currentPlayState.currentTour.valeur)))\nsetCurrentPomp(parseInt(JSON.parse(currentPlayState.currentPomp.valeur)));setCurrentTour(parseInt(JSON.parse(currentPlayState.currentTour.valeur)));setCurrentCycle(parseInt(JSON.parse(currentPlayState.currentCycle.valeur)));setCurrentSequence(parseInt(JSON.parse(currentPlayState.currentSequence.valeur)));setMursH(JSON.parse(currentPlayState.mursH.valeur));setMursV(JSON.parse(currentPlayState.mursV.valeur));setCarte(JSON.parse(currentPlayState.carte.valeur));setResultats({Decedes:parseInt(JSON.parse(currentPlayState.resultatsDecedes.valeur)),Sauves:parseInt(JSON.parse(currentPlayState.resultatsSauves.valeur))});setPlay(JSON.parse(currentPlayState.play.valeur));// if(parseInt(JSON.parse(currentPlayState.currentPomp.valeur))==1 && parseInt(JSON.parse(currentPlayState.currentTour.valeur))==1){\ngetBudget(parseInt(JSON.parse(currentPlayState.currentCycle.valeur)),parseInt(JSON.parse(currentPlayState.currentSequence.valeur)));//  }\nc=parseInt(JSON.parse(currentPlayState.currrentChrono.valeur));if(configuration!==null&&c<=configuration.chronoTourTact.valeur&&parseInt(JSON.parse(currentPlayState.currentPomp.valeur))==numPompier){if(c==0){setChrono(configuration.chronoTourTact.valeur);}else{setChrono(c);}// console.log(c)\n}else{setChrono(null);// console.log(c,configuration.chronoTourTact.valeur)\n}}getPositionFromCarte(JSON.parse(currentPlayState.carte.valeur));isLoading.current=false;case 8:case\"end\":return _context.stop();}}},_callee);}));return function getPlayState(_x,_x2){return _ref.apply(this,arguments);};}();useEffect(function(){// console.log(carte)\nif(carte.length>0){setNbLignesGrille(carte.length);setNbColonnesGrille(carte[0].length);getPositionFromCarte(carte);}},[carte]);// useEffect(()=>{\n//   console.log(currentTour)\n// },[currentTour])\nuseEffect(function(){if(session!=null&&equipe!=null&&currentTour==null){if(!isLoading.current&&configuration!==null)getPlayState(session,equipe);getPlayParameters();getPositionFromCarte(carte);}},[session,equipe,numPompier,configuration]);var getPlayParameters=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var param;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return PlayAPI.getConfiguration(session);case 2:param=_context2.sent;setConfiguration(param);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function getPlayParameters(){return _ref2.apply(this,arguments);};}();var getPositionFromCarte=function getPositionFromCarte(carte){if(carte!=null&&carte.length>0){carte.forEach(function(ligne,indexI){ligne.forEach(function(valeur,indexJ){if(Math.floor(valeur/1000)==1&&Math.floor(valeur%1000/100)==numPompier){setPosition([indexI,indexJ]);setDeplacementEnCours({type:0,rotation:valeur%10});}});});}};// const onTextChange = (e) => {\n//   setNumPompier(e.target.value)\n//   console.log(typeof (e.target.value))\n// }\n// const onXChange = (e) => {\n//   e.preventDefault()\n//   if (e.target.value.length > 0) {\n//     updateCarte(position, 0)\n//     setPosition(position => [position[0], parseInt(e.target.value)])\n//   } else {\n//     updateCarte(position, 0)\n//     setPosition(position => [position[0], 0])\n//   }\n// }\n// const onYChange = (e) => {\n//   e.preventDefault()\n//   if (e.target.value.length > 0) {\n//     updateCarte(position, 0)\n//     setPosition(position => [parseInt(e.target.value), position[1]])\n//   } else {\n//     updateCarte(position, 0)\n//     setPosition(position => [0, position[1]])\n//   }\n// }\n// UPDATES\nvar updateCarte=function updateCarte(coords,value){if(coords[0]<nbLignesGrille&&coords[1]<nbColonnesGrille){try{var c=_toConsumableArray(carte);c[coords[0]][coords[1]]=value;setCarte(c);}catch(error){// console.log(error)\n}}};var updateMurH=function updateMurH(coords,value){if(coords[0]<mursH.length&&coords[1]<mursH[0].length){try{var m=_toConsumableArray(mursH);m[coords[0]][coords[1]]=value;setMursH(m);}catch(error){// console.log(error)\n}}};var updateMurV=function updateMurV(coords,value){if(coords[0]<mursV.length&&coords[1]<mursV[0].length){try{var m=_toConsumableArray(mursV);m[coords[0]][coords[1]]=value;setMursV(m);}catch(error){// console.log(error)\n}}};// ACTIONS\nvar updateBudget=function updateBudget(action){var depenses=0;if(configuration[\"coutEq\"+action]!=null)depenses+=configuration[\"coutEq\"+action].valeur;if(configuration[\"coutInter\"+action]!=null)depenses+=configuration[\"coutInter\"+action].valeur;setBudget(function(budget){return budget-depenses;});setBudgetDepense(function(bd){return bd+depenses;});};var addHistAction=function addHistAction(budget,budgetDepense){// console.log(\"add hist\")\nvar h=[].concat(_toConsumableArray(histActions),[{carte:JSON.stringify(carte),budget:JSON.stringify(budget),budgetDepense:JSON.stringify(budgetDepense),mursH:JSON.stringify(mursH),mursV:JSON.stringify(mursV),stocks:JSON.stringify(stocks),resultats:JSON.stringify(resultats),interventions:JSON.stringify(interventions),deplacementEnCours:JSON.stringify({type:0,rotation:deplacementEnCours.rotation})}]);setHistActions(h);};var retourAction=function retourAction(){// isLoading.current = true\nvar h=_toConsumableArray(histActions);h.pop();var state=h[h.length-1];// console.log(h)\n// console.log(state)\n// console.log(state.deplacementEnCours)\nsetCarte(JSON.parse(state.carte));setMursH(JSON.parse(state.mursH));setMursV(JSON.parse(state.mursV));setStocks(JSON.parse(state.stocks));setInterventions(JSON.parse(state.interventions));setResultats(JSON.parse(state.resultats));setBudget(JSON.parse(state.budget));setBudgetDepense(JSON.parse(state.budgetDepense));setDeplacementEnCours(JSON.parse(state.deplacementEnCours));setHistActions(h);// isLoading.current = false\n};useEffect(function(){if(position!==null&&stocks!==null&&budget>0&&deplacementEnCours.type==0&&(histActions[histActions.length-1]==undefined||budget<histActions[histActions.length-1].budget)){addHistAction(budget,budgetDepense);}},[deplacementEnCours,budgetDepense,stocks]);// useEffect(() => {\n//   console.log(\"hist Actions\")\n//   console.log(histActions)\n// }, [histActions])\n// useEffect(()=>{\n//   if( position!==null && budget>0){\n//     if(histActions[histActions.length-1]!==undefined && budget<histActions[histActions.length-1].budget ){\n//       addHistAction(budget)\n//     }\n//   }\n// },[budget])\nvar doAction=function doAction(action){// console.log(action)\ntry{if(Object.keys(stocks).includes(action)){var s=stocks;s[action]=s[action]-1;setStocks(s);}}catch(error){}try{if(Object.keys(interventions).includes(action)){var i=interventions;i[action]=i[action]-1;setInterventions(i);}}catch(error){}// setTimeout(() => {\nupdateBudget(action);// }, 1000);\n};var updateResultats=function updateResultats(sauve){var res=_objectSpread({},resultats);if(sauve){res.Sauves+=1;}else{res.Decedes+=1;}// console.log(res)\nsetResultats(res);};useEffect(function(){setBtnClickedBottom(null);revealHabitant();},[position]);useEffect(function(){if(carte.length>0)relacherHabitant();},[position,mursH,mursV]);// useEffect(() => {\n//   console.log(\"Stocks\")\n//   console.log(stocks)\n// }, [stocks])\nuseEffect(function(){if(configuration!=null){var inter=_objectSpread({},interventions);var interKeys=Object.keys(inter);// console.log(Math.floor(budget / configuration[\"coutInter\" + \"Habitant\"].valeur))\ninterKeys.forEach(function(action){try{if(configuration[\"coutInter\"+action].valeur>0){// if(action==\"Habitant\"){\n//   console.log(stocks !== null && stocks[action] != null && stocks[action] != undefined && stocks[action] != \"NaN\" ? stocks[action] : 1000)\n// }\ninter[action]=Math.min(configuration[\"coutEq\"+action]!=null&&configuration[\"coutEq\"+action]!=undefined?Math.floor(budget/(configuration[\"coutInter\"+action].valeur+configuration[\"coutEq\"+action].valeur)):Math.floor(budget/configuration[\"coutInter\"+action].valeur),stocks!==null&&stocks[action]!=null&&stocks[action]!=undefined&&stocks[action]!=\"NaN\"?stocks[action]:1000);}}catch(error){// console.log(error, action)\n}});// console.log(inter)\nsetInterventions(inter);}else{// getPlayParameters()\n}},[budget,configuration,numPompier,stocks]);// SOCKETS\n// SOCKETS \nvar onTourChange=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:e.preventDefault();// console.log(\"nouveau tour todo\")\ncase 1:case\"end\":return _context3.stop();}}},_callee3);}));return function onTourChange(_x3){return _ref3.apply(this,arguments);};}();var modifyBudgetsFin=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(cycle,sequence,prochainPomp,prochainTour,prochainCycle,prochaineSequence,prochainChrono){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:// console.log(\"budgets modified 0\")\nPlayAPI.getBudgetsPompFin(session,equipe).then(function(res){// console.log(res)\nvar budgetsFin=JSON.parse(res.valeur);try{budgetsFin.interventions.forEach(function(b,index){if(b.numCycle==cycle&&b.numSeq==sequence){budgetsFin[\"interventions\"][index][\"pomp\"+numPompier]=budget;}});}catch(error){}try{budgetsFin.equipements.forEach(function(e,index){if(e.numCycle==cycle&&e.numSeq==sequence){budgetsFin[\"equipements\"][index][\"Feu\"][\"pomp\"+numPompier]=stocks.Feu;budgetsFin[\"equipements\"][index][\"FeuFum\"][\"pomp\"+numPompier]=stocks.FeuFum;budgetsFin[\"equipements\"][index][\"Fum\"][\"pomp\"+numPompier]=stocks.Fum;budgetsFin[\"equipements\"][index][\"Marqueur\"][\"pomp\"+numPompier]=stocks.Marqueur;}});}catch(error){}// console.log(\"budgets modified 1\")\nPlayAPI.saveBudgetsPompFin(budgetsFin,session,equipe).then(function(){var newCarte=evenementsAleatoire();PlayAPI.nouveauTour(socket,prochainPomp,newCarte,mursH,mursV,prochaineSequence,prochainCycle,prochainTour,resultats.Decedes,resultats.Sauves,session,equipe,prochainChrono);// return budgetsFin\n});});case 1:case\"end\":return _context4.stop();}}},_callee4);}));return function modifyBudgetsFin(_x4,_x5,_x6,_x7,_x8,_x9,_x10){return _ref4.apply(this,arguments);};}();var getBudget=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(cycle,sequence){var nouveauBudget,budgetInter,stocksEq;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return PlayAPI.getBudgetsPompFin(session,equipe);case 2:nouveauBudget=_context5.sent;nouveauBudget=nouveauBudget.valeur;// console.log(nouveauBudget)\nnouveauBudget=JSON.parse(nouveauBudget);budgetInter=0;stocksEq=stocks!==null&&stocks!==undefined?_objectSpread({},stocks):{Feu:0,FeuFum:0,Fum:0,Marqueur:0};try{nouveauBudget.interventions.forEach(function(b){if(b.numCycle==cycle&&b.numSeq==sequence){budgetInter=b[\"pomp\"+numPompier];}});}catch(error){}try{nouveauBudget.equipements.forEach(function(e){if(e.numCycle==cycle&&e.numSeq==sequence){stocksEq.Feu+=e.Feu[\"pomp\"+numPompier];stocksEq.FeuFum+=e.FeuFum[\"pomp\"+numPompier];stocksEq.Fum+=e.Fum[\"pomp\"+numPompier];stocksEq.Marqueur+=e.Marqueur[\"pomp\"+numPompier];}});}catch(error){}// console.log(nouveauBudget)\nif(budgetInter!==budget){setBudget(budgetInter);setBudgetDepense(0);}setStocks(stocksEq);case 11:case\"end\":return _context5.stop();}}},_callee5);}));return function getBudget(_x11,_x12){return _ref5.apply(this,arguments);};}();// console.log(socket)\nuseEffect(function(){if(socket===null&&configuration!==null){var s=io(\"https://www.back.leaders-extreme.fr\");// console.log(\"test\")\ns.emit(\"connecti\",JSON.stringify({session:session,equipe:equipe}));s.on('changementTour',function(data){// console.log(\"changement tour\")\nvar d=data;console.log(d);if(currentPomp!=d.currentPomp||currentCycle!==d.currentCycle||currentTour!==d.currentTour||currentSequence!==d.currentSequence){console.log(\"changement tour\");getPlayState(session,equipe);}});// s.on('revealHabitant', (data) => {\n//   if (carte !== null && carte.length > 0) {\n//     // console.log(carte[data.y][data.x])\n//     console.log(carte[data.y])\n//     if (carte[data.y][data.x] == 20) {\n//       // console.log([data.y,data.x])\n//       updateCarte([data.y, data.x], data.type)\n//       // console.log(\"socket hab\")\n//       // console.log(data)\n//     }\n//   }\n// })\ns.on('startStopPartie',function(data){setPlay(data.start);});s.on('disconnectUsers',function(data){setPlay(false);handleDisconnect();});setSocket(s);}},[socket,configuration]);// TESTS\nvar test=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:case\"end\":return _context6.stop();}}},_callee6);}));return function test(){return _ref6.apply(this,arguments);};}();// useEffect(()=>{\n//   console.log(interventions,budget)\n// },[interventions,budget])\n// AUTORISATIONS \nvar deplacementAutorise=function deplacementAutorise(deplacement){// return true\nvar dpl=_toConsumableArray(deplacement);if(dpl[0]==0&&dpl[1]==0)return false;if(position[0]+dpl[0]>carte.length-1||position[1]+dpl[1]>carte[0].length-1||position[0]+dpl[0]<0||position[1]+dpl[1]<0)return false;var dplInterditsCases=[1000,20,3,4];try{var valeurCaseDeplacement=carte[position[0]+dpl[0]][position[1]+dpl[1]];if(Math.floor(valeurCaseDeplacement/1000)==1)return false;if(Math.floor(valeurCaseDeplacement/10)==2)return false;if(dplInterditsCases.includes(valeurCaseDeplacement))return false;}catch(error){}var dplInterditsMurs=[1,2,3,5];try{if(dpl[0]!=0){// haut bas\nif(dpl[0]<0){dpl[0]=0;}if(typeof mursH[position[0]+dpl[0]][position[1]]==='undefined')return false;if(dplInterditsMurs.includes(mursH[position[0]+dpl[0]][position[1]]))return false;}else{// gauche droite\nif(dpl[1]<0){dpl[1]=0;}if(typeof mursV[position[0]][position[1]+dpl[1]]==='undefined')return false;if(dplInterditsMurs.includes(mursV[position[0]][position[1]+dpl[1]]))return false;}}catch(error){}return true;};var testRelacherHabitant=function testRelacherHabitant(){if(carte[position[0]][position[1]]%100<10)return false;// pas de transport d'habitant\nvar mursBloquants=[1,2,3,5];if(position[0]==0&&!mursBloquants.includes(mursH[position[0]][position[1]]))return true;// haut\nif(position[0]==nbLignesGrille-1&&!mursBloquants.includes(mursH[position[0]+1][position[1]]))return true;// bas\nif(position[1]==0&&!mursBloquants.includes(mursV[position[0]][position[1]]))return true;// gauche\nif(position[1]==nbColonnesGrille-1&&!mursBloquants.includes(mursV[position[0]][position[1]+1]))return true;// droite\nreturn false;};var relacherHabitant=function relacherHabitant(){if(testRelacherHabitant()){setTimeout(function(){updateResultats(true);updateCarte(position,carte[position[0]][position[1]]-(carte[position[0]][position[1]]%100-carte[position[0]][position[1]]%10));},1000);}};var revealHabitant=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){var casesAutour;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:if(configuration!=null){casesAutour=getCasesAutour();try{if(casesAutour.dessus==20){updateCarte([position[0]-1,position[1]],0);resetHistAction();// const response = await PlayAPI.revealHabitant(socket, [position[0] - 1, position[1]], 0)\n}}catch(error){}try{if(casesAutour.droite==20){updateCarte([position[0],position[1]+1],0);resetHistAction();// const response = await PlayAPI.revealHabitant(socket, [position[0], position[1] + 1], 0)\n}}catch(error){}try{if(casesAutour.dessous==20){updateCarte([position[0]+1,position[1]],0);resetHistAction();// const response = await PlayAPI.revealHabitant(socket, [position[0] + 1, position[1]], 0)\n}}catch(error){}try{if(casesAutour.gauche==20){updateCarte([position[0],position[1]-1],0);resetHistAction();// const response = await PlayAPI.revealHabitant(socket, [position[0], position[1] - 1], 0)\n}}catch(error){}}case 1:case\"end\":return _context7.stop();}}},_callee7);}));return function revealHabitant(){return _ref7.apply(this,arguments);};}();var getCasesAutour=function getCasesAutour(){var cases={};try{cases[\"dessus\"]=carte[position[0]-1][position[1]];// dessus\n}catch(error){}try{cases[\"droite\"]=carte[position[0]][position[1]+1];// droite\n}catch(error){}try{cases[\"dessous\"]=carte[position[0]+1][position[1]];// dessous\n}catch(error){}try{cases[\"gauche\"]=carte[position[0]][position[1]-1];// gauche\n}catch(error){}return cases;};var getMursAutour=function getMursAutour(position){var murs=[];try{if(mursH[position[0]][position[1]]!=4||mursH[position[0]][position[1]-1]<6&&mursH[position[0]][position[1]+1]<6){murs.push(mursH[position[0]][position[1]]);// dessus\n}else{murs.push(0);}}catch(error){}try{if(mursV[position[0]][position[1]+1]!=4||mursV[position[0]-1][position[1]+1]<6&&mursV[position[0]+1][position[1]+1]<6){murs.push(mursV[position[0]][position[1]+1]);// droite\n}else{murs.push(0);}}catch(error){}try{if(mursH[position[0]+1][position[1]]!=4||mursH[position[0]+1][position[1]-1]<6&&mursH[position[0]+1][position[1]+1]<6){murs.push(mursH[position[0]+1][position[1]]);// dessous\n}else{murs.push(0);}}catch(error){}try{if(mursV[position[0]][position[1]]!=4||mursV[position[0]-1][position[1]]<6&&mursV[position[0]+1][position[1]]<6){murs.push(mursV[position[0]][position[1]]);// gauche\n}else{murs.push(0);}}catch(error){}// console.log(murs)\nreturn murs;};// useEffect(()=>{\n//   console.log(histActions)\n// },[histActions])\nvar resetHistAction=function resetHistAction(){// console.log(\"reset actions\")\nsetTimeout(function(){setHistActions([{carte:JSON.stringify(carte),budget:JSON.stringify(budget),budgetDepense:JSON.stringify(budgetDepense),mursH:JSON.stringify(mursH),mursV:JSON.stringify(mursV),stocks:JSON.stringify(stocks),resultats:JSON.stringify(resultats),interventions:JSON.stringify(interventions),deplacementEnCours:JSON.stringify({type:0,rotation:deplacementEnCours.rotation})}]);},300);};var _useState49=useState(null),_useState50=_slicedToArray(_useState49,2),btnClickedBottom=_useState50[0],setBtnClickedBottom=_useState50[1];var _useState51=useState([]),_useState52=_slicedToArray(_useState51,2),propositionsCase=_useState52[0],setPropositionsCase=_useState52[1];// Extincteurs\nvar _useState53=useState([[],[]]),_useState54=_slicedToArray(_useState53,2),propositionMursDetruire=_useState54[0],setPropositionMursDetruire=_useState54[1];// Horizontaux  , Verticaux\nuseEffect(function(){if(btnClickedBottom!=3||btnClickedBottom==null){setPropositionMursDetruire([[],[]]);}if(btnClickedBottom>2&&btnClickedBottom<6||btnClickedBottom==null){setPropositionsCase([]);}},[btnClickedBottom]);// HANDLERS CLIC GRILLE\nvar handleClicCase=function handleClicCase(valeurAvant,valeurApres,coordX,coordY){try{updateCarte([coordY,coordX],valeurApres);setPropositionsCase([]);setBtnClickedBottom(null);if(valeurAvant==4&&valeurApres==0){// Extincteur flamme\ndoAction(\"Feu\");}if(valeurAvant==4&&valeurApres==3){// Feu Fumée\ndoAction(\"FeuFum\");}if(valeurAvant==3&&valeurApres==0){// Fumée\ndoAction(\"Fum\");}if(Math.floor(valeurAvant/10)==2&&valeurApres==0){// Habitant\ndoAction(\"Habitant\");// console.log(carte[position[0]][position[1]] + (valeurAvant % 10)*10)\nupdateCarte(position,carte[position[0]][position[1]]+valeurAvant%10*10);}}catch(error){}};var handleClicMur=function handleClicMur(num,valeurAvant,coordX,coordY){// marqueur dégat\nif(propositionMursDetruire[0].length>0||propositionMursDetruire[1].length>0){var checkInCoords=function checkInCoords(index){// console.log(\"coordx\",coordX,\"coordy\",coordY,\"position\",position)\nvar numClic=null;if(coordX==position[1]&&(coordY<position[0]||coordY==position[0]&&num==0)){// top\nnumClic=0;// case en question\n// console.log(\"top\",numClic)\n}if(coordX==position[1]&&(coordY>position[0]||coordY==position[0]&&num==2)){// bottom\nnumClic=2;// case en question\n// console.log(\"bottom\",numClic)\n}if(coordY==position[0]&&(coordX<position[1]||coordX==position[1]&&num==3)){// left\nnumClic=3;// case en question\n// console.log(\"left\",numClic)\n}if(coordY==position[0]&&(coordX>position[1]||coordX==position[1]&&num==1)){// right\nnumClic=1;// case en question\n// console.log(\"right\",numClic)\n}return numClic;};var cote=checkInCoords(num%2);var valeurApres=4;if(valeurAvant==1)valeurApres=3;if(cote!=null){try{switch(cote){case 0:updateMurH([position[0],position[1]],valeurApres);// if(valeurAvant==5 ||)\nbreak;case 1:updateMurV([position[0],position[1]+1],valeurApres);break;case 2:updateMurH([position[0]+1,position[1]],valeurApres);break;case 3:updateMurV([position[0],position[1]],valeurApres);break;}doAction(\"Marqueur\");}catch(error){}setPropositionMursDetruire([[],[]]);setBtnClickedBottom(null);}}};// HANDLER CLICS BOUTONS\nvar handleClicFleche=function handleClicFleche(num){// Position y x\nvar deplacement;var rotation;switch(num){case 0:// haut\n// console.log(\"haut\")\ndeplacement=[-1,0];rotation=1;break;case 1:// droite\n// console.log(\"droite\")\ndeplacement=[0,1];rotation=2;break;case 2:// bas\n// console.log(\"bas\")\ndeplacement=[1,0];rotation=3;break;case 3:// gauche\n// console.log(\"gauche\")\ndeplacement=[0,-1];rotation=4;break;}if(deplacementAutorise(deplacement)){// ANIMATION MARCHE\nsetDeplacementEnCours({type:1,rotation:rotation});setTimeout(function(){updateCarte([position[0]+deplacement[0],position[1]+deplacement[1]],carte[position[0]][position[1]]-carte[position[0]][position[1]]%10+rotation);// setPosition(position => [position[0] + deplacement[0], position[1] + deplacement[1]])\nif((carte[position[0]][position[1]]%100-carte[position[0]][position[1]]%10)/10>0){doAction(\"DeplacementHab\");}else{doAction(\"Deplacement\");}updateCarte(position,0);setDeplacementEnCours({type:2,rotation:rotation});setTimeout(function(){setDeplacementEnCours({type:0,rotation:rotation});},500);},500);}};var handleChangePiece=function handleChangePiece(){resetHistAction();};var handleClicDoor=function handleClicDoor(ouvrir){// position, ouvert/fermé\nsetBtnClickedBottom(ouvrir?4:5);var valueAvant;var valueApres;if(ouvrir){valueAvant=5;valueApres=6;}else{valueAvant=6;valueApres=5;}doAction(\"Porte\");try{if(mursH[position[0]][position[1]]==valueAvant)updateMurH([position[0],position[1]],valueApres);if(mursH[position[0]+1][position[1]]==valueAvant)updateMurH([position[0]+1,position[1]],valueApres);if(mursV[position[0]][position[1]]==valueAvant)updateMurV([position[0],position[1]],valueApres);if(mursV[position[0]][position[1]+1]==valueAvant)updateMurV([position[0],position[1]+1],valueApres);}catch(error){}};var handleClicExtincteur=function handleClicExtincteur(num){// 0 FEU, 1 FEUFUM, 2 FUM\nvar mursInterdits=[1,2,3,5];var mursAutour=getMursAutour(position);if(btnClickedBottom!=num){var listeCasesAction=[];var valeurAvant=4;var valeurApres=0;setBtnClickedBottom(num);switch(num){case 0:// ETEINDRE FEU\nbreak;case 1:// FEU FUM\nvaleurApres=3;break;case 2:// ETEINDRE FUMEE\nvaleurAvant=3;break;}try{if(carte[position[0]-1][position[1]]==valeurAvant&&!mursInterdits.includes(mursAutour[0])){listeCasesAction.push([position[0]-1,position[1],valeurAvant,valeurApres]);// TOP\n}}catch(error){}try{if(carte[position[0]][position[1]+1]==valeurAvant&&!mursInterdits.includes(mursAutour[1])){listeCasesAction.push([position[0],position[1]+1,valeurAvant,valeurApres]);// RIGHT\n}}catch(error){}try{if(carte[position[0]+1][position[1]]==valeurAvant&&!mursInterdits.includes(mursAutour[2])){listeCasesAction.push([position[0]+1,position[1],valeurAvant,valeurApres]);// BOTTOM\n}}catch(error){}try{if(carte[position[0]][position[1]-1]==valeurAvant&&!mursInterdits.includes(mursAutour[3])){listeCasesAction.push([position[0],position[1]-1,valeurAvant,valeurApres]);// LEFT\nconsole.log(\"test\");}}catch(error){}setPropositionsCase(listeCasesAction);}else{setBtnClickedBottom(null);}};var handleClicMarqueur=function handleClicMarqueur(){if(btnClickedBottom!=3){setBtnClickedBottom(3);if(propositionMursDetruire[0].length>0||propositionMursDetruire[1].length>0){setPropositionMursDetruire([[],[]]);}else{var mursADetruire=[1,3,5,6];var propositions=[[],[]];var mursAutour=getMursAutour(position);try{if(mursADetruire.includes(mursAutour[0]))propositions[0].push([position[1],position[0]]);// top\nif(mursADetruire.includes(mursAutour[1]))propositions[1].push([position[1]+1,position[0]]);// right\nif(mursADetruire.includes(mursAutour[2]))propositions[0].push([position[1],position[0]+1]);// bottom\nif(mursADetruire.includes(mursAutour[3]))propositions[1].push([position[1],position[0]]);// left\n}catch(error){}setPropositionMursDetruire(propositions);}}else{setBtnClickedBottom(null);}};var handleClicValidated=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(bool){var prochainPomp,prochainTour,prochainCycle,prochaineSequence,prochainChrono,res;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:// console.log(\"handle Clic\")\nif(configuration!=null){if(bool){prochainPomp=currentPomp+1;prochainTour=currentTour;prochainCycle=currentCycle;prochaineSequence=currentSequence;prochainChrono=configuration.chronoTourTact.valeur;if(numPompier==configuration.nbPompEquipe.valeur){// DERNIER POMP DU TOUR\nif(currentTour==configuration.nbToursParCycle.valeur){// SEND TO INTER\nprochainTour=1;prochainPomp=0;// A CHANGER AVEC STRATEGIQUE\nprochainChrono=configuration.chronoTourInter.valeur;if(prochainCycle==configuration.nbCyclesParSequence.valeur){prochainCycle=1;prochaineSequence=prochaineSequence+1;}else{prochainCycle=prochainCycle+1;}}else{// PAS DERNIER TOUR DU CYCLE\n// console.log(\"pas dernier tour\")\nprochainPomp=1;prochainTour=prochainTour+1;// prochainChrono = configuration.chronoTourTact.valeur\n}}// console.log(prochainPomp,prochainTour,prochainCycle)\n// console.log(\"budgets fin 1\")\nres=modifyBudgetsFin(currentCycle,currentSequence,prochainPomp,prochainTour,prochainCycle,prochaineSequence,prochainChrono);resetHistAction();// setChrono(null)\n}else{retourAction();// console.log(\"retour\")\n}}case 1:case\"end\":return _context8.stop();}}},_callee8);}));return function handleClicValidated(_x13){return _ref8.apply(this,arguments);};}();var handleNoClicked=function handleNoClicked(){setPropositionMursDetruire([[],[]]);setPropositionsCase([]);};var handleClicHabitant=function handleClicHabitant(){if(btnClickedBottom!=6){setBtnClickedBottom(6);var valeurApres=0;var listeCasesAction=[];try{var valeurDessus=carte[position[0]-1][position[1]];if(Math.floor(valeurDessus/10)==2)listeCasesAction.push([position[0]-1,position[1],valeurDessus,valeurApres]);// TOP\n}catch(error){}try{var valeurDroite=carte[position[0]][position[1]+1];if(Math.floor(valeurDroite/10)==2)listeCasesAction.push([position[0],position[1]+1,valeurDroite,valeurApres]);// RIGHT\n}catch(error){}try{var valeurDessous=carte[position[0]+1][position[1]];if(Math.floor(valeurDessous/10)==2)listeCasesAction.push([position[0]+1,position[1],valeurDessous,valeurApres]);// BOTTOM\n}catch(error){}try{var valeurGauche=carte[position[0]][position[1]-1];if(Math.floor(valeurGauche/10)==2)listeCasesAction.push([position[0],position[1]-1,valeurGauche,valeurApres]);// LEFT\n}catch(error){}setPropositionsCase(listeCasesAction);// console.log(\"handle clic habitant\")\n}else{setBtnClickedBottom(null);}};var getRandomCoords=function getRandomCoords(mini,maxi){if(carte!==null&&carte!==undefined&&carte.length>0){var y=Math.floor(Math.random()*(maxi[0]-mini[0]))+mini[0];var x=Math.floor(Math.random()*(maxi[1]-mini[1]))+mini[1];var type=carte[y][x];while(Math.floor(type/1000)==1||Math.floor(type/10)==2){y=Math.floor(Math.random()*(maxi[0]-mini[0]))+mini[0];x=Math.floor(Math.random()*(maxi[1]-mini[1]))+mini[1];type=carte[y][x];}// console.log(\"getRandomCoords\", y, x)\nreturn[y,x];}return null;};var handleMortHab=function handleMortHab(){var r=_objectSpread({},resultats);r.Decedes=r.Decedes+1;setResultats(r);// console.log(\"mort d'un habitant\")\n};var handleExplosion=function handleExplosion(randomPos,c){var mursAutour=getMursAutour(randomPos);// console.log(mursAutour)\n// MARQUEURS SUR LA CASE QUI EXPLOSE\nmursAutour.forEach(function(val,index){var valeurFin=val;if([3,5].includes(val))valeurFin=4;// DESTRUCTION TOTALE\nif(valeurFin==1)valeurFin=3;if(valeurFin==3||valeurFin==4){switch(index){case 0:try{updateMurH([randomPos[0],randomPos[1]],valeurFin);}catch(_unused){}break;case 1:try{updateMurV([randomPos[0],randomPos[1]+1],valeurFin);}catch(_unused2){}break;case 2:try{updateMurH([randomPos[0]+1,randomPos[1]],valeurFin);}catch(_unused3){}break;case 3:try{updateMurV([randomPos[0],randomPos[1]],valeurFin);}catch(_unused4){}break;}}});// PROPAGATION DANS LES DIFFERENTES DIRECTIONS\nvar mursInterdits=[1,2,3,5];if(randomPos[1]<nbColonnesGrille-1&&c[randomPos[0]][randomPos[1]+1]==4){// Propagation droite\n// console.log(\"propa droite\")\nvar j=1;while(randomPos[1]+1+j<nbColonnesGrille){var type=c[randomPos[0]][randomPos[1]+1+j];if(Math.floor(type/10)==2){c[randomPos[0]][randomPos[1]+1+j]=4;handleMortHab();}if(Math.floor(type/1000)==1){if(type%100<10){c[randomPos[0]][randomPos[1]+1+j]=type-(type%100-type%10);handleMortHab();}else{// console.log(\"mort d'un pompier solo\")\n}}if(c[randomPos[0]][randomPos[1]+1+j]==3||c[randomPos[0]][randomPos[1]+1+j]==0){c[randomPos[0]][randomPos[1]+1+j]=4;break;}var mur=getMursAutour([randomPos[0],randomPos[1]+1+j])[1];if(mursInterdits.includes(mur)){try{updateMurV([randomPos[0],randomPos[1]+2+j],4);break;}catch(_unused5){}}j+=1;}}if(randomPos[1]>0&&c[randomPos[0]][randomPos[1]-1]==4){// Propagation gauche\n// console.log(\"propa gauche\")\nvar _j=1;while(randomPos[1]-1-_j>=0){var _type=c[randomPos[0]][randomPos[1]-1-_j];if(Math.floor(_type/10)==2){c[randomPos[0]][randomPos[1]-1-_j]=4;handleMortHab();}if(Math.floor(_type/1000)==1){if(_type%100<10){c[randomPos[0]][randomPos[1]-1-_j]=_type-(_type%100-_type%10);handleMortHab();}else{// console.log(\"mort d'un pompier solo\")\n}}if(c[randomPos[0]][randomPos[1]-1-_j]==3||c[randomPos[0]][randomPos[1]-1-_j]==0){c[randomPos[0]][randomPos[1]-1-_j]=4;// console.log(\"break type\",randomPos[1]-1-j)\nbreak;}var _mur=getMursAutour([randomPos[0],randomPos[1]-1-_j])[3];// console.log(murs)\nif(mursInterdits.includes(_mur)){try{updateMurV([randomPos[0],randomPos[1]-_j-1],4);break;}catch(_unused6){}}_j-=1;}}if(randomPos[0]>0&&c[randomPos[0]-1][randomPos[1]]==4){// Propagation haut\n// console.log(\"propa haut\")\nvar i=1;while(randomPos[0]-1-i>=0){var _type2=c[randomPos[0]-1-i][randomPos[1]];if(Math.floor(_type2/10)==2){c[randomPos[0]-1-i][randomPos[1]]=4;handleMortHab();}if(Math.floor(_type2/1000)==1){if(_type2%100<10){c[randomPos[0]-1-i][randomPos[1]]=_type2-(_type2%100-_type2%10);handleMortHab();}else{// console.log(\"mort d'un pompier solo\")\n}}if(c[randomPos[0]-1-i][randomPos[1]]==3||c[randomPos[0]-1-i][randomPos[1]]==0){c[randomPos[0]-1-i][randomPos[1]]=4;// console.log(\"break type\",randomPos[1]-1-j)\nbreak;}var _mur2=getMursAutour([randomPos[0]-1-i,randomPos[1]])[0];// console.log(murs)\nif(mursInterdits.includes(_mur2)){try{updateMurH([randomPos[0]-1-i,randomPos[1]],4);break;}catch(_unused7){}}i-=1;}}if(randomPos[0]<nbLignesGrille-1&&c[randomPos[0]+1][randomPos[1]]==4){// Propagation bas\n// console.log(\"propa bas\")\nvar _i=0;while(randomPos[0]+1+_i>=0){var _type3=c[randomPos[0]+1+_i][randomPos[1]];if(Math.floor(_type3/10)==2){c[randomPos[0]+1+_i][randomPos[1]]=4;handleMortHab();}if(Math.floor(_type3/1000)==1){if(_type3%100<10){c[randomPos[0]+1+_i][randomPos[1]]=_type3-(_type3%100-_type3%10);handleMortHab();}else{// console.log(\"mort d'un pompier solo\")\n}}if(c[randomPos[0]+1+_i][randomPos[1]]==3||c[randomPos[0]+1+_i][randomPos[1]]==0){c[randomPos[0]+1+_i][randomPos[1]]=4;// console.log(\"break type\")\nbreak;}var _mur3=getMursAutour([randomPos[0]+1+_i,randomPos[1]])[2];if(mursInterdits.includes(_mur3)){try{updateMurH([randomPos[0]+2+_i,randomPos[1]],4);break;}catch(_unused8){}}_i+=1;}}return c;};var addFumToCarte=function addFumToCarte(randomPos){var c=_toConsumableArray(carte);if(carte!==null&&carte!==undefined&&carte.length>0&&randomPos!==null){// console.log(\"addFumToCarte\", randomPos[0], randomPos[1])\nswitch(c[randomPos[0]][randomPos[1]]){case 0:// VIDE\n// console.log(\"vide => fum\")\nc[randomPos[0]][randomPos[1]]=3;break;case 3:// FUMEE\n// console.log(\"fum => feu\")\nc[randomPos[0]][randomPos[1]]=4;break;case 4:// FEU\nc=handleExplosion(randomPos,c);// console.log(\"feu => explosion\")\nbreak;default:// console.log(\"error\")\nbreak;}}return c;};var embrasementFum=function embrasementFum(c){var modified=false;if(c!==null&&c!==undefined&&c.length>0){var mursInterdits=[1,2,3,5];var i=-1;var j=-1;while(i<nbLignesGrille-1){i=i+1;while(j<nbColonnesGrille-1){j=j+1;var mursCote=[mursH[i][j],mursV[i][j+1],mursH[i+1][j],mursV[i][j]];if(i<c.length&&j<c[0].length&&c[i][j]==4){// ON PARCOURT LES FEUX\nif(i>0&&c[i-1][j]==3&&!mursInterdits.includes(mursCote[0])){// juste dessus\nc[i-1][j]=4;modified=true;}if(j<nbColonnesGrille-1&&c[i][j+1]==3&&!mursInterdits.includes(mursCote[1])){// juste droite\nc[i][j+1]=4;modified=true;}if(i<nbLignesGrille-1&&c[i+1][j]==3&&!mursInterdits.includes(mursCote[2])){// juste dessous\nc[i+1][j]=4;modified=true;}else{}if(j>0&&c[i][j-1]==3&&!mursInterdits.includes(mursCote[3])){// GAUCHE\nc[i][j-1]=4;modified=true;}}}j=-1;}if(modified){embrasementFum(c);modified=false;}// console.log(mursCote)\n}else{// console.log(\"test\")\n}// console.log(\"embrasementFum\")\nreturn c;};var countHab=function countHab(carte){if(carte!=null&&carte.length>0){var count=0;carte.forEach(function(ligne,indexI){ligne.forEach(function(valeur,indexJ){if(Math.floor(valeur/10)==2){count+=1;}});});return count;}};var addHabitants=function addHabitants(c){var count=countHab(c);// console.log(count)\nfor(var i=0;i<configuration.nbHabitantsASauver.valeur-count;i++){var newPos=getRandomCoords([0,0],[nbLignesGrille,nbColonnesGrille]);c[newPos[0]][newPos[1]]=20+Math.round(Math.random());}// console.log(countHab(c))\nreturn c;};var evenementsAleatoire=function evenementsAleatoire(){var randomPos=getRandomCoords([0,0],[nbLignesGrille,nbColonnesGrille]);// const randomPos=[2,9]\nvar c=addFumToCarte(randomPos);c=embrasementFum(c);c=addHabitants(c);return c;};// const [tester,setTester]=useState(false)\n// useEffect(()=>{\n//   if(!tester && carte !== null && carte !== undefined && carte.length>0 && nbLignesGrille>0 && nbColonnesGrille>0){\n//     setTester(true)\n//     console.log([...carte])\n//     evenementsAleatoire()\n//   }\n// },[tester,carte,nbLignesGrille,nbColonnesGrille])\nvar _useState55=useState(null),_useState56=_slicedToArray(_useState55,2),textes=_useState56[0],setTextes=_useState56[1];useEffect(function(){var getTextes=/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(){var textes;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:textes=ContentsAPI.getTexts(\"jeuTactInterface\").then(function(res){setTextes(res);});case 1:case\"end\":return _context9.stop();}}},_callee9);}));return function getTextes(){return _ref9.apply(this,arguments);};}();if(textes==null){getTextes();}// console.log(textes)\n},[textes]);var getText=function getText(name){if(textes==null){return name;}else{try{return textes[name].contenu;}catch(error){// console.log(textes)\nreturn name;}}};var renderAttenteLancement=function renderAttenteLancement(){return/*#__PURE__*/_jsxs(\"div\",{style:{color:\"gray\",textAlign:\"center\",fontSize:20},children:[/*#__PURE__*/_jsx(Typography,{children:getText('attenteLancement')}),/*#__PURE__*/_jsx(Typography,{children:getText('infoLancement')})]});};return/*#__PURE__*/_jsx(\"div\",{style:{position:\"absolute\",display:\"flex\",alignItems:\"center\",flexDirection:\"column\",justifyContent:\"center\",flex:1,width:\"100%\",height:\"100%\"},children:carte.length>0&&position!=null&&stocks!==null&&numPompier!==null&&play?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Grille,{nbColonnesGrille:nbColonnesGrille,nbLignesGrille:nbLignesGrille,carte:carte,position:position,mursH:mursH,mursV:mursV,propositionMursDetruire:propositionMursDetruire,propositionsCase:propositionsCase,handleClicMur:handleClicMur,handleClicCase:handleClicCase,handleChangePiece:handleChangePiece,deplacementEnCours:deplacementEnCours}),/*#__PURE__*/_jsx(TactBandeauTop,{stocks:stocks,resultats:resultats,numeroPompier:numPompier,sequence:currentSequence,cycle:currentCycle,tour:currentTour,pomp:currentPomp,configuration:configuration,budget:budget,budgetDepense:budgetDepense,equipe:equipe,handleClicValidated:handleClicValidated,play:play,chronoInit:chrono,numEquipe:equipe,numSession:session}),/*#__PURE__*/_jsx(TactBandeauBottom,{interventions:interventions,stocks:stocks,numeroPompier:numPompier,tour:currentTour,pomp:currentPomp,handleClicFleche:handleClicFleche,handleClicValidated:handleClicValidated,handleClicDoor:handleClicDoor,handleClicMarqueur:handleClicMarqueur,handleClicExt:handleClicExtincteur,handleNoClicked:handleNoClicked,handleClicHabitant:handleClicHabitant,btnClickedBottom:btnClickedBottom,mursAutour:getMursAutour(position),casesAutour:getCasesAutour(),currentCase:carte[position[0]][position[1]],histActions:histActions,configuration:configuration,deplacementEnCours:deplacementEnCours,budgetMaxAtteint:budgetDepense>=configuration.budgetTourMax.valeur,isLoading:false}),/*#__PURE__*/_jsx(TactBandeauDroite,{handleDisconnect:handleDisconnect,configuration:configuration})]}):renderAttenteLancement()});};export default TactInterface;// export default React.memo(TactInterface)","map":{"version":3,"sources":["C:/Users/hugod/decitude/client/src/routes/TactInterface.js"],"names":["React","useState","useEffect","useRef","PlayAPI","TactBandeauTop","TactBandeauBottom","Grille","useHistory","cookie","TactBandeauDroite","Typography","ContentsAPI","io","TactInterface","history","user","load","socket","setSocket","handleDisconnect","disconnect","save","path","maxAge","push","undefined","role","includes","play","setPlay","replace","numPompier","setNumPompier","currentPomp","setCurrentPomp","currentTour","setCurrentTour","currentCycle","setCurrentCycle","currentSequence","setCurrentSequence","session","setSession","equipe","setEquipe","position","setPosition","type","rotation","deplacementEnCours","setDeplacementEnCours","histActions","setHistActions","chrono","setChrono","configuration","setConfiguration","stocks","setStocks","Decedes","Sauves","resultats","setResultats","Deplacement","Feu","FeuFum","Fum","Marqueur","Porte","Habitant","interventions","setInterventions","budget","setBudget","budgetDepense","setBudgetDepense","isLoading","carte","setCarte","nbLignesGrille","setNbLignesGrille","nbColonnesGrille","setNbColonnesGrille","mursH","setMursH","mursV","setMursV","getPlayState","current","currentPlayState","Object","keys","length","parseInt","JSON","parse","valeur","resultatsDecedes","resultatsSauves","getBudget","c","currrentChrono","chronoTourTact","getPositionFromCarte","getPlayParameters","getConfiguration","param","forEach","ligne","indexI","indexJ","Math","floor","updateCarte","coords","value","error","updateMurH","m","updateMurV","updateBudget","action","depenses","bd","addHistAction","h","stringify","retourAction","pop","state","doAction","s","i","updateResultats","sauve","res","setBtnClickedBottom","revealHabitant","relacherHabitant","inter","interKeys","min","onTourChange","e","preventDefault","modifyBudgetsFin","cycle","sequence","prochainPomp","prochainTour","prochainCycle","prochaineSequence","prochainChrono","getBudgetsPompFin","then","budgetsFin","b","index","numCycle","numSeq","equipements","saveBudgetsPompFin","newCarte","evenementsAleatoire","nouveauTour","nouveauBudget","budgetInter","stocksEq","emit","on","data","d","console","log","start","test","deplacementAutorise","deplacement","dpl","dplInterditsCases","valeurCaseDeplacement","dplInterditsMurs","testRelacherHabitant","mursBloquants","setTimeout","casesAutour","getCasesAutour","dessus","resetHistAction","droite","dessous","gauche","cases","getMursAutour","murs","btnClickedBottom","propositionsCase","setPropositionsCase","propositionMursDetruire","setPropositionMursDetruire","handleClicCase","valeurAvant","valeurApres","coordX","coordY","handleClicMur","num","checkInCoords","numClic","cote","handleClicFleche","handleChangePiece","handleClicDoor","ouvrir","valueAvant","valueApres","handleClicExtincteur","mursInterdits","mursAutour","listeCasesAction","handleClicMarqueur","mursADetruire","propositions","handleClicValidated","bool","nbPompEquipe","nbToursParCycle","chronoTourInter","nbCyclesParSequence","handleNoClicked","handleClicHabitant","valeurDessus","valeurDroite","valeurDessous","valeurGauche","getRandomCoords","mini","maxi","y","random","x","handleMortHab","r","handleExplosion","randomPos","val","valeurFin","j","mur","addFumToCarte","embrasementFum","modified","mursCote","countHab","count","addHabitants","nbHabitantsASauver","newPos","round","textes","setTextes","getTextes","getTexts","getText","name","contenu","renderAttenteLancement","color","textAlign","fontSize","display","alignItems","flexDirection","justifyContent","flex","width","height","budgetTourMax"],"mappings":"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","sourcesContent":["import \"../styles/App.css\"\r\nimport React, { useState, useEffect, useRef } from 'react'\r\nimport PlayAPI from \"../API/PlayAPI\"\r\nimport TactBandeauTop from \"../components/interfaceJoueur/TactBandeauTop\"\r\nimport TactBandeauBottom from \"../components/interfaceJoueur/TactBandeauBottom\"\r\nimport Grille from \"../components/interfaceJoueur/Grille\"\r\nimport { useHistory } from 'react-router-dom';\r\n\r\n\r\nimport cookie from 'react-cookies'\r\nimport TactBandeauDroite from \"../components/interfaceJoueur/TactBandeauDroite\"\r\nimport { Typography } from \"@material-ui/core\"\r\nimport ContentsAPI from \"../API/ContentsAPI\"\r\nimport io from 'socket.io-client'\r\n\r\n\r\nconst TactInterface = () => {\r\n\r\n  const history = useHistory()\r\n  const user = cookie.load(\"user\")\r\n\r\n  const [socket, setSocket] = useState(null)\r\n\r\n\r\n  \r\n  const handleDisconnect = () => {\r\n    if(socket!==null){\r\n      socket.disconnect()\r\n      \r\n    }\r\n    cookie.save('user', \"disconnected\", {\r\n      path: '/',\r\n      maxAge: 60 * 60 * 1.5, //sec\r\n    })\r\n    history.push('/login');\r\n  }\r\n\r\n  if (user === null || user === undefined || user == \"disconnected\") history.push(\"/login\");\r\n  if (user !== null && user !== undefined && user.role !== undefined && !user.role.includes(\"TACT\")) handleDisconnect()\r\n  const [play, setPlay] = useState(false)\r\n\r\n\r\n\r\n  const [numPompier, setNumPompier] = useState(user !== null && user !== undefined && user.role !== undefined ? user.role.replace(\"TACT\", \"\") : null)\r\n  const [currentPomp, setCurrentPomp] = useState(null)\r\n  const [currentTour, setCurrentTour] = useState(null)\r\n  const [currentCycle, setCurrentCycle] = useState(null)\r\n  const [currentSequence, setCurrentSequence] = useState(null)\r\n  const [session, setSession] = useState(user != null ? user.session : null)\r\n  const [equipe, setEquipe] = useState(user != null ? user.equipe : null)\r\n  const [position, setPosition] = useState(null)\r\n  const [deplacementEnCours, setDeplacementEnCours] = useState({\r\n    type: 0,\r\n    rotation: 1\r\n  })\r\n  const [histActions, setHistActions] = useState([])\r\n  const [chrono, setChrono] = useState(null)\r\n  useEffect(() => {\r\n    if (numPompier == null) handleDisconnect()\r\n  }, [numPompier])\r\n\r\n\r\n\r\n\r\n  const [configuration, setConfiguration] = useState(null)\r\n\r\n  const [stocks, setStocks] = useState(null)\r\n\r\n  const [resultats, setResultats] = useState({\r\n    Decedes: 0,\r\n    Sauves: 0\r\n  })\r\n\r\n  const [interventions, setInterventions] = useState({\r\n    Deplacement: 0,\r\n    Feu: 0,\r\n    FeuFum: 0,\r\n    Fum: 0,\r\n    Marqueur: 0,\r\n    Porte: 0,\r\n    Habitant: 0\r\n  })\r\n\r\n  const [budget, setBudget] = useState(0)\r\n  const [budgetDepense, setBudgetDepense] = useState(0)\r\n\r\n\r\n  const isLoading = useRef(false)\r\n\r\n  // INITIALISATION DE LA CARTE\r\n\r\n  // const [carte, setCarte] = useState([\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  // ])\r\n\r\n  const [carte, setCarte] = useState([])\r\n\r\n  const [nbLignesGrille, setNbLignesGrille] = useState(0)\r\n  const [nbColonnesGrille, setNbColonnesGrille] = useState(0)\r\n\r\n  const [mursH, setMursH] = useState([\r\n    [1, 1, 1, 1, 1, 1, 2, 6, 1, 1, 1, 1, 2, 5, 1, 1],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [1, 1, 1, 1, 2, 6, 1, 6, 2, 1, 1, 1, 5, 2, 1, 1],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [1, 1, 1, 1, 1, 1, 6, 2, 1, 1, 1, 1, 1, 1, 1, 1]\r\n  ])\r\n\r\n  const [mursV, setMursV] = useState([\r\n    [1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],\r\n    [2, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],\r\n    [5, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],\r\n    [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1],\r\n    [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 2, 0, 0, 0, 0, 0, 1],\r\n    [1, 0, 0, 0, 0, 0, 2, 0, 0, 0, 5, 0, 0, 0, 0, 0, 1],\r\n    [1, 0, 0, 0, 0, 0, 5, 0, 0, 0, 5, 0, 0, 0, 0, 0, 2],\r\n    [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 2, 0, 0, 0, 0, 0, 5]\r\n  ])\r\n\r\n\r\n\r\n  // GET PLAY PARAMETERS \r\n  const getPlayState = async (session, equipe) => {\r\n    // console.log(\"get play state\")\r\n    if (!isLoading.current) {\r\n      isLoading.current = true\r\n      const currentPlayState = await PlayAPI.getPlayState(session, equipe)\r\n      // console.log(currentPlayState)\r\n      if (Object.keys(currentPlayState).length > 0) {\r\n        // console.log(parseInt(JSON.parse(currentPlayState.currentTour.valeur)))\r\n\r\n        setCurrentPomp(parseInt(JSON.parse(currentPlayState.currentPomp.valeur)))\r\n        setCurrentTour(parseInt(JSON.parse(currentPlayState.currentTour.valeur)))\r\n        setCurrentCycle(parseInt(JSON.parse(currentPlayState.currentCycle.valeur)))\r\n        setCurrentSequence(parseInt(JSON.parse(currentPlayState.currentSequence.valeur)))\r\n\r\n        setMursH(JSON.parse(currentPlayState.mursH.valeur))\r\n        setMursV(JSON.parse(currentPlayState.mursV.valeur))\r\n        setCarte(JSON.parse(currentPlayState.carte.valeur))\r\n        setResultats({\r\n          Decedes: parseInt(JSON.parse(currentPlayState.resultatsDecedes.valeur)),\r\n          Sauves: parseInt(JSON.parse(currentPlayState.resultatsSauves.valeur)),\r\n        })\r\n        setPlay(JSON.parse(currentPlayState.play.valeur))\r\n        // if(parseInt(JSON.parse(currentPlayState.currentPomp.valeur))==1 && parseInt(JSON.parse(currentPlayState.currentTour.valeur))==1){\r\n        getBudget(parseInt(JSON.parse(currentPlayState.currentCycle.valeur)), parseInt(JSON.parse(currentPlayState.currentSequence.valeur)))\r\n        //  }\r\n        const c = parseInt(JSON.parse(currentPlayState.currrentChrono.valeur))\r\n        if (configuration !== null && c <= configuration.chronoTourTact.valeur && parseInt(JSON.parse(currentPlayState.currentPomp.valeur)) == numPompier) {\r\n          if(c==0){\r\n            setChrono(configuration.chronoTourTact.valeur)\r\n          }else{\r\n            setChrono(c)\r\n          }\r\n          \r\n          // console.log(c)\r\n        } else {\r\n          setChrono(null)\r\n          // console.log(c,configuration.chronoTourTact.valeur)\r\n        }\r\n      }\r\n      getPositionFromCarte(JSON.parse(currentPlayState.carte.valeur))\r\n      isLoading.current = false\r\n    }\r\n\r\n  }\r\n\r\n\r\n  useEffect(() => {\r\n    // console.log(carte)\r\n    if (carte.length > 0) {\r\n      setNbLignesGrille(carte.length)\r\n      setNbColonnesGrille(carte[0].length)\r\n      getPositionFromCarte(carte)\r\n    }\r\n\r\n  }, [carte])\r\n\r\n  // useEffect(()=>{\r\n  //   console.log(currentTour)\r\n  // },[currentTour])\r\n\r\n\r\n  useEffect(() => {\r\n    if (session != null && equipe != null && currentTour == null) {\r\n      if (!isLoading.current && configuration !== null) getPlayState(session, equipe)\r\n      getPlayParameters()\r\n      getPositionFromCarte(carte)\r\n    }\r\n  }, [session, equipe, numPompier, configuration])\r\n\r\n  const getPlayParameters = async () => {\r\n    const param = await PlayAPI.getConfiguration(session)\r\n    setConfiguration(param)\r\n  }\r\n\r\n  const getPositionFromCarte = (carte) => {\r\n    if (carte != null && carte.length > 0) {\r\n      carte.forEach((ligne, indexI) => {\r\n        ligne.forEach((valeur, indexJ) => {\r\n\r\n          if (Math.floor(valeur / 1000) == 1 && Math.floor(valeur % 1000 / 100) == numPompier) {\r\n            setPosition([indexI, indexJ])\r\n            setDeplacementEnCours({\r\n              type: 0,\r\n              rotation: valeur % 10\r\n            })\r\n          }\r\n\r\n        })\r\n      });\r\n    }\r\n  }\r\n \r\n\r\n\r\n\r\n\r\n\r\n  // const onTextChange = (e) => {\r\n  //   setNumPompier(e.target.value)\r\n  //   console.log(typeof (e.target.value))\r\n  // }\r\n\r\n  // const onXChange = (e) => {\r\n  //   e.preventDefault()\r\n  //   if (e.target.value.length > 0) {\r\n  //     updateCarte(position, 0)\r\n  //     setPosition(position => [position[0], parseInt(e.target.value)])\r\n  //   } else {\r\n  //     updateCarte(position, 0)\r\n  //     setPosition(position => [position[0], 0])\r\n  //   }\r\n\r\n  // }\r\n  // const onYChange = (e) => {\r\n  //   e.preventDefault()\r\n  //   if (e.target.value.length > 0) {\r\n  //     updateCarte(position, 0)\r\n  //     setPosition(position => [parseInt(e.target.value), position[1]])\r\n  //   } else {\r\n  //     updateCarte(position, 0)\r\n  //     setPosition(position => [0, position[1]])\r\n  //   }\r\n  // }\r\n\r\n\r\n  // UPDATES\r\n  const updateCarte = (coords, value) => {\r\n    if (coords[0] < nbLignesGrille && coords[1] < nbColonnesGrille) {\r\n      try {\r\n        var c = [...carte]\r\n        c[coords[0]][coords[1]] = value\r\n        setCarte(c)\r\n      } catch (error) {\r\n        // console.log(error)\r\n      }\r\n    }\r\n\r\n\r\n  }\r\n  const updateMurH = (coords, value) => {\r\n    if (coords[0] < mursH.length && coords[1] < mursH[0].length) {\r\n      try {\r\n        var m = [...mursH]\r\n        m[coords[0]][coords[1]] = value\r\n        setMursH(m)\r\n\r\n      } catch (error) {\r\n        // console.log(error)\r\n      }\r\n    }\r\n  }\r\n  const updateMurV = (coords, value) => {\r\n    if (coords[0] < mursV.length && coords[1] < mursV[0].length) {\r\n      try {\r\n        var m = [...mursV]\r\n        m[coords[0]][coords[1]] = value\r\n        setMursV(m)\r\n      } catch (error) {\r\n        // console.log(error)\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  // ACTIONS\r\n\r\n  const updateBudget = (action) => {\r\n    var depenses = 0\r\n    if (configuration[\"coutEq\" + action] != null) depenses += configuration[\"coutEq\" + action].valeur\r\n    if (configuration[\"coutInter\" + action] != null) depenses += configuration[\"coutInter\" + action].valeur\r\n\r\n    setBudget(budget => budget - depenses)\r\n    setBudgetDepense(bd => bd + depenses)\r\n  }\r\n\r\n\r\n\r\n\r\n  const addHistAction = (budget, budgetDepense) => {\r\n    // console.log(\"add hist\")\r\n    const h = [...histActions, {\r\n      carte: JSON.stringify(carte),\r\n      budget: JSON.stringify(budget),\r\n      budgetDepense: JSON.stringify(budgetDepense),\r\n      mursH: JSON.stringify(mursH),\r\n      mursV: JSON.stringify(mursV),\r\n      stocks: JSON.stringify(stocks),\r\n      resultats: JSON.stringify(resultats),\r\n      interventions: JSON.stringify(interventions),\r\n      deplacementEnCours: JSON.stringify({\r\n        type: 0,\r\n        rotation: deplacementEnCours.rotation\r\n      })\r\n    }]\r\n\r\n\r\n    setHistActions(h)\r\n  }\r\n\r\n  \r\n\r\n  const retourAction = () => {\r\n    // isLoading.current = true\r\n    var h = [...histActions]\r\n    \r\n    h.pop()\r\n    const state = h[h.length - 1]\r\n    // console.log(h)\r\n    // console.log(state)\r\n    // console.log(state.deplacementEnCours)\r\n\r\n    setCarte(JSON.parse(state.carte))\r\n    setMursH(JSON.parse(state.mursH))\r\n    setMursV(JSON.parse(state.mursV))\r\n    setStocks(JSON.parse(state.stocks))\r\n    setInterventions(JSON.parse(state.interventions))\r\n    setResultats(JSON.parse(state.resultats))\r\n    setBudget(JSON.parse(state.budget))\r\n    setBudgetDepense(JSON.parse(state.budgetDepense))\r\n\r\n    setDeplacementEnCours(JSON.parse(state.deplacementEnCours))\r\n    \r\n    setHistActions(h)\r\n\r\n    // isLoading.current = false\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (position !== null && stocks !== null && budget > 0 && deplacementEnCours.type == 0 && (histActions[histActions.length - 1] == undefined || budget < histActions[histActions.length - 1].budget)) {\r\n      addHistAction(budget, budgetDepense)\r\n    }\r\n  }, [deplacementEnCours, budgetDepense, stocks])\r\n\r\n  // useEffect(() => {\r\n  //   console.log(\"hist Actions\")\r\n  //   console.log(histActions)\r\n  // }, [histActions])\r\n\r\n  // useEffect(()=>{\r\n  //   if( position!==null && budget>0){\r\n\r\n  //     if(histActions[histActions.length-1]!==undefined && budget<histActions[histActions.length-1].budget ){\r\n\r\n  //       addHistAction(budget)\r\n  //     }\r\n  //   }\r\n  // },[budget])\r\n\r\n  const doAction = (action) => {\r\n    // console.log(action)\r\n\r\n    try {\r\n      if (Object.keys(stocks).includes(action)) {\r\n        var s = stocks\r\n        s[action] = s[action] - 1\r\n        setStocks(s)\r\n      }\r\n\r\n    } catch (error) { }\r\n\r\n    try {\r\n      if (Object.keys(interventions).includes(action)) {\r\n        var i = interventions\r\n        i[action] = i[action] - 1\r\n        setInterventions(i)\r\n      }\r\n    } catch (error) { }\r\n\r\n    // setTimeout(() => {\r\n    updateBudget(action)\r\n    // }, 1000);\r\n\r\n  }\r\n\r\n  const updateResultats = (sauve) => {\r\n    var res = { ...resultats }\r\n    if (sauve) {\r\n      res.Sauves += 1\r\n    } else {\r\n      res.Decedes += 1\r\n    }\r\n    // console.log(res)\r\n    setResultats(res)\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n  useEffect(() => {\r\n    setBtnClickedBottom(null)\r\n    revealHabitant()\r\n  }, [position])\r\n\r\n\r\n  useEffect(() => {\r\n    if (carte.length > 0) relacherHabitant()\r\n\r\n  }, [position, mursH, mursV])\r\n\r\n\r\n\r\n\r\n  // useEffect(() => {\r\n  //   console.log(\"Stocks\")\r\n  //   console.log(stocks)\r\n  // }, [stocks])\r\n\r\n\r\n\r\n  useEffect(() => {\r\n    if (configuration != null) {\r\n      var inter = {...interventions}\r\n      const interKeys = Object.keys(inter)\r\n      // console.log(Math.floor(budget / configuration[\"coutInter\" + \"Habitant\"].valeur))\r\n      interKeys.forEach(action => {\r\n        try {\r\n          if (configuration[\"coutInter\" + action].valeur > 0) {\r\n            // if(action==\"Habitant\"){\r\n            //   console.log(stocks !== null && stocks[action] != null && stocks[action] != undefined && stocks[action] != \"NaN\" ? stocks[action] : 1000)\r\n            // }\r\n            inter[action] = Math.min(\r\n              configuration[\"coutEq\" + action] != null && configuration[\"coutEq\" + action] != undefined ? Math.floor(budget / (configuration[\"coutInter\" + action].valeur + configuration[\"coutEq\" + action].valeur)) : Math.floor(budget / configuration[\"coutInter\" + action].valeur),\r\n              stocks !== null && stocks[action] != null && stocks[action] != undefined && stocks[action] != \"NaN\" ? stocks[action] : 1000\r\n            )\r\n          }\r\n        } catch (error) {\r\n          // console.log(error, action)\r\n        }\r\n\r\n      })\r\n      // console.log(inter)\r\n      setInterventions(inter)\r\n\r\n    } else {\r\n      // getPlayParameters()\r\n    }\r\n  }, [budget, configuration, numPompier, stocks])\r\n\r\n  // SOCKETS\r\n\r\n  // SOCKETS \r\n  const onTourChange = async (e) => {\r\n    e.preventDefault()\r\n    // console.log(\"nouveau tour todo\")\r\n  }\r\n\r\n  const modifyBudgetsFin = async (cycle, sequence,prochainPomp,prochainTour,prochainCycle,prochaineSequence,prochainChrono) => {\r\n    // console.log(\"budgets modified 0\")\r\n    PlayAPI.getBudgetsPompFin(session, equipe).then(\r\n      (res) => {\r\n        // console.log(res)\r\n        var budgetsFin = JSON.parse(res.valeur)\r\n\r\n        try {\r\n          budgetsFin.interventions.forEach((b, index) => {\r\n            if (b.numCycle == cycle && b.numSeq == sequence) {\r\n\r\n              budgetsFin[\"interventions\"][index][\"pomp\" + numPompier] = budget\r\n            }\r\n\r\n          })\r\n        } catch (error) {\r\n\r\n        }\r\n\r\n        try {\r\n          budgetsFin.equipements.forEach((e, index) => {\r\n            if (e.numCycle == cycle && e.numSeq == sequence) {\r\n              budgetsFin[\"equipements\"][index][\"Feu\"][\"pomp\" + numPompier] = stocks.Feu\r\n              budgetsFin[\"equipements\"][index][\"FeuFum\"][\"pomp\" + numPompier] = stocks.FeuFum\r\n              budgetsFin[\"equipements\"][index][\"Fum\"][\"pomp\" + numPompier] = stocks.Fum\r\n              budgetsFin[\"equipements\"][index][\"Marqueur\"][\"pomp\" + numPompier] = stocks.Marqueur\r\n            }\r\n\r\n          })\r\n        } catch (error) {\r\n\r\n        }\r\n        // console.log(\"budgets modified 1\")\r\n        PlayAPI.saveBudgetsPompFin(budgetsFin, session, equipe).then(() => {\r\n          const newCarte = evenementsAleatoire()\r\n           PlayAPI.nouveauTour(socket, prochainPomp, newCarte, mursH, mursV, prochaineSequence, prochainCycle, prochainTour, resultats.Decedes, resultats.Sauves, session, equipe,prochainChrono )\r\n          // return budgetsFin\r\n        }\r\n\r\n\r\n        )\r\n      })\r\n\r\n  }\r\n\r\n  const getBudget = async (cycle, sequence) => {\r\n    var nouveauBudget = await PlayAPI.getBudgetsPompFin(session, equipe)\r\n    nouveauBudget = nouveauBudget.valeur\r\n    // console.log(nouveauBudget)\r\n    nouveauBudget = JSON.parse(nouveauBudget)\r\n\r\n    let budgetInter = 0\r\n    let stocksEq = stocks !== null && stocks !== undefined ? { ...stocks } : { Feu: 0, FeuFum: 0, Fum: 0, Marqueur: 0 }\r\n\r\n    try {\r\n      nouveauBudget.interventions.forEach((b) => {\r\n        if (b.numCycle == cycle && b.numSeq == sequence) {\r\n\r\n          budgetInter = b[\"pomp\" + numPompier]\r\n        }\r\n\r\n      })\r\n    } catch (error) {\r\n\r\n    }\r\n\r\n    try {\r\n      nouveauBudget.equipements.forEach((e) => {\r\n        if (e.numCycle == cycle && e.numSeq == sequence) {\r\n          stocksEq.Feu += e.Feu[\"pomp\" + numPompier]\r\n          stocksEq.FeuFum += e.FeuFum[\"pomp\" + numPompier]\r\n          stocksEq.Fum += e.Fum[\"pomp\" + numPompier]\r\n          stocksEq.Marqueur += e.Marqueur[\"pomp\" + numPompier]\r\n        }\r\n\r\n      })\r\n    } catch (error) {\r\n\r\n    }\r\n\r\n    // console.log(nouveauBudget)\r\n    if (budgetInter !== budget) {\r\n      setBudget(budgetInter)\r\n      setBudgetDepense(0)\r\n\r\n    }\r\n    setStocks(stocksEq)\r\n\r\n\r\n  }\r\n\r\n  \r\n  // console.log(socket)\r\n  useEffect(() => {\r\n    if (socket === null && configuration !== null) {\r\n      const s = io(\"https://www.back.leaders-extreme.fr\")\r\n      \r\n      // console.log(\"test\")\r\n      s.emit(\"connecti\",JSON.stringify({\r\n        session:session,\r\n        equipe:equipe\r\n      }))\r\n\r\n      s.on('changementTour', (data) => {\r\n        // console.log(\"changement tour\")\r\n        const d =data\r\n        console.log(d)\r\n        if (currentPomp != d.currentPomp || currentCycle !== d.currentCycle || currentTour !== d.currentTour || currentSequence !== d.currentSequence) {\r\n          console.log(\"changement tour\")\r\n          getPlayState(session, equipe)\r\n        }\r\n      })\r\n\r\n\r\n      // s.on('revealHabitant', (data) => {\r\n      //   if (carte !== null && carte.length > 0) {\r\n      //     // console.log(carte[data.y][data.x])\r\n      //     console.log(carte[data.y])\r\n      //     if (carte[data.y][data.x] == 20) {\r\n      //       // console.log([data.y,data.x])\r\n      //       updateCarte([data.y, data.x], data.type)\r\n      //       // console.log(\"socket hab\")\r\n      //       // console.log(data)\r\n      //     }\r\n      //   }\r\n      // })\r\n\r\n      s.on('startStopPartie', (data) => {\r\n        setPlay(data.start)\r\n      });\r\n      s.on('disconnectUsers', (data) => {\r\n        setPlay(false)\r\n        handleDisconnect()\r\n      });\r\n      setSocket(s)\r\n    }\r\n\r\n\r\n\r\n  }, [socket, configuration]);\r\n\r\n\r\n\r\n  // TESTS\r\n\r\n  const test = async () => {\r\n\r\n    // console.log(\"test function\")\r\n\r\n  }\r\n\r\n// useEffect(()=>{\r\n//   console.log(interventions,budget)\r\n// },[interventions,budget])\r\n\r\n\r\n  // AUTORISATIONS \r\n  const deplacementAutorise = (deplacement) => {\r\n    // return true\r\n    var dpl = [...deplacement]\r\n    if (dpl[0] == 0 && dpl[1] == 0) return false\r\n    if (position[0] + dpl[0] > carte.length - 1 || position[1] + dpl[1] > carte[0].length - 1 || position[0] + dpl[0] < 0 || position[1] + dpl[1] < 0) return false\r\n\r\n\r\n    const dplInterditsCases = [1000, 20, 3, 4]\r\n\r\n    try {\r\n      const valeurCaseDeplacement = carte[position[0] + dpl[0]][position[1] + dpl[1]]\r\n      if (Math.floor(valeurCaseDeplacement / 1000) == 1) return false\r\n      if (Math.floor(valeurCaseDeplacement / 10) == 2) return false\r\n      if (dplInterditsCases.includes(valeurCaseDeplacement)) return false\r\n    } catch (error) { }\r\n\r\n    const dplInterditsMurs = [1, 2, 3, 5]\r\n    try {\r\n      if (dpl[0] != 0) { // haut bas\r\n        if (dpl[0] < 0) {\r\n          dpl[0] = 0\r\n        }\r\n        if (typeof (mursH[position[0] + dpl[0]][position[1]]) === 'undefined') return false\r\n        if (dplInterditsMurs.includes(mursH[position[0] + dpl[0]][position[1]])) return false\r\n      } else { // gauche droite\r\n        if (dpl[1] < 0) {\r\n          dpl[1] = 0\r\n        }\r\n        if (typeof (mursV[position[0]][position[1] + dpl[1]]) === 'undefined') return false\r\n        if (dplInterditsMurs.includes(mursV[position[0]][position[1] + dpl[1]])) return false\r\n      }\r\n    } catch (error) { }\r\n\r\n\r\n\r\n\r\n    return true\r\n  }\r\n  const testRelacherHabitant = () => {\r\n    if (carte[position[0]][position[1]] % 100 < 10) return false // pas de transport d'habitant\r\n\r\n    const mursBloquants = [1, 2, 3, 5]\r\n\r\n    if (position[0] == 0 && !mursBloquants.includes(mursH[position[0]][position[1]])) return true // haut\r\n    if (position[0] == nbLignesGrille - 1 && !mursBloquants.includes(mursH[position[0] + 1][position[1]])) return true // bas\r\n\r\n    if (position[1] == 0 && !mursBloquants.includes(mursV[position[0]][position[1]])) return true // gauche\r\n    if (position[1] == nbColonnesGrille - 1 && !mursBloquants.includes(mursV[position[0]][position[1] + 1])) return true // droite\r\n\r\n    return false\r\n  }\r\n  const relacherHabitant = () => {\r\n    if (testRelacherHabitant()) {\r\n      setTimeout(() => {\r\n        updateResultats(true)\r\n        updateCarte(position, carte[position[0]][position[1]] - (carte[position[0]][position[1]] % 100 - carte[position[0]][position[1]] % 10))\r\n      }, 1000);\r\n    }\r\n  }\r\n\r\n  const revealHabitant = async () => {\r\n\r\n    if (configuration != null) {\r\n      const casesAutour = getCasesAutour()\r\n\r\n      try {\r\n        if (casesAutour.dessus == 20) {\r\n          updateCarte([position[0] - 1, position[1]], 0)\r\n          resetHistAction()\r\n          // const response = await PlayAPI.revealHabitant(socket, [position[0] - 1, position[1]], 0)\r\n        }\r\n      } catch (error) { }\r\n      try {\r\n        if (casesAutour.droite == 20) {\r\n          updateCarte([position[0], position[1] + 1], 0)\r\n          resetHistAction()\r\n          // const response = await PlayAPI.revealHabitant(socket, [position[0], position[1] + 1], 0)\r\n\r\n        }\r\n      } catch (error) { }\r\n      try {\r\n        if (casesAutour.dessous == 20) {\r\n          updateCarte([position[0] + 1, position[1]], 0)\r\n          resetHistAction()\r\n          // const response = await PlayAPI.revealHabitant(socket, [position[0] + 1, position[1]], 0)\r\n\r\n        }\r\n      } catch (error) { }\r\n      try {\r\n        if (casesAutour.gauche == 20) {\r\n          updateCarte([position[0], position[1] - 1], 0)\r\n          resetHistAction()\r\n          // const response = await PlayAPI.revealHabitant(socket, [position[0], position[1] - 1], 0)\r\n\r\n        }\r\n      } catch (error) { }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  const getCasesAutour = () => {\r\n    var cases = {}\r\n\r\n    try {\r\n      cases[\"dessus\"] = (carte[position[0] - 1][position[1]]) // dessus\r\n    } catch (error) { }\r\n    try {\r\n      cases[\"droite\"] = (carte[position[0]][position[1] + 1]) // droite\r\n    } catch (error) { }\r\n    try {\r\n      cases[\"dessous\"] = (carte[position[0] + 1][position[1]]) // dessous\r\n    } catch (error) { }\r\n    try {\r\n      cases[\"gauche\"] = (carte[position[0]][position[1] - 1]) // gauche\r\n    } catch (error) { }\r\n    return cases\r\n  }\r\n  const getMursAutour = (position) => {\r\n    var murs = []\r\n\r\n    try {\r\n      if (mursH[position[0]][position[1]] != 4 || (mursH[position[0]][position[1] - 1] < 6 && mursH[position[0]][position[1] + 1] < 6)) {\r\n        murs.push(mursH[position[0]][position[1]]) // dessus\r\n      } else {\r\n        murs.push(0)\r\n      }\r\n    } catch (error) { }\r\n\r\n    try {\r\n      if (mursV[position[0]][position[1] + 1] != 4 || (mursV[position[0] - 1][position[1] + 1] < 6 && mursV[position[0] + 1][position[1] + 1] < 6)) {\r\n        murs.push(mursV[position[0]][position[1] + 1])  // droite\r\n      } else {\r\n        murs.push(0)\r\n      }\r\n    } catch (error) { }\r\n\r\n    try {\r\n      if (mursH[position[0] + 1][position[1]] != 4 || (mursH[position[0] + 1][position[1] - 1] < 6 && mursH[position[0] + 1][position[1] + 1] < 6)) {\r\n        murs.push(mursH[position[0] + 1][position[1]]) // dessous\r\n      } else {\r\n        murs.push(0)\r\n      }\r\n\r\n    } catch (error) { }\r\n    try {\r\n      if (mursV[position[0]][position[1]] != 4 || (mursV[position[0] - 1][position[1]] < 6 && mursV[position[0] + 1][position[1]] < 6)) {\r\n        murs.push(mursV[position[0]][position[1]])  // gauche\r\n      } else {\r\n        murs.push(0)\r\n      }\r\n    } catch (error) { }\r\n    // console.log(murs)\r\n    return murs\r\n  }\r\n\r\n  // useEffect(()=>{\r\n  //   console.log(histActions)\r\n  // },[histActions])\r\n\r\n  const resetHistAction = () => {\r\n    // console.log(\"reset actions\")\r\n    setTimeout(() => {\r\n      setHistActions([{\r\n        carte: JSON.stringify(carte),\r\n        budget: JSON.stringify(budget),\r\n        budgetDepense: JSON.stringify(budgetDepense),\r\n        mursH: JSON.stringify(mursH),\r\n        mursV: JSON.stringify(mursV),\r\n        stocks: JSON.stringify(stocks),\r\n        resultats: JSON.stringify(resultats),\r\n        interventions: JSON.stringify(interventions),\r\n        deplacementEnCours: JSON.stringify({\r\n          type: 0,\r\n          rotation: deplacementEnCours.rotation\r\n        })\r\n      }])\r\n    }, 300);\r\n  }\r\n\r\n\r\n  const [btnClickedBottom, setBtnClickedBottom] = useState(null)\r\n  const [propositionsCase, setPropositionsCase] = useState([]) // Extincteurs\r\n  const [propositionMursDetruire, setPropositionMursDetruire] = useState([[], []]) // Horizontaux  , Verticaux\r\n  useEffect(() => {\r\n    if (btnClickedBottom != 3 || btnClickedBottom == null) {\r\n      setPropositionMursDetruire([[], []])\r\n    }\r\n    if ((btnClickedBottom > 2 && btnClickedBottom < 6) || btnClickedBottom == null) {\r\n      setPropositionsCase([])\r\n    }\r\n  }, [btnClickedBottom])\r\n\r\n\r\n\r\n\r\n  // HANDLERS CLIC GRILLE\r\n\r\n  const handleClicCase = (valeurAvant, valeurApres, coordX, coordY) => {\r\n    try {\r\n      updateCarte([coordY, coordX], valeurApres)\r\n      setPropositionsCase([])\r\n      setBtnClickedBottom(null)\r\n\r\n      if (valeurAvant == 4 && valeurApres == 0) { // Extincteur flamme\r\n        doAction(\"Feu\")\r\n      }\r\n      if (valeurAvant == 4 && valeurApres == 3) { // Feu Fumée\r\n        doAction(\"FeuFum\")\r\n      }\r\n      if (valeurAvant == 3 && valeurApres == 0) { // Fumée\r\n        doAction(\"Fum\")\r\n      }\r\n      if (Math.floor(valeurAvant / 10) == 2 && valeurApres == 0) { // Habitant\r\n        doAction(\"Habitant\")\r\n        // console.log(carte[position[0]][position[1]] + (valeurAvant % 10)*10)\r\n        updateCarte(position, carte[position[0]][position[1]] + (valeurAvant % 10)*10)\r\n      }\r\n    } catch (error) { }\r\n  }\r\n\r\n  const handleClicMur = (num, valeurAvant, coordX, coordY) => { // marqueur dégat\r\n    if (propositionMursDetruire[0].length > 0 || propositionMursDetruire[1].length > 0) {\r\n\r\n      const checkInCoords = (index) => {\r\n        // console.log(\"coordx\",coordX,\"coordy\",coordY,\"position\",position)\r\n\r\n        let numClic = null\r\n\r\n        if (coordX == position[1] && (coordY < position[0] || (coordY == position[0] && num == 0))) { // top\r\n          numClic = 0  // case en question\r\n          // console.log(\"top\",numClic)\r\n        }\r\n        if (coordX == position[1] && (coordY > position[0] || (coordY == position[0] && num == 2))) { // bottom\r\n          numClic = 2  // case en question\r\n          // console.log(\"bottom\",numClic)\r\n        }\r\n        if (coordY == position[0] && (coordX < position[1] || (coordX == position[1] && num == 3))) { // left\r\n          numClic = 3  // case en question\r\n          // console.log(\"left\",numClic)\r\n        }\r\n        if (coordY == position[0] && (coordX > position[1] || (coordX == position[1] && num == 1))) { // right\r\n          numClic = 1  // case en question\r\n          // console.log(\"right\",numClic)\r\n        }\r\n\r\n        return numClic\r\n      }\r\n\r\n      var cote = checkInCoords(num % 2)\r\n      let valeurApres = 4\r\n      if (valeurAvant == 1) valeurApres = 3\r\n\r\n      if (cote != null) {\r\n        try {\r\n          switch (cote) {\r\n            case 0:\r\n              updateMurH([position[0], position[1]], valeurApres)\r\n              // if(valeurAvant==5 ||)\r\n              break;\r\n            case 1:\r\n              updateMurV([position[0], position[1] + 1], valeurApres)\r\n              break;\r\n            case 2:\r\n              updateMurH([position[0] + 1, position[1]], valeurApres)\r\n              break;\r\n            case 3:\r\n              updateMurV([position[0], position[1]], valeurApres)\r\n              break;\r\n          }\r\n\r\n          doAction(\"Marqueur\")\r\n\r\n\r\n        } catch (error) {\r\n        }\r\n\r\n\r\n\r\n        setPropositionMursDetruire([[], []])\r\n        setBtnClickedBottom(null)\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n\r\n  // HANDLER CLICS BOUTONS\r\n\r\n  const handleClicFleche = (num) => {\r\n    // Position y x\r\n    let deplacement\r\n    let rotation\r\n    switch (num) {\r\n      case 0: // haut\r\n        // console.log(\"haut\")\r\n        deplacement = [-1, 0]\r\n        rotation = 1\r\n        break;\r\n\r\n      case 1: // droite\r\n        // console.log(\"droite\")\r\n        deplacement = [0, 1]\r\n        rotation = 2\r\n        break;\r\n\r\n      case 2: // bas\r\n        // console.log(\"bas\")\r\n        deplacement = [1, 0]\r\n        rotation = 3\r\n        break;\r\n\r\n      case 3: // gauche\r\n        // console.log(\"gauche\")\r\n        deplacement = [0, -1]\r\n        rotation = 4\r\n        break;\r\n    }\r\n    if (deplacementAutorise(deplacement)) {\r\n\r\n      // ANIMATION MARCHE\r\n\r\n      setDeplacementEnCours({\r\n        type: 1,\r\n        rotation: rotation\r\n      })\r\n      setTimeout(() => {\r\n        updateCarte([position[0] + deplacement[0], position[1] + deplacement[1]], carte[position[0]][position[1]] - carte[position[0]][position[1]] % 10 + rotation)\r\n        // setPosition(position => [position[0] + deplacement[0], position[1] + deplacement[1]])\r\n        if((carte[position[0]][position[1]]%100 - carte[position[0]][position[1]]%10)/10>0){\r\n          doAction(\"DeplacementHab\")\r\n        }else{\r\n          doAction(\"Deplacement\")\r\n        }\r\n        \r\n        updateCarte(position, 0)\r\n\r\n\r\n        setDeplacementEnCours({\r\n          type: 2,\r\n          rotation: rotation\r\n        })\r\n        setTimeout(() => {\r\n          setDeplacementEnCours({\r\n            type: 0,\r\n            rotation: rotation\r\n          })\r\n        }, 500);\r\n\r\n      }, 500);\r\n\r\n\r\n    }\r\n  }\r\n\r\n  const handleChangePiece = () => {\r\n    resetHistAction()\r\n  }\r\n\r\n  const handleClicDoor = (ouvrir) => { // position, ouvert/fermé\r\n    setBtnClickedBottom(ouvrir ? 4 : 5)\r\n    let valueAvant\r\n    let valueApres\r\n\r\n    if (ouvrir) {\r\n      valueAvant = 5\r\n      valueApres = 6\r\n\r\n    } else {\r\n      valueAvant = 6\r\n      valueApres = 5\r\n    }\r\n    doAction(\"Porte\")\r\n    try {\r\n      if (mursH[position[0]][position[1]] == valueAvant) updateMurH([position[0], position[1]], valueApres)\r\n      if (mursH[position[0] + 1][position[1]] == valueAvant) updateMurH([position[0] + 1, position[1]], valueApres)\r\n      if (mursV[position[0]][position[1]] == valueAvant) updateMurV([position[0], position[1]], valueApres)\r\n      if (mursV[position[0]][position[1] + 1] == valueAvant) updateMurV([position[0], position[1] + 1], valueApres)\r\n    } catch (error) {\r\n\r\n    }\r\n  }\r\n\r\n  const handleClicExtincteur = (num) => {\r\n    // 0 FEU, 1 FEUFUM, 2 FUM\r\n    const mursInterdits= [1,2,3,5]\r\n    const mursAutour = getMursAutour(position)\r\n\r\n    if (btnClickedBottom != num) {\r\n      var listeCasesAction = []\r\n      let valeurAvant = 4\r\n      let valeurApres = 0\r\n      setBtnClickedBottom(num)\r\n      switch (num) {\r\n        case 0: // ETEINDRE FEU\r\n          break;\r\n\r\n        case 1: // FEU FUM\r\n          valeurApres = 3\r\n          break;\r\n        case 2: // ETEINDRE FUMEE\r\n          valeurAvant = 3\r\n          break;\r\n      }\r\n\r\n      try {\r\n        if (carte[position[0] - 1][position[1]] == valeurAvant && !mursInterdits.includes(mursAutour[0])) {\r\n          listeCasesAction.push([position[0] - 1, position[1], valeurAvant, valeurApres]) // TOP\r\n        }\r\n      } catch (error) { }\r\n      try {\r\n        if (carte[position[0]][position[1] + 1] == valeurAvant && !mursInterdits.includes(mursAutour[1])) {\r\n          listeCasesAction.push([position[0], position[1] + 1, valeurAvant, valeurApres]) // RIGHT\r\n        }\r\n      } catch (error) { }\r\n      try {\r\n        if (carte[position[0] + 1][position[1]] == valeurAvant && !mursInterdits.includes(mursAutour[2] )){ \r\n          listeCasesAction.push([position[0] + 1, position[1], valeurAvant, valeurApres]) // BOTTOM\r\n        }\r\n      } catch (error) { }\r\n      try {\r\n        if (carte[position[0]][position[1] - 1] == valeurAvant && !mursInterdits.includes(mursAutour[3])) {\r\n          listeCasesAction.push([position[0], position[1] - 1, valeurAvant, valeurApres]) // LEFT\r\n          console.log(\"test\")\r\n        }\r\n      } catch (error) { }\r\n\r\n      setPropositionsCase(listeCasesAction)\r\n    } else {\r\n      setBtnClickedBottom(null)\r\n    }\r\n\r\n  }\r\n\r\n  const handleClicMarqueur = () => {\r\n    if (btnClickedBottom != 3) {\r\n      setBtnClickedBottom(3)\r\n      if (propositionMursDetruire[0].length > 0 || propositionMursDetruire[1].length > 0) {\r\n        setPropositionMursDetruire([[], []])\r\n      } else {\r\n        const mursADetruire = [1, 3, 5, 6]\r\n        var propositions = [\r\n          [],\r\n          []\r\n        ]\r\n        const mursAutour = getMursAutour(position)\r\n\r\n        try {\r\n          if (mursADetruire.includes(mursAutour[0])) propositions[0].push([position[1], position[0]]) // top\r\n          if (mursADetruire.includes(mursAutour[1])) propositions[1].push([position[1] + 1, position[0]]) // right\r\n          if (mursADetruire.includes(mursAutour[2])) propositions[0].push([position[1], position[0] + 1]) // bottom\r\n          if (mursADetruire.includes(mursAutour[3])) propositions[1].push([position[1], position[0]]) // left\r\n\r\n        } catch (error) {\r\n\r\n        }\r\n        setPropositionMursDetruire(propositions)\r\n\r\n      }\r\n    } else {\r\n      setBtnClickedBottom(null)\r\n    }\r\n\r\n\r\n  }\r\n\r\n  const handleClicValidated = async (bool) => {\r\n    // console.log(\"handle Clic\")\r\n    if (configuration != null) {\r\n      if (bool) {\r\n\r\n\r\n        let prochainPomp = currentPomp + 1\r\n        let prochainTour = currentTour\r\n        let prochainCycle = currentCycle\r\n        let prochaineSequence = currentSequence\r\n        let prochainChrono = configuration.chronoTourTact.valeur\r\n\r\n\r\n        if (numPompier == configuration.nbPompEquipe.valeur) { // DERNIER POMP DU TOUR\r\n          if (currentTour == configuration.nbToursParCycle.valeur) { // SEND TO INTER\r\n            prochainTour = 1\r\n            prochainPomp = 0 // A CHANGER AVEC STRATEGIQUE\r\n\r\n            prochainChrono = configuration.chronoTourInter.valeur\r\n\r\n            if (prochainCycle == configuration.nbCyclesParSequence.valeur) {\r\n              prochainCycle = 1\r\n              prochaineSequence = prochaineSequence + 1\r\n            } else {\r\n              prochainCycle = prochainCycle + 1\r\n            }\r\n\r\n\r\n\r\n          } else { // PAS DERNIER TOUR DU CYCLE\r\n            // console.log(\"pas dernier tour\")\r\n            prochainPomp = 1\r\n            prochainTour = prochainTour + 1\r\n            // prochainChrono = configuration.chronoTourTact.valeur\r\n\r\n          }\r\n\r\n        }\r\n\r\n        // console.log(prochainPomp,prochainTour,prochainCycle)\r\n\r\n\r\n        \r\n        // console.log(\"budgets fin 1\")\r\n        const res = modifyBudgetsFin(currentCycle, currentSequence,prochainPomp,prochainTour,prochainCycle,prochaineSequence,prochainChrono)\r\n        \r\n        resetHistAction()\r\n\r\n        // setChrono(null)\r\n      } else {\r\n        retourAction()\r\n        // console.log(\"retour\")\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  const handleNoClicked = () => {\r\n    setPropositionMursDetruire([[], []])\r\n    setPropositionsCase([])\r\n  }\r\n\r\n  const handleClicHabitant = () => {\r\n    if (btnClickedBottom != 6) {\r\n      setBtnClickedBottom(6)\r\n      const valeurApres = 0\r\n      var listeCasesAction = []\r\n      try {\r\n        const valeurDessus = carte[position[0] - 1][position[1]]\r\n        if (Math.floor(valeurDessus / 10) == 2) listeCasesAction.push([position[0] - 1, position[1], valeurDessus, valeurApres]) // TOP\r\n      } catch (error) { }\r\n      try {\r\n        const valeurDroite = carte[position[0]][position[1] + 1]\r\n        if (Math.floor(valeurDroite / 10) == 2) listeCasesAction.push([position[0], position[1] + 1, valeurDroite, valeurApres]) // RIGHT\r\n      } catch (error) { }\r\n      try {\r\n        const valeurDessous = carte[position[0] + 1][position[1]]\r\n        if (Math.floor(valeurDessous / 10) == 2) listeCasesAction.push([position[0] + 1, position[1], valeurDessous, valeurApres]) // BOTTOM\r\n      } catch (error) { }\r\n      try {\r\n        const valeurGauche = carte[position[0]][position[1] - 1]\r\n        if (Math.floor(valeurGauche / 10) == 2) listeCasesAction.push([position[0], position[1] - 1, valeurGauche, valeurApres]) // LEFT\r\n      } catch (error) { }\r\n\r\n      setPropositionsCase(listeCasesAction)\r\n\r\n\r\n      // console.log(\"handle clic habitant\")\r\n    } else {\r\n      setBtnClickedBottom(null)\r\n    }\r\n\r\n  }\r\n\r\n\r\n\r\n\r\n  const getRandomCoords = (mini, maxi) => {\r\n    if (carte !== null && carte !== undefined && carte.length > 0) {\r\n      var y = Math.floor(Math.random() * (maxi[0] - mini[0])) + mini[0]\r\n      var x = Math.floor(Math.random() * (maxi[1] - mini[1])) + mini[1]\r\n\r\n      var type = carte[y][x]\r\n      while (Math.floor(type / 1000) == 1 || Math.floor(type / 10) == 2) {\r\n        y = Math.floor(Math.random() * (maxi[0] - mini[0])) + mini[0]\r\n        x = Math.floor(Math.random() * (maxi[1] - mini[1])) + mini[1]\r\n        type = carte[y][x]\r\n      }\r\n      // console.log(\"getRandomCoords\", y, x)\r\n      return [y, x]\r\n    }\r\n    return null\r\n  }\r\n\r\n\r\n\r\n  const handleMortHab=()=>{\r\n    var r = {...resultats}\r\n    r.Decedes=r.Decedes+1\r\n    setResultats(r)\r\n    // console.log(\"mort d'un habitant\")\r\n    \r\n  }\r\n\r\n\r\n  const handleExplosion=(randomPos,c)=>{\r\n    const mursAutour = getMursAutour(randomPos)\r\n    // console.log(mursAutour)\r\n\r\n    // MARQUEURS SUR LA CASE QUI EXPLOSE\r\n    mursAutour.forEach((val,index)=>{\r\n      var valeurFin =val\r\n      if([3,5].includes(val)) valeurFin = 4 // DESTRUCTION TOTALE\r\n      if(valeurFin==1) valeurFin=3\r\n\r\n\r\n\r\n      if(valeurFin==3 || valeurFin==4){\r\n        switch (index) {\r\n          case 0:\r\n            try {\r\n              updateMurH([randomPos[0], randomPos[1]], valeurFin)\r\n            }catch{}\r\n            break;\r\n          case 1:\r\n            try {\r\n              updateMurV([randomPos[0], randomPos[1] + 1], valeurFin)\r\n            }catch{}\r\n            \r\n            break;\r\n          case 2:\r\n            try {\r\n              updateMurH([randomPos[0] + 1, randomPos[1]], valeurFin)\r\n            }catch{}\r\n           \r\n            break;\r\n          case 3:\r\n            try {\r\n              updateMurV([randomPos[0], randomPos[1]], valeurFin)\r\n            }catch{}\r\n            \r\n            break;\r\n        }\r\n      \r\n      }\r\n    })\r\n\r\n    // PROPAGATION DANS LES DIFFERENTES DIRECTIONS\r\n\r\n    const mursInterdits= [1,2,3,5]\r\n    if(randomPos[1]<nbColonnesGrille-1 && c[randomPos[0]][randomPos[1]+1]==4){ // Propagation droite\r\n      // console.log(\"propa droite\")\r\n      let j=1\r\n      while(randomPos[1]+1+j<nbColonnesGrille){\r\n        \r\n        const type = c[randomPos[0]][randomPos[1]+1+j]\r\n        if(Math.floor( type/ 10)==2){\r\n          c[randomPos[0]][randomPos[1]+1+j]=4\r\n          handleMortHab()\r\n        }\r\n\r\n        if(Math.floor(type / 1000) == 1){\r\n          if (type % 100 < 10){\r\n            c[randomPos[0]][randomPos[1]+1+j]=type - (type % 100 - type % 10)\r\n            handleMortHab()\r\n          }else{\r\n            // console.log(\"mort d'un pompier solo\")\r\n          }\r\n        } \r\n\r\n\r\n        if(c[randomPos[0]][randomPos[1]+1+j]==3 || c[randomPos[0]][randomPos[1]+1+j] ==0) {\r\n          c[randomPos[0]][randomPos[1]+1+j]=4\r\n          break\r\n        }\r\n        const mur = getMursAutour([randomPos[0],randomPos[1]+1+j])[1]\r\n        if(mursInterdits.includes(mur)) {\r\n            try {\r\n              updateMurV([randomPos[0], randomPos[1] + 2 +j], 4)\r\n              break\r\n            }catch{}\r\n          \r\n        }\r\n        j+=1\r\n        \r\n      }\r\n    }\r\n    if(randomPos[1]>0 && c[randomPos[0]][randomPos[1]-1]==4){ // Propagation gauche\r\n      // console.log(\"propa gauche\")\r\n      let j=1\r\n      while(randomPos[1]-1-j>=0){\r\n        \r\n        const type = c[randomPos[0]][randomPos[1]-1-j]\r\n        if(Math.floor( type/ 10)==2){\r\n          c[randomPos[0]][randomPos[1]-1-j]=4\r\n          handleMortHab()\r\n        }\r\n\r\n        if(Math.floor(type / 1000) == 1){\r\n          if (type % 100 < 10){\r\n            c[randomPos[0]][randomPos[1]-1-j]=type - (type % 100 - type % 10)\r\n            handleMortHab()\r\n          }else{\r\n            // console.log(\"mort d'un pompier solo\")\r\n          }\r\n        } \r\n\r\n\r\n        if(c[randomPos[0]][randomPos[1]-1-j]==3 || c[randomPos[0]][randomPos[1]-1-j] ==0) {\r\n          c[randomPos[0]][randomPos[1]-1-j]=4\r\n          // console.log(\"break type\",randomPos[1]-1-j)\r\n          break\r\n        }\r\n        const mur = getMursAutour([randomPos[0],randomPos[1]-1-j])[3]\r\n        // console.log(murs)\r\n        if(mursInterdits.includes(mur)) {\r\n            try {\r\n              updateMurV([randomPos[0], randomPos[1]-j-1], 4)\r\n              break\r\n            }catch{}\r\n          \r\n        }\r\n        j-=1\r\n        \r\n      }\r\n    }\r\n    if(randomPos[0]>0 && c[randomPos[0]-1][randomPos[1]]==4){ // Propagation haut\r\n      // console.log(\"propa haut\")\r\n      let i=1\r\n      while(randomPos[0]-1-i>=0){\r\n        \r\n        const type = c[randomPos[0]-1-i][randomPos[1]]\r\n        if(Math.floor( type/ 10)==2){\r\n          c[randomPos[0]-1-i][randomPos[1]]=4\r\n          handleMortHab()\r\n        }\r\n\r\n        if(Math.floor(type / 1000) == 1){\r\n          if (type % 100 < 10){\r\n            c[randomPos[0]-1-i][randomPos[1]]=type - (type % 100 - type % 10)\r\n            handleMortHab()\r\n          }else{\r\n            // console.log(\"mort d'un pompier solo\")\r\n          }\r\n        } \r\n\r\n\r\n        if(c[randomPos[0]-1-i][randomPos[1]]==3 || c[randomPos[0]-1-i][randomPos[1]] ==0) {\r\n          c[randomPos[0]-1-i][randomPos[1]]=4\r\n          // console.log(\"break type\",randomPos[1]-1-j)\r\n          break\r\n        }\r\n        const mur = getMursAutour([randomPos[0]-1-i,randomPos[1]])[0]\r\n        // console.log(murs)\r\n        if(mursInterdits.includes(mur)) {\r\n            try {\r\n              updateMurH([randomPos[0]-1-i,randomPos[1]], 4)\r\n              break\r\n            }catch{}\r\n          \r\n        }\r\n        i-=1\r\n        \r\n      }\r\n    }\r\n\r\n    if(randomPos[0]<nbLignesGrille-1 && c[randomPos[0]+1][randomPos[1]]==4){ // Propagation bas\r\n      // console.log(\"propa bas\")\r\n      let i=0\r\n      while(randomPos[0]+1+i>=0){\r\n        \r\n        const type = c[randomPos[0]+1+i][randomPos[1]]\r\n        if(Math.floor( type/ 10)==2){\r\n          c[randomPos[0]+1+i][randomPos[1]]=4\r\n          handleMortHab()\r\n        }\r\n\r\n        if(Math.floor(type / 1000) == 1){\r\n          if (type % 100 < 10){\r\n            c[randomPos[0]+1+i][randomPos[1]]=type - (type % 100 - type % 10)\r\n            handleMortHab()\r\n          }else{\r\n            // console.log(\"mort d'un pompier solo\")\r\n          }\r\n        } \r\n\r\n\r\n        if(c[randomPos[0]+1+i][randomPos[1]]==3 || c[randomPos[0]+1+i][randomPos[1]] ==0) {\r\n          c[randomPos[0]+1+i][randomPos[1]]=4\r\n          // console.log(\"break type\")\r\n\r\n          break\r\n        }\r\n        const mur = getMursAutour([randomPos[0]+1+i,randomPos[1]])[2]\r\n        if(mursInterdits.includes(mur)) {\r\n            try {\r\n              updateMurH([randomPos[0]+2+i,randomPos[1]], 4)\r\n              break\r\n            }catch{}\r\n          \r\n        }\r\n        i+=1\r\n        \r\n      }\r\n    }\r\n    return c\r\n\r\n  }\r\n\r\n  const addFumToCarte = (randomPos) => {\r\n\r\n    var c = [...carte]\r\n    if (carte !== null && carte !== undefined && carte.length > 0 && randomPos !== null) {\r\n      // console.log(\"addFumToCarte\", randomPos[0], randomPos[1])\r\n\r\n      switch (c[randomPos[0]][randomPos[1]]) {\r\n        case 0: // VIDE\r\n        // console.log(\"vide => fum\")\r\n          c[randomPos[0]][randomPos[1]] = 3\r\n          break;\r\n\r\n        case 3: // FUMEE\r\n        // console.log(\"fum => feu\")\r\n          c[randomPos[0]][randomPos[1]] = 4\r\n          break;\r\n\r\n        case 4: // FEU\r\n\r\n          c=handleExplosion(randomPos,c)\r\n\r\n          // console.log(\"feu => explosion\")\r\n          break;\r\n\r\n        default:\r\n          // console.log(\"error\")\r\n          break;\r\n      }\r\n    }\r\n    return c\r\n  }\r\n\r\n\r\n  const embrasementFum = (c) => {\r\n    var modified = false\r\n    if (c !== null && c !== undefined && c.length > 0) {\r\n      const mursInterdits = [1, 2, 3, 5]\r\n      var i = -1\r\n      var j = -1\r\n      \r\n      while (i < nbLignesGrille - 1 ) {\r\n        i = i + 1\r\n        while (j < nbColonnesGrille - 1 ) {\r\n          j = j + 1\r\n          const mursCote = [mursH[i][j], mursV[i][j + 1], mursH[i + 1][j], mursV[i][j]]\r\n\r\n          if (i < c.length && j < c[0].length && c[i][j] == 4) { // ON PARCOURT LES FEUX\r\n            if (i > 0 && c[i - 1][j] == 3 && !mursInterdits.includes(mursCote[0])) {// juste dessus\r\n              c[i - 1][j] = 4\r\n              modified = true\r\n            }\r\n            if (j < nbColonnesGrille - 1 && c[i][j + 1] == 3 && !mursInterdits.includes(mursCote[1])) { // juste droite\r\n              c[i][j + 1] = 4\r\n              modified = true\r\n            }\r\n            if (i < nbLignesGrille - 1 && c[i + 1][j] == 3 && !mursInterdits.includes(mursCote[2])) { // juste dessous\r\n              c[i + 1][j] = 4\r\n              modified = true\r\n            }else{\r\n              \r\n            }\r\n            if (j > 0 && c[i][j - 1] == 3 && !mursInterdits.includes(mursCote[3])) { // GAUCHE\r\n              c[i][j - 1] = 4 \r\n              modified = true\r\n            }\r\n            \r\n          }\r\n        }\r\n        j = -1\r\n      }\r\n\r\n      if(modified){\r\n          embrasementFum(c)\r\n        \r\n        modified = false\r\n      }\r\n\r\n\r\n\r\n\r\n      // console.log(mursCote)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n      \r\n    }else{\r\n      // console.log(\"test\")\r\n    }\r\n    // console.log(\"embrasementFum\")\r\n    return c\r\n  }\r\n  const countHab = (carte) => {\r\n    if (carte != null && carte.length > 0) {\r\n      var count = 0\r\n      carte.forEach((ligne, indexI) => {\r\n        ligne.forEach((valeur, indexJ) => {\r\n\r\n          if (Math.floor(valeur / 10) == 2) {\r\n            count+=1\r\n          }\r\n\r\n        })\r\n      });\r\n      return count\r\n    }\r\n   \r\n  }\r\n\r\n  const addHabitants=(c)=>{\r\n    const count = countHab(c)\r\n    // console.log(count)\r\n    for(let i=0;i<configuration.nbHabitantsASauver.valeur-count;i++){\r\n      const newPos = getRandomCoords([0, 0], [nbLignesGrille, nbColonnesGrille])\r\n      c[newPos[0]][newPos[1]]=20+Math.round(Math.random())\r\n    }\r\n    // console.log(countHab(c))\r\n    return c\r\n\r\n  }\r\n\r\n\r\n  const evenementsAleatoire = () => {\r\n    const randomPos = getRandomCoords([0, 0], [nbLignesGrille, nbColonnesGrille])\r\n    // const randomPos=[2,9]\r\n    var c = addFumToCarte(randomPos)\r\n    c = embrasementFum(c)\r\n    c = addHabitants(c)\r\n    return c\r\n  }\r\n\r\n\r\n  // const [tester,setTester]=useState(false)\r\n\r\n\r\n  // useEffect(()=>{\r\n  //   if(!tester && carte !== null && carte !== undefined && carte.length>0 && nbLignesGrille>0 && nbColonnesGrille>0){\r\n  //     setTester(true)\r\n  //     console.log([...carte])\r\n  //     evenementsAleatoire()\r\n      \r\n  //   }\r\n\r\n    \r\n  // },[tester,carte,nbLignesGrille,nbColonnesGrille])\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  const [textes, setTextes] = useState(null)\r\n\r\n  useEffect(() => {\r\n    const getTextes = async () => {\r\n      const textes = ContentsAPI.getTexts(\"jeuTactInterface\").then(\r\n        (res) => { setTextes(res) }\r\n      )\r\n    }\r\n    if (textes == null) {\r\n      getTextes()\r\n    }\r\n    // console.log(textes)\r\n  }, [textes])\r\n\r\n\r\n\r\n\r\n  const getText = (name) => {\r\n    if (textes == null) {\r\n      return name\r\n    } else {\r\n      try {\r\n        return textes[name].contenu\r\n      } catch (error) {\r\n        // console.log(textes)\r\n        return name\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  const renderAttenteLancement = () => {\r\n\r\n    return (\r\n      <div style={{ color: \"gray\", textAlign: \"center\", fontSize: 20 }}>\r\n        <Typography >{getText('attenteLancement')}</Typography>\r\n        <Typography >{getText('infoLancement')}</Typography>\r\n      </div>\r\n    )\r\n  }\r\n  \r\n  return (\r\n\r\n\r\n\r\n    <div style={{ position: \"absolute\", display: \"flex\", alignItems: \"center\", flexDirection: \"column\", justifyContent: \"center\", flex: 1, width: \"100%\", height: \"100%\" }}>\r\n\r\n      {\r\n        carte.length > 0 && position != null && stocks !== null && numPompier !== null && play ?\r\n          <>\r\n\r\n            <Grille\r\n              nbColonnesGrille={nbColonnesGrille}\r\n              nbLignesGrille={nbLignesGrille}\r\n              carte={carte}\r\n              position={position}\r\n              mursH={mursH}\r\n              mursV={mursV}\r\n              propositionMursDetruire={propositionMursDetruire}\r\n              propositionsCase={propositionsCase}\r\n              handleClicMur={handleClicMur}\r\n              handleClicCase={handleClicCase}\r\n              handleChangePiece={handleChangePiece}\r\n              deplacementEnCours={deplacementEnCours}\r\n\r\n            />\r\n\r\n            <TactBandeauTop\r\n              stocks={stocks}\r\n              resultats={resultats}\r\n              numeroPompier={numPompier}\r\n              sequence={currentSequence}\r\n              cycle={currentCycle}\r\n              tour={currentTour}\r\n              pomp={currentPomp}\r\n              configuration={configuration}\r\n              budget={budget}\r\n              budgetDepense={budgetDepense}\r\n              equipe={equipe}\r\n              handleClicValidated={handleClicValidated}\r\n              play={play}\r\n              chronoInit={chrono}\r\n              numEquipe={equipe}\r\n              numSession={session}\r\n            />\r\n\r\n            <TactBandeauBottom\r\n              interventions={interventions}\r\n              stocks={stocks}\r\n              numeroPompier={numPompier}\r\n              tour={currentTour}\r\n              pomp={currentPomp}\r\n              handleClicFleche={handleClicFleche}\r\n              handleClicValidated={handleClicValidated}\r\n              handleClicDoor={handleClicDoor}\r\n              handleClicMarqueur={handleClicMarqueur}\r\n              handleClicExt={handleClicExtincteur}\r\n              handleNoClicked={handleNoClicked}\r\n              handleClicHabitant={handleClicHabitant}\r\n              btnClickedBottom={btnClickedBottom}\r\n              mursAutour={getMursAutour(position)}\r\n              casesAutour={getCasesAutour()}\r\n              currentCase={carte[position[0]][position[1]]}\r\n              histActions={histActions}\r\n              configuration={configuration}\r\n              deplacementEnCours={deplacementEnCours}\r\n              budgetMaxAtteint={budgetDepense >= configuration.budgetTourMax.valeur}\r\n              isLoading={false}\r\n            />\r\n            <TactBandeauDroite\r\n              handleDisconnect={handleDisconnect}\r\n              configuration={configuration}\r\n            />\r\n          </>\r\n          :\r\n          renderAttenteLancement()\r\n\r\n      }\r\n    </div>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  );\r\n\r\n}\r\n\r\nexport default TactInterface;\r\n\r\n\r\n// export default React.memo(TactInterface)"]},"metadata":{},"sourceType":"module"}