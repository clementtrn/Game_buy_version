{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/hugod/decitude/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/hugod/decitude/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/hugod/decitude/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import'../styles/App.css';import'../styles/Login.css';import{useEffect,useState}from'react';import{TextField,Button,Divider,Typography}from\"@material-ui/core\";import UsersAPI from\"../API/UsersAPI\";import ContentsAPI from\"../API/ContentsAPI\";import{useHistory}from'react-router-dom';import cookie from'react-cookies';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Login=function Login(_ref){var handleLogin=_ref.handleLogin,userConnected=_ref.userConnected,handleDisconnectApp=_ref.handleDisconnectApp;var history=useHistory();var _useState=useState(userConnected),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),error=_useState4[0],setError=_useState4[1];var handleConnect=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.next=3;return UsersAPI.login(dataConnection);case 3:response=_context.sent;if(response.id!=null){setError(null);setUser(response);}else{setError(\"erreurConnexion\");handleLogin(null);}case 5:case\"end\":return _context.stop();}}},_callee);}));return function handleConnect(_x){return _ref2.apply(this,arguments);};}();var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),textes=_useState6[0],setTextes=_useState6[1];useEffect(function(){var getTextes=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var textes;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:textes=ContentsAPI.getTexts(\"jeuLogin\").then(function(res){setTextes(res);});case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function getTextes(){return _ref3.apply(this,arguments);};}();if(textes==null){getTextes();}},[textes]);var getText=function getText(name){if(textes==null){return name;}else{try{return textes[name].contenu;}catch(error){return name;}}};useEffect(function(){if(user!=null){if(cookie.load('user')!==\"disconnected\"){if(cookie.load('user')!=null)cookie.remove('user');cookie.save('user',user,{path:'/',maxAge:60*60*1.5//sec\n});handleLogin(user);if(user.role.includes(\"TACT\")){history.push(\"/tact\");}else if(user.role.includes(\"INTER\")){history.push(\"/inter\");}else if(user.role.includes(\"ADMIN\")){history.push(\"/admin\");}}else{setUser(null);cookie.remove('user',{path:'/'});handleDisconnectApp();}}},[user]);var _useState7=useState({identifiant:\"\",mdp:\"\"}),_useState8=_slicedToArray(_useState7,2),dataConnection=_useState8[0],setDataConnection=_useState8[1];var onChange=function onChange(e){setError(null);var data={identifiant:dataConnection.identifiant,mdp:dataConnection.mdp};data[e.target.name]=e.target.value;setDataConnection(data);};return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"body-login\",children:[/*#__PURE__*/_jsx(Typography,{variant:\"h1\",color:\"primary\",children:\"Connexion\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"login-image-container\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"./assets/Login.png\"}),/*#__PURE__*/_jsx(Divider,{orientation:\"vertical\",flexItem:true}),/*#__PURE__*/_jsxs(\"form\",{method:\"post\",className:\"login-form\",children:[/*#__PURE__*/_jsx(TextField,{required:true,label:\"Identifiant\",variant:\"outlined\",name:\"identifiant\",value:dataConnection.identifiant,onChange:onChange,className:\"login-field\",color:\"primary\",inputProps:{style:{fontSize:25}},InputLabelProps:{style:{fontSize:20}}}),/*#__PURE__*/_jsx(TextField,{required:true,label:\"Mot de passe\",variant:\"outlined\",name:\"mdp\",value:dataConnection.mdp,onChange:onChange,type:\"password\",className:\"login-field\",color:\"primary\",inputProps:{style:{fontSize:25}},InputLabelProps:{style:{fontSize:20}},onKeyUp:function onKeyUp(event){if(!event.ctrlKey&&event.key=='Enter')handleConnect(event);}}),/*#__PURE__*/_jsx(Typography,{color:\"primary\",children:textes!=null&&error!==null?getText(error):\"\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"login-buttons-container\",children:[/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:function onClick(){return history.push(\"/\");},className:\"login-button retour\",color:\"default\",disabled:true,children:\"Retour\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:handleConnect,className:\"login-button connect\",color:\"primary\",children:\"Se connecter\"})]})]})]})]})});};export default Login;","map":{"version":3,"sources":["C:/Users/hugod/decitude/client/src/routes/Login.js"],"names":["useEffect","useState","TextField","Button","Divider","Typography","UsersAPI","ContentsAPI","useHistory","cookie","Login","handleLogin","userConnected","handleDisconnectApp","history","user","setUser","error","setError","handleConnect","e","preventDefault","login","dataConnection","response","id","textes","setTextes","getTextes","getTexts","then","res","getText","name","contenu","load","remove","save","path","maxAge","role","includes","push","identifiant","mdp","setDataConnection","onChange","data","target","value","style","fontSize","event","ctrlKey","key"],"mappings":"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","sourcesContent":["import '../styles/App.css';\r\nimport '../styles/Login.css'\r\nimport { useEffect, useState } from 'react';\r\nimport { TextField, Button, Divider, Typography } from \"@material-ui/core\"\r\nimport UsersAPI from \"../API/UsersAPI\"\r\nimport ContentsAPI from \"../API/ContentsAPI\"\r\nimport { useHistory } from 'react-router-dom';\r\n\r\n\r\nimport cookie from 'react-cookies'\r\n\r\nconst Login = ({\r\n  handleLogin,\r\n  userConnected,\r\n  handleDisconnectApp\r\n}) => {\r\n\r\n  const history = useHistory()\r\n\r\n  const [user, setUser] = useState(userConnected)\r\n  const [error,setError]=useState(null)\r\n\r\n  const handleConnect = async (e) => {\r\n    e.preventDefault()\r\n    const response = await UsersAPI.login(dataConnection)\r\n    if (response.id != null) {\r\n      setError(null)\r\n      \r\n      setUser(response)\r\n      \r\n    } else {\r\n      setError(\"erreurConnexion\")\r\n      handleLogin(null)\r\n    }\r\n  }\r\n  const [textes, setTextes] = useState(null)\r\n\r\n  useEffect(() => {\r\n      const getTextes = async () => {\r\n          const textes = ContentsAPI.getTexts(\"jeuLogin\").then(\r\n              (res) => { setTextes(res) }\r\n          )\r\n      }\r\n      if (textes == null) {\r\n\r\n          getTextes()\r\n          \r\n      }\r\n  }, [textes])\r\n\r\n\r\n  const getText = (name) => {\r\n    if (textes == null) {\r\n        return name\r\n    } else {\r\n        try {\r\n            return textes[name].contenu\r\n        } catch (error) {\r\n            return name\r\n        }\r\n    }\r\n}\r\n\r\n  useEffect(() => {\r\n    \r\n    if (user != null ) {\r\n      if(cookie.load('user')!==\"disconnected\"){\r\n        if(cookie.load('user')!=null ) cookie.remove('user')\r\n        cookie.save('user', user, { \r\n          path: '/',\r\n          maxAge: 60*60*1.5, //sec\r\n        })\r\n        handleLogin(user)\r\n        if (user.role.includes(\"TACT\")) {\r\n          history.push(\"/tact\");\r\n        } else if (user.role.includes(\"INTER\")) {\r\n          history.push(\"/inter\");\r\n        }else if (user.role.includes(\"ADMIN\")) {\r\n          history.push(\"/admin\");\r\n        }\r\n      }else{\r\n        setUser(null)\r\n        cookie.remove('user', { path: '/' })\r\n        handleDisconnectApp()\r\n      }\r\n      \r\n\r\n    }\r\n  }, [user])\r\n\r\n  const [dataConnection, setDataConnection] = useState({\r\n    identifiant: \"\",\r\n    mdp: \"\"\r\n  })\r\n\r\n\r\n\r\n  const onChange = (e) => {\r\n    setError(null)\r\n    var data = {\r\n      identifiant: dataConnection.identifiant,\r\n      mdp: dataConnection.mdp\r\n    }\r\n    data[e.target.name] = e.target.value\r\n    setDataConnection(data)\r\n  }\r\n\r\n\r\n\r\n\r\n  return (\r\n    <>\r\n      <div\r\n        className=\"body-login\"\r\n      >\r\n\r\n        <Typography variant=\"h1\" color=\"primary\">Connexion</Typography>\r\n        {/* <Typography variant=\"subtitle1\">Texte à ajouter</Typography> */}\r\n\r\n\r\n\r\n        <div\r\n          className=\"login-image-container\"\r\n        >\r\n          <img\r\n            src='./assets/Login.png'\r\n          />\r\n          <Divider orientation=\"vertical\" flexItem />\r\n          <form method=\"post\" className=\"login-form\" >\r\n            <TextField\r\n              required\r\n              label=\"Identifiant\"\r\n              variant=\"outlined\"\r\n              name={\"identifiant\"}\r\n              value={dataConnection.identifiant}\r\n              onChange={onChange}\r\n              className=\"login-field\"\r\n              color=\"primary\"\r\n              inputProps={{style: {fontSize: 25}}}\r\n              InputLabelProps={{style: {fontSize: 20}}}\r\n            />\r\n            <TextField\r\n              required\r\n              label=\"Mot de passe\"\r\n              variant=\"outlined\"\r\n              name=\"mdp\"\r\n              value={dataConnection.mdp}\r\n              onChange={onChange}\r\n              type=\"password\"\r\n              className=\"login-field\"\r\n              color=\"primary\"\r\n              inputProps={{style: {fontSize: 25}}}\r\n              InputLabelProps={{style: {fontSize: 20}}}\r\n              onKeyUp={(event) => {\r\n                if (!event.ctrlKey && event.key== 'Enter')\r\n                  handleConnect(event)\r\n                }}\r\n            />\r\n            <Typography  color=\"primary\">{textes!=null && error!==null ? getText(error) : \"\"}</Typography>\r\n            <div className=\"login-buttons-container\">\r\n              <Button\r\n                variant=\"contained\"\r\n                onClick={() => history.push(\"/\")}\r\n                className=\"login-button retour\"\r\n                color=\"default\"\r\n                disabled={true}\r\n                \r\n              >\r\n                Retour\r\n              </Button>\r\n              <Button\r\n                variant=\"contained\"\r\n                onClick={handleConnect}\r\n                className=\"login-button connect\"\r\n                color=\"primary\"\r\n\r\n              >\r\n                Se connecter\r\n              </Button>\r\n            </div>\r\n          </form>\r\n\r\n        </div>\r\n\r\n      </div>\r\n      </>\r\n  );\r\n}\r\n\r\nexport default Login;\r\n"]},"metadata":{},"sourceType":"module"}