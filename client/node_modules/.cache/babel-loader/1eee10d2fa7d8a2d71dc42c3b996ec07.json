{"ast":null,"code":"import _objectSpread from\"C:/Users/hugod/decitude/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"C:/Users/hugod/decitude/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"C:/Users/hugod/decitude/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/hugod/decitude/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/hugod/decitude/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import\"../styles/App.css\";import React,{useState,useEffect,useRef}from'react';import PlayAPI from\"../API/PlayAPI\";import TactBandeauTop from\"../components/interfaceJoueur/TactBandeauTop\";import TactBandeauBottom from\"../components/interfaceJoueur/TactBandeauBottom\";import Grille from\"../components/interfaceJoueur/Grille\";import{useHistory}from'react-router-dom';import{Typography}from\"@material-ui/core\";import cookie from'react-cookies';import TactBandeauDroite from\"../components/interfaceJoueur/TactBandeauDroite\";import ContentsAPI from\"../API/ContentsAPI\";import io from'socket.io-client';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var TactInterface=function TactInterface(){var history=useHistory();var user=cookie.load(\"user\");var handleDisconnect=function handleDisconnect(){cookie.save('user',\"disconnected\",{path:'/',maxAge:60*60*1.5//sec\n});history.push('/login');};if(user===null||user===undefined||user==\"disconnected\")history.push(\"/login\");if(user!==null&&user!==undefined&&user.role!==undefined&&!user.role.includes(\"TACT\"))handleDisconnect();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),play=_useState2[0],setPlay=_useState2[1];var _useState3=useState(user!==null&&user!==undefined&&user.role!==undefined?user.role.replace(\"TACT\",\"\"):null),_useState4=_slicedToArray(_useState3,2),numPompier=_useState4[0],setNumPompier=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),currentPomp=_useState6[0],setCurrentPomp=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),currentTour=_useState8[0],setCurrentTour=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),currentCycle=_useState10[0],setCurrentCycle=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),currentSequence=_useState12[0],setCurrentSequence=_useState12[1];var _useState13=useState(user!=null?user.session:null),_useState14=_slicedToArray(_useState13,2),session=_useState14[0],setSession=_useState14[1];var _useState15=useState(user!=null?user.equipe:null),_useState16=_slicedToArray(_useState15,2),equipe=_useState16[0],setEquipe=_useState16[1];var _useState17=useState(null),_useState18=_slicedToArray(_useState17,2),position=_useState18[0],setPosition=_useState18[1];var _useState19=useState({type:0,rotation:1}),_useState20=_slicedToArray(_useState19,2),deplacementEnCours=_useState20[0],setDeplacementEnCours=_useState20[1];var _useState21=useState([]),_useState22=_slicedToArray(_useState21,2),histActions=_useState22[0],setHistActions=_useState22[1];var _useState23=useState(null),_useState24=_slicedToArray(_useState23,2),chrono=_useState24[0],setChrono=_useState24[1];useEffect(function(){if(numPompier==null)handleDisconnect();},[numPompier]);var _useState25=useState(null),_useState26=_slicedToArray(_useState25,2),configuration=_useState26[0],setConfiguration=_useState26[1];var _useState27=useState(null),_useState28=_slicedToArray(_useState27,2),stocks=_useState28[0],setStocks=_useState28[1];var _useState29=useState({Decedes:0,Sauves:0}),_useState30=_slicedToArray(_useState29,2),resultats=_useState30[0],setResultats=_useState30[1];var _useState31=useState({Deplacement:0,Feu:0,FeuFum:0,Fum:0,Marqueur:0,Porte:0,Habitant:0}),_useState32=_slicedToArray(_useState31,2),interventions=_useState32[0],setInterventions=_useState32[1];var _useState33=useState(0),_useState34=_slicedToArray(_useState33,2),budget=_useState34[0],setBudget=_useState34[1];var _useState35=useState(0),_useState36=_slicedToArray(_useState35,2),budgetDepense=_useState36[0],setBudgetDepense=_useState36[1];var isLoading=useRef(false);// INITIALISATION DE LA CARTE\n// const [carte, setCarte] = useState([\n//   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n//   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n//   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n//   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n//   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n//   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n//   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n//   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\n// ])\nvar _useState37=useState([]),_useState38=_slicedToArray(_useState37,2),carte=_useState38[0],setCarte=_useState38[1];var _useState39=useState(0),_useState40=_slicedToArray(_useState39,2),nbLignesGrille=_useState40[0],setNbLignesGrille=_useState40[1];var _useState41=useState(0),_useState42=_slicedToArray(_useState41,2),nbColonnesGrille=_useState42[0],setNbColonnesGrille=_useState42[1];var _useState43=useState([[1,1,1,1,1,1,2,6,1,1,1,1,2,5,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,2,6,1,6,2,1,1,1,5,2,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,6,2,1,1,1,1,1,1,1,1]]),_useState44=_slicedToArray(_useState43,2),mursH=_useState44[0],setMursH=_useState44[1];var _useState45=useState([[1,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,1],[2,0,0,5,0,0,0,0,0,0,0,1,0,0,0,0,1],[5,0,0,2,0,0,0,0,0,0,0,1,0,0,0,0,1],[1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1],[1,0,0,0,0,0,1,0,0,0,2,0,0,0,0,0,1],[1,0,0,0,0,0,2,0,0,0,5,0,0,0,0,0,1],[1,0,0,0,0,0,5,0,0,0,5,0,0,0,0,0,2],[1,0,0,0,0,0,1,0,0,0,2,0,0,0,0,0,5]]),_useState46=_slicedToArray(_useState45,2),mursV=_useState46[0],setMursV=_useState46[1];// GET PLAY PARAMETERS \nvar getPlayState=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(session,equipe){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:// console.log(\"get play state\")\nsetTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var currentPlayState,c;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(isLoading.current){_context.next=8;break;}isLoading.current=true;_context.next=4;return PlayAPI.getPlayState(session,equipe);case 4:currentPlayState=_context.sent;// console.log(currentPlayState)\nif(Object.keys(currentPlayState).length>0){// console.log(parseInt(JSON.parse(currentPlayState.currentTour.valeur)))\nsetCurrentPomp(parseInt(JSON.parse(currentPlayState.currentPomp.valeur)));setCurrentTour(parseInt(JSON.parse(currentPlayState.currentTour.valeur)));setCurrentCycle(parseInt(JSON.parse(currentPlayState.currentCycle.valeur)));setCurrentSequence(parseInt(JSON.parse(currentPlayState.currentSequence.valeur)));setMursH(JSON.parse(currentPlayState.mursH.valeur));setMursV(JSON.parse(currentPlayState.mursV.valeur));setCarte(JSON.parse(currentPlayState.carte.valeur));setResultats({Decedes:parseInt(JSON.parse(currentPlayState.resultatsDecedes.valeur)),Sauves:parseInt(JSON.parse(currentPlayState.resultatsSauves.valeur))});setPlay(JSON.parse(currentPlayState.play.valeur));// if(parseInt(JSON.parse(currentPlayState.currentPomp.valeur))==1 && parseInt(JSON.parse(currentPlayState.currentTour.valeur))==1){\ngetBudget(parseInt(JSON.parse(currentPlayState.currentCycle.valeur)),parseInt(JSON.parse(currentPlayState.currentSequence.valeur)));//  }\nc=parseInt(JSON.parse(currentPlayState.currrentChrono.valeur));if(configuration!==null&&c<=configuration.chronoTourTact.valeur&&parseInt(JSON.parse(currentPlayState.currentPomp.valeur))==numPompier){if(c==0){setChrono(configuration.chronoTourTact.valeur);}else{setChrono(c);}console.log(c);}else{setChrono(null);console.log(c,configuration.chronoTourTact.valeur);}}getPositionFromCarte(JSON.parse(currentPlayState.carte.valeur));isLoading.current=false;case 8:case\"end\":return _context.stop();}}},_callee);})),numPompier*100);case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function getPlayState(_x,_x2){return _ref.apply(this,arguments);};}();useEffect(function(){// console.log(carte)\nif(carte.length>0){setNbLignesGrille(carte.length);setNbColonnesGrille(carte[0].length);getPositionFromCarte(carte);}},[carte]);// useEffect(()=>{\n//   console.log(currentTour)\n// },[currentTour])\nuseEffect(function(){if(session!=null&&equipe!=null&&currentTour==null){if(!isLoading.current&&configuration!==null)getPlayState(session,equipe);getPlayParameters();getPositionFromCarte(carte);}},[session,equipe,numPompier,configuration]);var getPlayParameters=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:setTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var param;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return PlayAPI.getConfiguration(session);case 2:param=_context3.sent;setConfiguration(param);case 4:case\"end\":return _context3.stop();}}},_callee3);})),numPompier*100);case 1:case\"end\":return _context4.stop();}}},_callee4);}));return function getPlayParameters(){return _ref3.apply(this,arguments);};}();var getPositionFromCarte=function getPositionFromCarte(carte){if(carte!=null&&carte.length>0){carte.forEach(function(ligne,indexI){ligne.forEach(function(valeur,indexJ){if(Math.floor(valeur/1000)==1&&Math.floor(valeur%1000/100)==numPompier){setPosition([indexI,indexJ]);setDeplacementEnCours({type:0,rotation:valeur%10});}});});}};// const onTextChange = (e) => {\n//   setNumPompier(e.target.value)\n//   console.log(typeof (e.target.value))\n// }\n// const onXChange = (e) => {\n//   e.preventDefault()\n//   if (e.target.value.length > 0) {\n//     updateCarte(position, 0)\n//     setPosition(position => [position[0], parseInt(e.target.value)])\n//   } else {\n//     updateCarte(position, 0)\n//     setPosition(position => [position[0], 0])\n//   }\n// }\n// const onYChange = (e) => {\n//   e.preventDefault()\n//   if (e.target.value.length > 0) {\n//     updateCarte(position, 0)\n//     setPosition(position => [parseInt(e.target.value), position[1]])\n//   } else {\n//     updateCarte(position, 0)\n//     setPosition(position => [0, position[1]])\n//   }\n// }\n// UPDATES\nvar updateCarte=function updateCarte(coords,value){if(coords[0]<nbLignesGrille&&coords[1]<nbColonnesGrille){try{var c=_toConsumableArray(carte);c[coords[0]][coords[1]]=value;setCarte(c);}catch(error){// console.log(error)\n}}};var updateMurH=function updateMurH(coords,value){if(coords[0]<mursH.length&&coords[1]<mursH[0].length){try{var m=_toConsumableArray(mursH);m[coords[0]][coords[1]]=value;setMursH(m);}catch(error){// console.log(error)\n}}};var updateMurV=function updateMurV(coords,value){if(coords[0]<mursV.length&&coords[1]<mursV[0].length){try{var m=_toConsumableArray(mursV);m[coords[0]][coords[1]]=value;setMursV(m);}catch(error){// console.log(error)\n}}};// ACTIONS\nvar updateBudget=function updateBudget(action){var depenses=0;if(configuration[\"coutEq\"+action]!=null)depenses+=configuration[\"coutEq\"+action].valeur;if(configuration[\"coutInter\"+action]!=null)depenses+=configuration[\"coutInter\"+action].valeur;setBudget(function(budget){return budget-depenses;});setBudgetDepense(function(bd){return bd+depenses;});};var addHistAction=function addHistAction(budget,budgetDepense){var h=[].concat(_toConsumableArray(histActions),[{carte:JSON.stringify(carte),budget:JSON.stringify(budget),budgetDepense:JSON.stringify(budgetDepense),mursH:JSON.stringify(mursH),mursV:JSON.stringify(mursV),stocks:JSON.stringify(stocks),resultats:JSON.stringify(resultats),interventions:JSON.stringify(interventions),deplacementEnCours:JSON.stringify({type:0,rotation:deplacementEnCours.rotation})}]);setHistActions(h);};var retourAction=function retourAction(){isLoading.current=true;var h=_toConsumableArray(histActions);h.pop();var state=h[h.length-1];setCarte(JSON.parse(state.carte));setMursH(JSON.parse(state.mursH));setMursV(JSON.parse(state.mursV));setStocks(JSON.parse(state.stocks));setInterventions(JSON.parse(state.interventions));setResultats(JSON.parse(state.resultats));setBudget(JSON.parse(state.budget));setBudgetDepense(JSON.parse(state.budgetDepense));setDeplacementEnCours(JSON.parse(state.deplacementEnCours));setHistActions(h);isLoading.current=false;};useEffect(function(){if(position!==null&&stocks!==null&&budget>0&&deplacementEnCours.type==0&&(histActions[histActions.length-1]==undefined||budget<histActions[histActions.length-1].budget)){addHistAction(budget,budgetDepense);}},[deplacementEnCours,budgetDepense,stocks]);// useEffect(() => {\n//   console.log(\"hist Actions\")\n//   console.log(histActions)\n// }, [histActions])\n// useEffect(()=>{\n//   if( position!==null && budget>0){\n//     if(histActions[histActions.length-1]!==undefined && budget<histActions[histActions.length-1].budget ){\n//       addHistAction(budget)\n//     }\n//   }\n// },[budget])\nvar doAction=function doAction(action){try{if(Object.keys(stocks).includes(action)){var s=stocks;s[action]=s[action]-1;setStocks(s);}}catch(error){}try{if(Object.keys(interventions).includes(action)){var i=interventions;i[action]=i[action]-1;setInterventions(i);}}catch(error){}// setTimeout(() => {\nupdateBudget(action);// }, 1000);\n};var updateResultats=function updateResultats(sauve){var res=_objectSpread({},resultats);if(sauve){res.Sauves+=1;}else{res.Decedes+=1;}// console.log(res)\nsetResultats(res);};useEffect(function(){setBtnClickedBottom(null);revealHabitant();},[position]);useEffect(function(){if(carte.length>0)relacherHabitant();},[position,mursH,mursV]);// useEffect(() => {\n//   console.log(\"Stocks\")\n//   console.log(stocks)\n// }, [stocks])\nuseEffect(function(){if(configuration!=null){var inter=_objectSpread({},interventions);var interKeys=Object.keys(inter);// console.log(Math.floor(budget / configuration[\"coutInter\" + \"Habitant\"].valeur))\ninterKeys.forEach(function(action){try{if(configuration[\"coutInter\"+action].valeur>0){// if(action==\"Habitant\"){\n//   console.log(stocks !== null && stocks[action] != null && stocks[action] != undefined && stocks[action] != \"NaN\" ? stocks[action] : 1000)\n// }\ninter[action]=Math.min(configuration[\"coutEq\"+action]!=null&&configuration[\"coutEq\"+action]!=undefined?Math.floor(budget/(configuration[\"coutInter\"+action].valeur+configuration[\"coutEq\"+action].valeur)):Math.floor(budget/configuration[\"coutInter\"+action].valeur),stocks!==null&&stocks[action]!=null&&stocks[action]!=undefined&&stocks[action]!=\"NaN\"?stocks[action]:1000);}}catch(error){// console.log(error, action)\n}});console.log(inter);setInterventions(inter);}else{// getPlayParameters()\n}},[budget,configuration,numPompier,stocks]);// SOCKETS\n// SOCKETS \nvar onTourChange=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(e){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:e.preventDefault();// console.log(\"nouveau tour todo\")\ncase 1:case\"end\":return _context5.stop();}}},_callee5);}));return function onTourChange(_x3){return _ref5.apply(this,arguments);};}();var modifyBudgetsFin=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(cycle,sequence,prochainPomp,prochainTour,prochainCycle,prochaineSequence,prochainChrono){return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:// console.log(\"budgets modified 0\")\nsetTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:PlayAPI.getBudgetsPompFin(session,equipe).then(function(res){console.log(res);var budgetsFin=JSON.parse(res.valeur);try{budgetsFin.interventions.forEach(function(b,index){if(b.numCycle==cycle&&b.numSeq==sequence){budgetsFin[\"interventions\"][index][\"pomp\"+numPompier]=budget;}});}catch(error){}try{budgetsFin.equipements.forEach(function(e,index){if(e.numCycle==cycle&&e.numSeq==sequence){budgetsFin[\"equipements\"][index][\"Feu\"][\"pomp\"+numPompier]=stocks.Feu;budgetsFin[\"equipements\"][index][\"FeuFum\"][\"pomp\"+numPompier]=stocks.FeuFum;budgetsFin[\"equipements\"][index][\"Fum\"][\"pomp\"+numPompier]=stocks.Fum;budgetsFin[\"equipements\"][index][\"Marqueur\"][\"pomp\"+numPompier]=stocks.Marqueur;}});}catch(error){}// console.log(\"budgets modified 1\")\nPlayAPI.saveBudgetsPompFin(budgetsFin,session,equipe).then(function(){var newCarte=evenementsAleatoire();PlayAPI.nouveauTour(socket,prochainPomp,newCarte,mursH,mursV,prochaineSequence,prochainCycle,prochainTour,resultats.Decedes,resultats.Sauves,session,equipe,prochainChrono);// return budgetsFin\n});});case 1:case\"end\":return _context6.stop();}}},_callee6);})),numPompier*100);case 1:case\"end\":return _context7.stop();}}},_callee7);}));return function modifyBudgetsFin(_x4,_x5,_x6,_x7,_x8,_x9,_x10){return _ref6.apply(this,arguments);};}();var getBudget=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(cycle,sequence){return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:setTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(){var nouveauBudget,budgetInter,stocksEq;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return PlayAPI.getBudgetsPompFin(session,equipe);case 2:nouveauBudget=_context8.sent;nouveauBudget=nouveauBudget.valeur;// console.log(nouveauBudget)\nnouveauBudget=JSON.parse(nouveauBudget);budgetInter=0;stocksEq=stocks!==null&&stocks!==undefined?_objectSpread({},stocks):{Feu:0,FeuFum:0,Fum:0,Marqueur:0};try{nouveauBudget.interventions.forEach(function(b){if(b.numCycle==cycle&&b.numSeq==sequence){budgetInter=b[\"pomp\"+numPompier];}});}catch(error){}try{nouveauBudget.equipements.forEach(function(e){if(e.numCycle==cycle&&e.numSeq==sequence){stocksEq.Feu+=e.Feu[\"pomp\"+numPompier];stocksEq.FeuFum+=e.FeuFum[\"pomp\"+numPompier];stocksEq.Fum+=e.Fum[\"pomp\"+numPompier];stocksEq.Marqueur+=e.Marqueur[\"pomp\"+numPompier];}});}catch(error){}// console.log(nouveauBudget)\nif(budgetInter!==budget){setBudget(budgetInter);setBudgetDepense(0);}setStocks(stocksEq);case 11:case\"end\":return _context8.stop();}}},_callee8);})),numPompier*100);case 1:case\"end\":return _context9.stop();}}},_callee9);}));return function getBudget(_x11,_x12){return _ref8.apply(this,arguments);};}();var _useState47=useState(null),_useState48=_slicedToArray(_useState47,2),socket=_useState48[0],setSocket=_useState48[1];// console.log(socket)\nuseEffect(function(){if(socket===null&&configuration!==null){var s=io.connect(\"https://www.back.leaders-extreme.fr\",{transports:['websocket']});s.on('changementTour',function(data){if(currentPomp!=data.currentPomp||currentCycle!==data.currentCycle||currentTour!==data.currentTour||currentSequence!==data.currentSequence){// console.log(\"changement tour\")\nsetTimeout(function(){getPlayState(session,equipe);},numPompier*100);}});s.on(\"connect_error\",function(err){console.log(\"connect_error due to \".concat(err.message));});// s.on('revealHabitant', (data) => {\n//   if (carte !== null && carte.length > 0) {\n//     // console.log(carte[data.y][data.x])\n//     console.log(carte[data.y])\n//     if (carte[data.y][data.x] == 20) {\n//       // console.log([data.y,data.x])\n//       updateCarte([data.y, data.x], data.type)\n//       // console.log(\"socket hab\")\n//       // console.log(data)\n//     }\n//   }\n// })\ns.on('startStopPartie',function(data){setTimeout(function(){getPlayState(session,equipe);},numPompier*100);});setSocket(s);}},[socket,configuration]);// TESTS\nvar test=/*#__PURE__*/function(){var _ref10=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(){return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:console.log(\"test function\");case 1:case\"end\":return _context10.stop();}}},_callee10);}));return function test(){return _ref10.apply(this,arguments);};}();// useEffect(()=>{\n//   console.log(interventions,budget)\n// },[interventions,budget])\n// AUTORISATIONS \nvar deplacementAutorise=function deplacementAutorise(deplacement){// return true\nvar dpl=_toConsumableArray(deplacement);if(dpl[0]==0&&dpl[1]==0)return false;if(position[0]+dpl[0]>carte.length-1||position[1]+dpl[1]>carte[0].length-1||position[0]+dpl[0]<0||position[1]+dpl[1]<0)return false;var dplInterditsCases=[1000,20,3,4];try{var valeurCaseDeplacement=carte[position[0]+dpl[0]][position[1]+dpl[1]];if(Math.floor(valeurCaseDeplacement/1000)==1)return false;if(Math.floor(valeurCaseDeplacement/10)==2)return false;if(dplInterditsCases.includes(valeurCaseDeplacement))return false;}catch(error){}var dplInterditsMurs=[1,2,3,5];try{if(dpl[0]!=0){// haut bas\nif(dpl[0]<0){dpl[0]=0;}if(typeof mursH[position[0]+dpl[0]][position[1]]==='undefined')return false;if(dplInterditsMurs.includes(mursH[position[0]+dpl[0]][position[1]]))return false;}else{// gauche droite\nif(dpl[1]<0){dpl[1]=0;}if(typeof mursV[position[0]][position[1]+dpl[1]]==='undefined')return false;if(dplInterditsMurs.includes(mursV[position[0]][position[1]+dpl[1]]))return false;}}catch(error){}return true;};var testRelacherHabitant=function testRelacherHabitant(){if(carte[position[0]][position[1]]%100<10)return false;// pas de transport d'habitant\nvar mursBloquants=[1,2,3,5];if(position[0]==0&&!mursBloquants.includes(mursH[position[0]][position[1]]))return true;// haut\nif(position[0]==nbLignesGrille-1&&!mursBloquants.includes(mursH[position[0]+1][position[1]]))return true;// bas\nif(position[1]==0&&!mursBloquants.includes(mursV[position[0]][position[1]]))return true;// gauche\nif(position[1]==nbColonnesGrille-1&&!mursBloquants.includes(mursV[position[0]][position[1]+1]))return true;// droite\nreturn false;};var relacherHabitant=function relacherHabitant(){if(testRelacherHabitant()){setTimeout(function(){updateResultats(true);updateCarte(position,carte[position[0]][position[1]]-(carte[position[0]][position[1]]%100-carte[position[0]][position[1]]%10));},1000);}};var revealHabitant=/*#__PURE__*/function(){var _ref11=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11(){var casesAutour;return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:if(configuration!=null){casesAutour=getCasesAutour();try{if(casesAutour.dessus==20){updateCarte([position[0]-1,position[1]],0);resetHistAction();// const response = await PlayAPI.revealHabitant(socket, [position[0] - 1, position[1]], 0)\n}}catch(error){}try{if(casesAutour.droite==20){updateCarte([position[0],position[1]+1],0);resetHistAction();// const response = await PlayAPI.revealHabitant(socket, [position[0], position[1] + 1], 0)\n}}catch(error){}try{if(casesAutour.dessous==20){updateCarte([position[0]+1,position[1]],0);resetHistAction();// const response = await PlayAPI.revealHabitant(socket, [position[0] + 1, position[1]], 0)\n}}catch(error){}try{if(casesAutour.gauche==20){updateCarte([position[0],position[1]-1],0);resetHistAction();// const response = await PlayAPI.revealHabitant(socket, [position[0], position[1] - 1], 0)\n}}catch(error){}}case 1:case\"end\":return _context11.stop();}}},_callee11);}));return function revealHabitant(){return _ref11.apply(this,arguments);};}();var getCasesAutour=function getCasesAutour(){var cases={};try{cases[\"dessus\"]=carte[position[0]-1][position[1]];// dessus\n}catch(error){}try{cases[\"droite\"]=carte[position[0]][position[1]+1];// droite\n}catch(error){}try{cases[\"dessous\"]=carte[position[0]+1][position[1]];// dessous\n}catch(error){}try{cases[\"gauche\"]=carte[position[0]][position[1]-1];// gauche\n}catch(error){}return cases;};var getMursAutour=function getMursAutour(position){var murs=[];try{if(mursH[position[0]][position[1]]!=4||mursH[position[0]][position[1]-1]<6&&mursH[position[0]][position[1]+1]<6){murs.push(mursH[position[0]][position[1]]);// dessus\n}else{murs.push(0);}}catch(error){}try{if(mursV[position[0]][position[1]+1]!=4||mursV[position[0]-1][position[1]+1]<6&&mursV[position[0]+1][position[1]+1]<6){murs.push(mursV[position[0]][position[1]+1]);// droite\n}else{murs.push(0);}}catch(error){}try{if(mursH[position[0]+1][position[1]]!=4||mursH[position[0]+1][position[1]-1]<6&&mursH[position[0]+1][position[1]+1]<6){murs.push(mursH[position[0]+1][position[1]]);// dessous\n}else{murs.push(0);}}catch(error){}try{if(mursV[position[0]][position[1]]!=4||mursV[position[0]-1][position[1]]<6&&mursV[position[0]+1][position[1]]<6){murs.push(mursV[position[0]][position[1]]);// gauche\n}else{murs.push(0);}}catch(error){}// console.log(murs)\nreturn murs;};var resetHistAction=function resetHistAction(){setTimeout(function(){setHistActions([{carte:JSON.stringify(carte),budget:JSON.stringify(budget),budgetDepense:JSON.stringify(budgetDepense),mursH:JSON.stringify(mursH),mursV:JSON.stringify(mursV),stocks:JSON.stringify(stocks),resultats:JSON.stringify(resultats),interventions:JSON.stringify(interventions)}]);},300);};var _useState49=useState(null),_useState50=_slicedToArray(_useState49,2),btnClickedBottom=_useState50[0],setBtnClickedBottom=_useState50[1];var _useState51=useState([]),_useState52=_slicedToArray(_useState51,2),propositionsCase=_useState52[0],setPropositionsCase=_useState52[1];// Extincteurs\nvar _useState53=useState([[],[]]),_useState54=_slicedToArray(_useState53,2),propositionMursDetruire=_useState54[0],setPropositionMursDetruire=_useState54[1];// Horizontaux  , Verticaux\nuseEffect(function(){if(btnClickedBottom!=3||btnClickedBottom==null){setPropositionMursDetruire([[],[]]);}if(btnClickedBottom>2&&btnClickedBottom<6||btnClickedBottom==null){setPropositionsCase([]);}},[btnClickedBottom]);// HANDLERS CLIC GRILLE\nvar handleClicCase=function handleClicCase(valeurAvant,valeurApres,coordX,coordY){try{updateCarte([coordY,coordX],valeurApres);setPropositionsCase([]);setBtnClickedBottom(null);if(valeurAvant==4&&valeurApres==0){// Extincteur flamme\ndoAction(\"Feu\");}if(valeurAvant==4&&valeurApres==3){// Feu Fumée\ndoAction(\"FeuFum\");}if(valeurAvant==3&&valeurApres==0){// Fumée\ndoAction(\"Fum\");}if(Math.floor(valeurAvant/10)==2&&valeurApres==0){// Habitant\ndoAction(\"Habitant\");// console.log(carte[position[0]][position[1]] + (valeurAvant % 10)*10)\nupdateCarte(position,carte[position[0]][position[1]]+valeurAvant%10*10);}}catch(error){}};var handleClicMur=function handleClicMur(num,valeurAvant,coordX,coordY){// marqueur dégat\nif(propositionMursDetruire[0].length>0||propositionMursDetruire[1].length>0){var checkInCoords=function checkInCoords(index){// console.log(\"coordx\",coordX,\"coordy\",coordY,\"position\",position)\nvar numClic=null;if(coordX==position[1]&&(coordY<position[0]||coordY==position[0]&&num==0)){// top\nnumClic=0;// case en question\n// console.log(\"top\",numClic)\n}if(coordX==position[1]&&(coordY>position[0]||coordY==position[0]&&num==2)){// bottom\nnumClic=2;// case en question\n// console.log(\"bottom\",numClic)\n}if(coordY==position[0]&&(coordX<position[1]||coordX==position[1]&&num==3)){// left\nnumClic=3;// case en question\n// console.log(\"left\",numClic)\n}if(coordY==position[0]&&(coordX>position[1]||coordX==position[1]&&num==1)){// right\nnumClic=1;// case en question\n// console.log(\"right\",numClic)\n}return numClic;};var cote=checkInCoords(num%2);var valeurApres=4;if(valeurAvant==1)valeurApres=3;if(cote!=null){try{switch(cote){case 0:updateMurH([position[0],position[1]],valeurApres);// if(valeurAvant==5 ||)\nbreak;case 1:updateMurV([position[0],position[1]+1],valeurApres);break;case 2:updateMurH([position[0]+1,position[1]],valeurApres);break;case 3:updateMurV([position[0],position[1]],valeurApres);break;}doAction(\"Marqueur\");}catch(error){}setPropositionMursDetruire([[],[]]);setBtnClickedBottom(null);}}};// HANDLER CLICS BOUTONS\nvar handleClicFleche=function handleClicFleche(num){// Position y x\nvar deplacement;var rotation;switch(num){case 0:// haut\n// console.log(\"haut\")\ndeplacement=[-1,0];rotation=1;break;case 1:// droite\n// console.log(\"droite\")\ndeplacement=[0,1];rotation=2;break;case 2:// bas\n// console.log(\"bas\")\ndeplacement=[1,0];rotation=3;break;case 3:// gauche\n// console.log(\"gauche\")\ndeplacement=[0,-1];rotation=4;break;}if(deplacementAutorise(deplacement)){// ANIMATION MARCHE\nsetDeplacementEnCours({type:1,rotation:rotation});setTimeout(function(){updateCarte([position[0]+deplacement[0],position[1]+deplacement[1]],carte[position[0]][position[1]]-carte[position[0]][position[1]]%10+rotation);// setPosition(position => [position[0] + deplacement[0], position[1] + deplacement[1]])\nif((carte[position[0]][position[1]]%100-carte[position[0]][position[1]]%10)/10>0){doAction(\"DeplacementHab\");}else{doAction(\"Deplacement\");}updateCarte(position,0);setDeplacementEnCours({type:2,rotation:rotation});setTimeout(function(){setDeplacementEnCours({type:0,rotation:rotation});},500);},500);}};var handleChangePiece=function handleChangePiece(){resetHistAction();};var handleClicDoor=function handleClicDoor(ouvrir){// position, ouvert/fermé\nsetBtnClickedBottom(ouvrir?4:5);var valueAvant;var valueApres;if(ouvrir){valueAvant=5;valueApres=6;}else{valueAvant=6;valueApres=5;}doAction(\"Porte\");try{if(mursH[position[0]][position[1]]==valueAvant)updateMurH([position[0],position[1]],valueApres);if(mursH[position[0]+1][position[1]]==valueAvant)updateMurH([position[0]+1,position[1]],valueApres);if(mursV[position[0]][position[1]]==valueAvant)updateMurV([position[0],position[1]],valueApres);if(mursV[position[0]][position[1]+1]==valueAvant)updateMurV([position[0],position[1]+1],valueApres);}catch(error){}};var handleClicExtincteur=function handleClicExtincteur(num){// 0 FEU, 1 FEUFUM, 2 FUM\nif(btnClickedBottom!=num){var listeCasesAction=[];var valeurAvant=4;var valeurApres=0;setBtnClickedBottom(num);switch(num){case 0:// ETEINDRE FEU\nbreak;case 1:// FEU FUM\nvaleurApres=3;break;case 2:// ETEINDRE FUMEE\nvaleurAvant=3;break;}try{if(carte[position[0]-1][position[1]]==valeurAvant)listeCasesAction.push([position[0]-1,position[1],valeurAvant,valeurApres]);// TOP\n}catch(error){}try{if(carte[position[0]][position[1]+1]==valeurAvant)listeCasesAction.push([position[0],position[1]+1,valeurAvant,valeurApres]);// RIGHT\n}catch(error){}try{if(carte[position[0]+1][position[1]]==valeurAvant)listeCasesAction.push([position[0]+1,position[1],valeurAvant,valeurApres]);// BOTTOM\n}catch(error){}try{if(carte[position[0]][position[1]-1]==valeurAvant)listeCasesAction.push([position[0],position[1]-1,valeurAvant,valeurApres]);// LEFT\n}catch(error){}setPropositionsCase(listeCasesAction);}else{setBtnClickedBottom(null);}};var handleClicMarqueur=function handleClicMarqueur(){if(btnClickedBottom!=3){setBtnClickedBottom(3);if(propositionMursDetruire[0].length>0||propositionMursDetruire[1].length>0){setPropositionMursDetruire([[],[]]);}else{var mursADetruire=[1,3,5,6];var propositions=[[],[]];var mursAutour=getMursAutour(position);try{if(mursADetruire.includes(mursAutour[0]))propositions[0].push([position[1],position[0]]);// top\nif(mursADetruire.includes(mursAutour[1]))propositions[1].push([position[1]+1,position[0]]);// right\nif(mursADetruire.includes(mursAutour[2]))propositions[0].push([position[1],position[0]+1]);// bottom\nif(mursADetruire.includes(mursAutour[3]))propositions[1].push([position[1],position[0]]);// left\n}catch(error){}setPropositionMursDetruire(propositions);}}else{setBtnClickedBottom(null);}};var handleClicValidated=/*#__PURE__*/function(){var _ref12=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee12(bool){var prochainPomp,prochainTour,prochainCycle,prochaineSequence,prochainChrono,res;return _regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:// console.log(\"handle Clic\")\nif(configuration!=null){if(bool){prochainPomp=currentPomp+1;prochainTour=currentTour;prochainCycle=currentCycle;prochaineSequence=currentSequence;prochainChrono=configuration.chronoTourTact.valeur;if(numPompier==configuration.nbPompEquipe.valeur){// DERNIER POMP DU TOUR\nif(currentTour==configuration.nbToursParCycle.valeur){// SEND TO INTER\nprochainTour=1;prochainPomp=0;// A CHANGER AVEC STRATEGIQUE\nprochainChrono=configuration.chronoTourInter.valeur;if(prochainCycle==configuration.nbCyclesParSequence.valeur){prochainCycle=1;prochaineSequence=prochaineSequence+1;}else{prochainCycle=prochainCycle+1;}}else{// PAS DERNIER TOUR DU CYCLE\n// console.log(\"pas dernier tour\")\nprochainPomp=1;prochainTour=prochainTour+1;// prochainChrono = configuration.chronoTourTact.valeur\n}}// console.log(prochainPomp,prochainTour,prochainCycle)\n// console.log(\"budgets fin 1\")\nres=modifyBudgetsFin(currentCycle,currentSequence,prochainPomp,prochainTour,prochainCycle,prochaineSequence,prochainChrono);resetHistAction();// setChrono(null)\n}else{retourAction();console.log(\"retour\");}}case 1:case\"end\":return _context12.stop();}}},_callee12);}));return function handleClicValidated(_x13){return _ref12.apply(this,arguments);};}();var handleNoClicked=function handleNoClicked(){setPropositionMursDetruire([[],[]]);setPropositionsCase([]);};var handleClicHabitant=function handleClicHabitant(){if(btnClickedBottom!=6){setBtnClickedBottom(6);var valeurApres=0;var listeCasesAction=[];try{var valeurDessus=carte[position[0]-1][position[1]];if(Math.floor(valeurDessus/10)==2)listeCasesAction.push([position[0]-1,position[1],valeurDessus,valeurApres]);// TOP\n}catch(error){}try{var valeurDroite=carte[position[0]][position[1]+1];if(Math.floor(valeurDroite/10)==2)listeCasesAction.push([position[0],position[1]+1,valeurDroite,valeurApres]);// RIGHT\n}catch(error){}try{var valeurDessous=carte[position[0]+1][position[1]];if(Math.floor(valeurDessous/10)==2)listeCasesAction.push([position[0]+1,position[1],valeurDessous,valeurApres]);// BOTTOM\n}catch(error){}try{var valeurGauche=carte[position[0]][position[1]-1];if(Math.floor(valeurGauche/10)==2)listeCasesAction.push([position[0],position[1]-1,valeurGauche,valeurApres]);// LEFT\n}catch(error){}setPropositionsCase(listeCasesAction);// console.log(\"handle clic habitant\")\n}else{setBtnClickedBottom(null);}};var getRandomCoords=function getRandomCoords(mini,maxi){if(carte!==null&&carte!==undefined&&carte.length>0){var y=Math.floor(Math.random()*(maxi[0]-mini[0]))+mini[0];var x=Math.floor(Math.random()*(maxi[1]-mini[1]))+mini[1];var type=carte[y][x];while(Math.floor(type/1000)==1||Math.floor(type/10)==2){y=Math.floor(Math.random()*(maxi[0]-mini[0]))+mini[0];x=Math.floor(Math.random()*(maxi[1]-mini[1]))+mini[1];type=carte[y][x];}// console.log(\"getRandomCoords\", y, x)\nreturn[y,x];}return null;};var handleMortHab=function handleMortHab(){var r=_objectSpread({},resultats);r.Decedes=r.Decedes+1;setResultats(r);// console.log(\"mort d'un habitant\")\n};var handleExplosion=function handleExplosion(randomPos,c){var mursAutour=getMursAutour(randomPos);// console.log(mursAutour)\n// MARQUEURS SUR LA CASE QUI EXPLOSE\nmursAutour.forEach(function(val,index){var valeurFin=val;if([3,5].includes(val))valeurFin=4;// DESTRUCTION TOTALE\nif(valeurFin==1)valeurFin=3;if(valeurFin==3||valeurFin==4){switch(index){case 0:try{updateMurH([randomPos[0],randomPos[1]],valeurFin);}catch(_unused){}break;case 1:try{updateMurV([randomPos[0],randomPos[1]+1],valeurFin);}catch(_unused2){}break;case 2:try{updateMurH([randomPos[0]+1,randomPos[1]],valeurFin);}catch(_unused3){}break;case 3:try{updateMurV([randomPos[0],randomPos[1]],valeurFin);}catch(_unused4){}break;}}});// PROPAGATION DANS LES DIFFERENTES DIRECTIONS\nvar mursInterdits=[1,2,3,5];if(randomPos[1]<nbColonnesGrille-1&&c[randomPos[0]][randomPos[1]+1]==4){// Propagation droite\n// console.log(\"propa droite\")\nvar j=1;while(randomPos[1]+1+j<nbColonnesGrille){var type=c[randomPos[0]][randomPos[1]+1+j];if(Math.floor(type/10)==2){c[randomPos[0]][randomPos[1]+1+j]=4;handleMortHab();}if(Math.floor(type/1000)==1){if(type%100<10){c[randomPos[0]][randomPos[1]+1+j]=type-(type%100-type%10);handleMortHab();}else{// console.log(\"mort d'un pompier solo\")\n}}if(c[randomPos[0]][randomPos[1]+1+j]==3||c[randomPos[0]][randomPos[1]+1+j]==0){c[randomPos[0]][randomPos[1]+1+j]=4;break;}var mur=getMursAutour([randomPos[0],randomPos[1]+1+j])[1];if(mursInterdits.includes(mur)){try{updateMurV([randomPos[0],randomPos[1]+2+j],4);break;}catch(_unused5){}}j+=1;}}if(randomPos[1]>0&&c[randomPos[0]][randomPos[1]-1]==4){// Propagation gauche\n// console.log(\"propa gauche\")\nvar _j=1;while(randomPos[1]-1-_j>=0){var _type=c[randomPos[0]][randomPos[1]-1-_j];if(Math.floor(_type/10)==2){c[randomPos[0]][randomPos[1]-1-_j]=4;handleMortHab();}if(Math.floor(_type/1000)==1){if(_type%100<10){c[randomPos[0]][randomPos[1]-1-_j]=_type-(_type%100-_type%10);handleMortHab();}else{// console.log(\"mort d'un pompier solo\")\n}}if(c[randomPos[0]][randomPos[1]-1-_j]==3||c[randomPos[0]][randomPos[1]-1-_j]==0){c[randomPos[0]][randomPos[1]-1-_j]=4;// console.log(\"break type\",randomPos[1]-1-j)\nbreak;}var _mur=getMursAutour([randomPos[0],randomPos[1]-1-_j])[3];// console.log(murs)\nif(mursInterdits.includes(_mur)){try{updateMurV([randomPos[0],randomPos[1]-_j-1],4);break;}catch(_unused6){}}_j-=1;}}if(randomPos[0]>0&&c[randomPos[0]-1][randomPos[1]]==4){// Propagation haut\n// console.log(\"propa haut\")\nvar i=1;while(randomPos[0]-1-i>=0){var _type2=c[randomPos[0]-1-i][randomPos[1]];if(Math.floor(_type2/10)==2){c[randomPos[0]-1-i][randomPos[1]]=4;handleMortHab();}if(Math.floor(_type2/1000)==1){if(_type2%100<10){c[randomPos[0]-1-i][randomPos[1]]=_type2-(_type2%100-_type2%10);handleMortHab();}else{// console.log(\"mort d'un pompier solo\")\n}}if(c[randomPos[0]-1-i][randomPos[1]]==3||c[randomPos[0]-1-i][randomPos[1]]==0){c[randomPos[0]-1-i][randomPos[1]]=4;// console.log(\"break type\",randomPos[1]-1-j)\nbreak;}var _mur2=getMursAutour([randomPos[0]-1-i,randomPos[1]])[0];// console.log(murs)\nif(mursInterdits.includes(_mur2)){try{updateMurH([randomPos[0]-1-i,randomPos[1]],4);break;}catch(_unused7){}}i-=1;}}if(randomPos[0]<nbLignesGrille-1&&c[randomPos[0]+1][randomPos[1]]==4){// Propagation bas\n// console.log(\"propa bas\")\nvar _i=0;while(randomPos[0]+1+_i>=0){var _type3=c[randomPos[0]+1+_i][randomPos[1]];if(Math.floor(_type3/10)==2){c[randomPos[0]+1+_i][randomPos[1]]=4;handleMortHab();}if(Math.floor(_type3/1000)==1){if(_type3%100<10){c[randomPos[0]+1+_i][randomPos[1]]=_type3-(_type3%100-_type3%10);handleMortHab();}else{// console.log(\"mort d'un pompier solo\")\n}}if(c[randomPos[0]+1+_i][randomPos[1]]==3||c[randomPos[0]+1+_i][randomPos[1]]==0){c[randomPos[0]+1+_i][randomPos[1]]=4;// console.log(\"break type\")\nbreak;}var _mur3=getMursAutour([randomPos[0]+1+_i,randomPos[1]])[2];if(mursInterdits.includes(_mur3)){try{updateMurH([randomPos[0]+2+_i,randomPos[1]],4);break;}catch(_unused8){}}_i+=1;}}return c;};var addFumToCarte=function addFumToCarte(randomPos){var c=_toConsumableArray(carte);if(carte!==null&&carte!==undefined&&carte.length>0&&randomPos!==null){// console.log(\"addFumToCarte\", randomPos[0], randomPos[1])\nswitch(c[randomPos[0]][randomPos[1]]){case 0:// VIDE\n// console.log(\"vide => fum\")\nc[randomPos[0]][randomPos[1]]=3;break;case 3:// FUMEE\n// console.log(\"fum => feu\")\nc[randomPos[0]][randomPos[1]]=4;break;case 4:// FEU\nc=handleExplosion(randomPos,c);// console.log(\"feu => explosion\")\nbreak;default:// console.log(\"error\")\nbreak;}}return c;};var embrasementFum=function embrasementFum(c){var modified=false;if(c!==null&&c!==undefined&&c.length>0){var mursInterdits=[1,2,3,5];var i=-1;var j=-1;while(i<nbLignesGrille-1){i=i+1;while(j<nbColonnesGrille-1){j=j+1;var mursCote=[mursH[i][j],mursV[i][j+1],mursH[i+1][j],mursV[i][j]];if(i<c.length&&j<c[0].length&&c[i][j]==4){// ON PARCOURT LES FEUX\nif(i>0&&c[i-1][j]==3&&!mursInterdits.includes(mursCote[0])){// juste dessus\nc[i-1][j]=4;modified=true;}if(j<nbColonnesGrille-1&&c[i][j+1]==3&&!mursInterdits.includes(mursCote[1])){// juste droite\nc[i][j+1]=4;modified=true;}if(i<nbLignesGrille-1&&c[i+1][j]==3&&!mursInterdits.includes(mursCote[2])){// juste dessous\nc[i+1][j]=4;modified=true;}else{}if(j>0&&c[i][j-1]==3&&!mursInterdits.includes(mursCote[3])){// GAUCHE\nc[i][j-1]=4;modified=true;}}}j=-1;}if(modified){embrasementFum(c);modified=false;}// console.log(mursCote)\n}else{// console.log(\"test\")\n}// console.log(\"embrasementFum\")\nreturn c;};var countHab=function countHab(carte){if(carte!=null&&carte.length>0){var count=0;carte.forEach(function(ligne,indexI){ligne.forEach(function(valeur,indexJ){if(Math.floor(valeur/10)==2){count+=1;}});});return count;}};var addHabitants=function addHabitants(c){var count=countHab(c);// console.log(count)\nfor(var i=0;i<configuration.nbHabitantsASauver.valeur-count;i++){var newPos=getRandomCoords([0,0],[nbLignesGrille,nbColonnesGrille]);c[newPos[0]][newPos[1]]=20+Math.round(Math.random());}// console.log(countHab(c))\nreturn c;};var evenementsAleatoire=function evenementsAleatoire(){var randomPos=getRandomCoords([0,0],[nbLignesGrille,nbColonnesGrille]);// const randomPos=[2,9]\nvar c=addFumToCarte(randomPos);c=embrasementFum(c);c=addHabitants(c);return c;};// const [tester,setTester]=useState(false)\n// useEffect(()=>{\n//   if(!tester && carte !== null && carte !== undefined && carte.length>0 && nbLignesGrille>0 && nbColonnesGrille>0){\n//     setTester(true)\n//     console.log([...carte])\n//     evenementsAleatoire()\n//   }\n// },[tester,carte,nbLignesGrille,nbColonnesGrille])\nvar _useState55=useState(null),_useState56=_slicedToArray(_useState55,2),textes=_useState56[0],setTextes=_useState56[1];useEffect(function(){var getTextes=/*#__PURE__*/function(){var _ref13=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee13(){var textes;return _regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:textes=ContentsAPI.getTexts(\"jeuTactInterface\").then(function(res){setTextes(res);});case 1:case\"end\":return _context13.stop();}}},_callee13);}));return function getTextes(){return _ref13.apply(this,arguments);};}();if(textes==null){getTextes();}// console.log(textes)\n},[textes]);var getText=function getText(name){if(textes==null){return name;}else{try{return textes[name].contenu;}catch(error){// console.log(textes)\nreturn name;}}};var renderAttenteLancement=function renderAttenteLancement(){return/*#__PURE__*/_jsxs(\"div\",{style:{color:\"gray\",textAlign:\"center\",fontSize:20},children:[/*#__PURE__*/_jsx(Typography,{children:getText('attenteLancement')}),/*#__PURE__*/_jsx(Typography,{children:getText('infoLancement')})]});};return/*#__PURE__*/_jsx(\"div\",{style:{position:\"absolute\",display:\"flex\",alignItems:\"center\",flexDirection:\"column\",justifyContent:\"center\",flex:1,width:\"100%\",height:\"100%\"},children:carte.length>0&&position!=null&&stocks!==null&&numPompier!==null&&play?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Grille,{nbColonnesGrille:nbColonnesGrille,nbLignesGrille:nbLignesGrille,carte:carte,position:position,mursH:mursH,mursV:mursV,propositionMursDetruire:propositionMursDetruire,propositionsCase:propositionsCase,handleClicMur:handleClicMur,handleClicCase:handleClicCase,handleChangePiece:handleChangePiece,deplacementEnCours:deplacementEnCours}),/*#__PURE__*/_jsx(TactBandeauTop,{stocks:stocks,resultats:resultats,numeroPompier:numPompier,sequence:currentSequence,cycle:currentCycle,tour:currentTour,pomp:currentPomp,configuration:configuration,budget:budget,budgetDepense:budgetDepense,equipe:equipe,handleClicValidated:handleClicValidated,play:play,chronoInit:chrono,numEquipe:equipe,numSession:session}),/*#__PURE__*/_jsx(TactBandeauBottom,{interventions:interventions,stocks:stocks,numeroPompier:numPompier,tour:currentTour,pomp:currentPomp,handleClicFleche:handleClicFleche,handleClicValidated:handleClicValidated,handleClicDoor:handleClicDoor,handleClicMarqueur:handleClicMarqueur,handleClicExt:handleClicExtincteur,handleNoClicked:handleNoClicked,handleClicHabitant:handleClicHabitant,btnClickedBottom:btnClickedBottom,mursAutour:getMursAutour(position),casesAutour:getCasesAutour(),currentCase:carte[position[0]][position[1]],histActions:histActions,configuration:configuration,deplacementEnCours:deplacementEnCours,budgetMaxAtteint:budgetDepense>=configuration.budgetTourMax.valeur,isLoading:false}),/*#__PURE__*/_jsx(TactBandeauDroite,{handleDisconnect:handleDisconnect,configuration:configuration})]}):renderAttenteLancement()});};export default TactInterface;// export default React.memo(TactInterface)","map":{"version":3,"sources":["C:/Users/hugod/decitude/client/src/routes/TactInterface.js"],"names":["React","useState","useEffect","useRef","PlayAPI","TactBandeauTop","TactBandeauBottom","Grille","useHistory","Typography","cookie","TactBandeauDroite","ContentsAPI","io","TactInterface","history","user","load","handleDisconnect","save","path","maxAge","push","undefined","role","includes","play","setPlay","replace","numPompier","setNumPompier","currentPomp","setCurrentPomp","currentTour","setCurrentTour","currentCycle","setCurrentCycle","currentSequence","setCurrentSequence","session","setSession","equipe","setEquipe","position","setPosition","type","rotation","deplacementEnCours","setDeplacementEnCours","histActions","setHistActions","chrono","setChrono","configuration","setConfiguration","stocks","setStocks","Decedes","Sauves","resultats","setResultats","Deplacement","Feu","FeuFum","Fum","Marqueur","Porte","Habitant","interventions","setInterventions","budget","setBudget","budgetDepense","setBudgetDepense","isLoading","carte","setCarte","nbLignesGrille","setNbLignesGrille","nbColonnesGrille","setNbColonnesGrille","mursH","setMursH","mursV","setMursV","getPlayState","setTimeout","current","currentPlayState","Object","keys","length","parseInt","JSON","parse","valeur","resultatsDecedes","resultatsSauves","getBudget","c","currrentChrono","chronoTourTact","console","log","getPositionFromCarte","getPlayParameters","getConfiguration","param","forEach","ligne","indexI","indexJ","Math","floor","updateCarte","coords","value","error","updateMurH","m","updateMurV","updateBudget","action","depenses","bd","addHistAction","h","stringify","retourAction","pop","state","doAction","s","i","updateResultats","sauve","res","setBtnClickedBottom","revealHabitant","relacherHabitant","inter","interKeys","min","onTourChange","e","preventDefault","modifyBudgetsFin","cycle","sequence","prochainPomp","prochainTour","prochainCycle","prochaineSequence","prochainChrono","getBudgetsPompFin","then","budgetsFin","b","index","numCycle","numSeq","equipements","saveBudgetsPompFin","newCarte","evenementsAleatoire","nouveauTour","socket","nouveauBudget","budgetInter","stocksEq","setSocket","connect","transports","on","data","err","message","test","deplacementAutorise","deplacement","dpl","dplInterditsCases","valeurCaseDeplacement","dplInterditsMurs","testRelacherHabitant","mursBloquants","casesAutour","getCasesAutour","dessus","resetHistAction","droite","dessous","gauche","cases","getMursAutour","murs","btnClickedBottom","propositionsCase","setPropositionsCase","propositionMursDetruire","setPropositionMursDetruire","handleClicCase","valeurAvant","valeurApres","coordX","coordY","handleClicMur","num","checkInCoords","numClic","cote","handleClicFleche","handleChangePiece","handleClicDoor","ouvrir","valueAvant","valueApres","handleClicExtincteur","listeCasesAction","handleClicMarqueur","mursADetruire","propositions","mursAutour","handleClicValidated","bool","nbPompEquipe","nbToursParCycle","chronoTourInter","nbCyclesParSequence","handleNoClicked","handleClicHabitant","valeurDessus","valeurDroite","valeurDessous","valeurGauche","getRandomCoords","mini","maxi","y","random","x","handleMortHab","r","handleExplosion","randomPos","val","valeurFin","mursInterdits","j","mur","addFumToCarte","embrasementFum","modified","mursCote","countHab","count","addHabitants","nbHabitantsASauver","newPos","round","textes","setTextes","getTextes","getTexts","getText","name","contenu","renderAttenteLancement","color","textAlign","fontSize","display","alignItems","flexDirection","justifyContent","flex","width","height","budgetTourMax"],"mappings":"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","sourcesContent":["import \"../styles/App.css\"\r\nimport React, { useState, useEffect, useRef } from 'react'\r\nimport PlayAPI from \"../API/PlayAPI\"\r\nimport TactBandeauTop from \"../components/interfaceJoueur/TactBandeauTop\"\r\nimport TactBandeauBottom from \"../components/interfaceJoueur/TactBandeauBottom\"\r\nimport Grille from \"../components/interfaceJoueur/Grille\"\r\nimport { useHistory } from 'react-router-dom';\r\nimport { Typography } from \"@material-ui/core\"\r\n\r\nimport cookie from 'react-cookies'\r\nimport TactBandeauDroite from \"../components/interfaceJoueur/TactBandeauDroite\"\r\nimport ContentsAPI from \"../API/ContentsAPI\"\r\nimport io from 'socket.io-client'\r\n\r\n\r\nconst TactInterface = () => {\r\n\r\n  const history = useHistory()\r\n  const user = cookie.load(\"user\")\r\n  const handleDisconnect = () => {\r\n    cookie.save('user', \"disconnected\", {\r\n      path: '/',\r\n      maxAge: 60 * 60 * 1.5, //sec\r\n    })\r\n    history.push('/login');\r\n  }\r\n\r\n  if (user === null || user === undefined || user == \"disconnected\") history.push(\"/login\");\r\n  if (user !== null && user !== undefined && user.role !== undefined && !user.role.includes(\"TACT\")) handleDisconnect()\r\n  const [play, setPlay] = useState(false)\r\n\r\n\r\n\r\n  const [numPompier, setNumPompier] = useState(user !== null && user !== undefined && user.role !== undefined ? user.role.replace(\"TACT\", \"\") : null)\r\n  const [currentPomp, setCurrentPomp] = useState(null)\r\n  const [currentTour, setCurrentTour] = useState(null)\r\n  const [currentCycle, setCurrentCycle] = useState(null)\r\n  const [currentSequence, setCurrentSequence] = useState(null)\r\n  const [session, setSession] = useState(user != null ? user.session : null)\r\n  const [equipe, setEquipe] = useState(user != null ? user.equipe : null)\r\n  const [position, setPosition] = useState(null)\r\n  const [deplacementEnCours, setDeplacementEnCours] = useState({\r\n    type: 0,\r\n    rotation: 1\r\n  })\r\n  const [histActions, setHistActions] = useState([])\r\n  const [chrono, setChrono] = useState(null)\r\n  useEffect(() => {\r\n    if (numPompier == null) handleDisconnect()\r\n  }, [numPompier])\r\n\r\n\r\n\r\n\r\n  const [configuration, setConfiguration] = useState(null)\r\n\r\n  const [stocks, setStocks] = useState(null)\r\n\r\n  const [resultats, setResultats] = useState({\r\n    Decedes: 0,\r\n    Sauves: 0\r\n  })\r\n\r\n  const [interventions, setInterventions] = useState({\r\n    Deplacement: 0,\r\n    Feu: 0,\r\n    FeuFum: 0,\r\n    Fum: 0,\r\n    Marqueur: 0,\r\n    Porte: 0,\r\n    Habitant: 0\r\n  })\r\n\r\n  const [budget, setBudget] = useState(0)\r\n  const [budgetDepense, setBudgetDepense] = useState(0)\r\n\r\n\r\n  const isLoading = useRef(false)\r\n\r\n  // INITIALISATION DE LA CARTE\r\n\r\n  // const [carte, setCarte] = useState([\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  //   [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],\r\n  // ])\r\n\r\n  const [carte, setCarte] = useState([])\r\n\r\n  const [nbLignesGrille, setNbLignesGrille] = useState(0)\r\n  const [nbColonnesGrille, setNbColonnesGrille] = useState(0)\r\n\r\n  const [mursH, setMursH] = useState([\r\n    [1, 1, 1, 1, 1, 1, 2, 6, 1, 1, 1, 1, 2, 5, 1, 1],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [1, 1, 1, 1, 2, 6, 1, 6, 2, 1, 1, 1, 5, 2, 1, 1],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0],\r\n    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\r\n    [1, 1, 1, 1, 1, 1, 6, 2, 1, 1, 1, 1, 1, 1, 1, 1]\r\n  ])\r\n\r\n  const [mursV, setMursV] = useState([\r\n    [1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],\r\n    [2, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],\r\n    [5, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],\r\n    [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1],\r\n    [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 2, 0, 0, 0, 0, 0, 1],\r\n    [1, 0, 0, 0, 0, 0, 2, 0, 0, 0, 5, 0, 0, 0, 0, 0, 1],\r\n    [1, 0, 0, 0, 0, 0, 5, 0, 0, 0, 5, 0, 0, 0, 0, 0, 2],\r\n    [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 2, 0, 0, 0, 0, 0, 5]\r\n  ])\r\n\r\n\r\n\r\n  // GET PLAY PARAMETERS \r\n  const getPlayState = async (session, equipe) => {\r\n    // console.log(\"get play state\")\r\n    setTimeout(async() => {\r\n      if (!isLoading.current) {\r\n        isLoading.current = true\r\n        const currentPlayState = await PlayAPI.getPlayState(session, equipe)\r\n        // console.log(currentPlayState)\r\n        if (Object.keys(currentPlayState).length > 0) {\r\n          // console.log(parseInt(JSON.parse(currentPlayState.currentTour.valeur)))\r\n  \r\n          setCurrentPomp(parseInt(JSON.parse(currentPlayState.currentPomp.valeur)))\r\n          setCurrentTour(parseInt(JSON.parse(currentPlayState.currentTour.valeur)))\r\n          setCurrentCycle(parseInt(JSON.parse(currentPlayState.currentCycle.valeur)))\r\n          setCurrentSequence(parseInt(JSON.parse(currentPlayState.currentSequence.valeur)))\r\n  \r\n          setMursH(JSON.parse(currentPlayState.mursH.valeur))\r\n          setMursV(JSON.parse(currentPlayState.mursV.valeur))\r\n          setCarte(JSON.parse(currentPlayState.carte.valeur))\r\n          setResultats({\r\n            Decedes: parseInt(JSON.parse(currentPlayState.resultatsDecedes.valeur)),\r\n            Sauves: parseInt(JSON.parse(currentPlayState.resultatsSauves.valeur)),\r\n          })\r\n          setPlay(JSON.parse(currentPlayState.play.valeur))\r\n          // if(parseInt(JSON.parse(currentPlayState.currentPomp.valeur))==1 && parseInt(JSON.parse(currentPlayState.currentTour.valeur))==1){\r\n          getBudget(parseInt(JSON.parse(currentPlayState.currentCycle.valeur)), parseInt(JSON.parse(currentPlayState.currentSequence.valeur)))\r\n          //  }\r\n          const c = parseInt(JSON.parse(currentPlayState.currrentChrono.valeur))\r\n          if (configuration !== null && c <= configuration.chronoTourTact.valeur && parseInt(JSON.parse(currentPlayState.currentPomp.valeur)) == numPompier) {\r\n            if(c==0){\r\n              setChrono(configuration.chronoTourTact.valeur)\r\n            }else{\r\n              setChrono(c)\r\n            }\r\n            \r\n            console.log(c)\r\n          } else {\r\n            setChrono(null)\r\n            console.log(c,configuration.chronoTourTact.valeur)\r\n          }\r\n        }\r\n        getPositionFromCarte(JSON.parse(currentPlayState.carte.valeur))\r\n        isLoading.current = false\r\n      }\r\n    }, numPompier*100);\r\n    \r\n\r\n  }\r\n\r\n\r\n  useEffect(() => {\r\n    // console.log(carte)\r\n    if (carte.length > 0) {\r\n      setNbLignesGrille(carte.length)\r\n      setNbColonnesGrille(carte[0].length)\r\n      getPositionFromCarte(carte)\r\n    }\r\n\r\n  }, [carte])\r\n\r\n  // useEffect(()=>{\r\n  //   console.log(currentTour)\r\n  // },[currentTour])\r\n\r\n\r\n  useEffect(() => {\r\n    if (session != null && equipe != null && currentTour == null) {\r\n      if (!isLoading.current && configuration !== null) getPlayState(session, equipe)\r\n      getPlayParameters()\r\n      getPositionFromCarte(carte)\r\n    }\r\n  }, [session, equipe, numPompier, configuration])\r\n\r\n  const getPlayParameters = async () => {\r\n    setTimeout(async() => {\r\n      const param = await PlayAPI.getConfiguration(session)\r\n      setConfiguration(param)\r\n    }, numPompier*100);\r\n    \r\n  }\r\n\r\n  const getPositionFromCarte = (carte) => {\r\n    if (carte != null && carte.length > 0) {\r\n      carte.forEach((ligne, indexI) => {\r\n        ligne.forEach((valeur, indexJ) => {\r\n\r\n          if (Math.floor(valeur / 1000) == 1 && Math.floor(valeur % 1000 / 100) == numPompier) {\r\n            setPosition([indexI, indexJ])\r\n            setDeplacementEnCours({\r\n              type: 0,\r\n              rotation: valeur % 10\r\n            })\r\n          }\r\n\r\n        })\r\n      });\r\n    }\r\n  }\r\n \r\n\r\n\r\n\r\n\r\n\r\n  // const onTextChange = (e) => {\r\n  //   setNumPompier(e.target.value)\r\n  //   console.log(typeof (e.target.value))\r\n  // }\r\n\r\n  // const onXChange = (e) => {\r\n  //   e.preventDefault()\r\n  //   if (e.target.value.length > 0) {\r\n  //     updateCarte(position, 0)\r\n  //     setPosition(position => [position[0], parseInt(e.target.value)])\r\n  //   } else {\r\n  //     updateCarte(position, 0)\r\n  //     setPosition(position => [position[0], 0])\r\n  //   }\r\n\r\n  // }\r\n  // const onYChange = (e) => {\r\n  //   e.preventDefault()\r\n  //   if (e.target.value.length > 0) {\r\n  //     updateCarte(position, 0)\r\n  //     setPosition(position => [parseInt(e.target.value), position[1]])\r\n  //   } else {\r\n  //     updateCarte(position, 0)\r\n  //     setPosition(position => [0, position[1]])\r\n  //   }\r\n  // }\r\n\r\n\r\n  // UPDATES\r\n  const updateCarte = (coords, value) => {\r\n    if (coords[0] < nbLignesGrille && coords[1] < nbColonnesGrille) {\r\n      try {\r\n        var c = [...carte]\r\n        c[coords[0]][coords[1]] = value\r\n        setCarte(c)\r\n      } catch (error) {\r\n        // console.log(error)\r\n      }\r\n    }\r\n\r\n\r\n  }\r\n  const updateMurH = (coords, value) => {\r\n    if (coords[0] < mursH.length && coords[1] < mursH[0].length) {\r\n      try {\r\n        var m = [...mursH]\r\n        m[coords[0]][coords[1]] = value\r\n        setMursH(m)\r\n\r\n      } catch (error) {\r\n        // console.log(error)\r\n      }\r\n    }\r\n  }\r\n  const updateMurV = (coords, value) => {\r\n    if (coords[0] < mursV.length && coords[1] < mursV[0].length) {\r\n      try {\r\n        var m = [...mursV]\r\n        m[coords[0]][coords[1]] = value\r\n        setMursV(m)\r\n      } catch (error) {\r\n        // console.log(error)\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  // ACTIONS\r\n\r\n  const updateBudget = (action) => {\r\n    var depenses = 0\r\n    if (configuration[\"coutEq\" + action] != null) depenses += configuration[\"coutEq\" + action].valeur\r\n    if (configuration[\"coutInter\" + action] != null) depenses += configuration[\"coutInter\" + action].valeur\r\n    setBudget(budget => budget - depenses)\r\n    setBudgetDepense(bd => bd + depenses)\r\n  }\r\n\r\n\r\n\r\n\r\n  const addHistAction = (budget, budgetDepense) => {\r\n    const h = [...histActions, {\r\n      carte: JSON.stringify(carte),\r\n      budget: JSON.stringify(budget),\r\n      budgetDepense: JSON.stringify(budgetDepense),\r\n      mursH: JSON.stringify(mursH),\r\n      mursV: JSON.stringify(mursV),\r\n      stocks: JSON.stringify(stocks),\r\n      resultats: JSON.stringify(resultats),\r\n      interventions: JSON.stringify(interventions),\r\n      deplacementEnCours: JSON.stringify({\r\n        type: 0,\r\n        rotation: deplacementEnCours.rotation\r\n      })\r\n    }]\r\n\r\n\r\n    setHistActions(h)\r\n  }\r\n\r\n  const retourAction = () => {\r\n    isLoading.current = true\r\n    var h = [...histActions]\r\n    h.pop()\r\n    const state = h[h.length - 1]\r\n\r\n\r\n    setCarte(JSON.parse(state.carte))\r\n    setMursH(JSON.parse(state.mursH))\r\n    setMursV(JSON.parse(state.mursV))\r\n    setStocks(JSON.parse(state.stocks))\r\n    setInterventions(JSON.parse(state.interventions))\r\n    setResultats(JSON.parse(state.resultats))\r\n    setBudget(JSON.parse(state.budget))\r\n    setBudgetDepense(JSON.parse(state.budgetDepense))\r\n\r\n    setDeplacementEnCours(JSON.parse(state.deplacementEnCours))\r\n    setHistActions(h)\r\n\r\n    isLoading.current = false\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (position !== null && stocks !== null && budget > 0 && deplacementEnCours.type == 0 && (histActions[histActions.length - 1] == undefined || budget < histActions[histActions.length - 1].budget)) {\r\n      addHistAction(budget, budgetDepense)\r\n    }\r\n  }, [deplacementEnCours, budgetDepense, stocks])\r\n\r\n  // useEffect(() => {\r\n  //   console.log(\"hist Actions\")\r\n  //   console.log(histActions)\r\n  // }, [histActions])\r\n\r\n  // useEffect(()=>{\r\n  //   if( position!==null && budget>0){\r\n\r\n  //     if(histActions[histActions.length-1]!==undefined && budget<histActions[histActions.length-1].budget ){\r\n\r\n  //       addHistAction(budget)\r\n  //     }\r\n  //   }\r\n  // },[budget])\r\n\r\n  const doAction = (action) => {\r\n    try {\r\n      if (Object.keys(stocks).includes(action)) {\r\n        var s = stocks\r\n        s[action] = s[action] - 1\r\n        setStocks(s)\r\n      }\r\n\r\n    } catch (error) { }\r\n\r\n    try {\r\n      if (Object.keys(interventions).includes(action)) {\r\n        var i = interventions\r\n        i[action] = i[action] - 1\r\n        setInterventions(i)\r\n      }\r\n    } catch (error) { }\r\n\r\n    // setTimeout(() => {\r\n    updateBudget(action)\r\n    // }, 1000);\r\n\r\n  }\r\n\r\n  const updateResultats = (sauve) => {\r\n    var res = { ...resultats }\r\n    if (sauve) {\r\n      res.Sauves += 1\r\n    } else {\r\n      res.Decedes += 1\r\n    }\r\n    // console.log(res)\r\n    setResultats(res)\r\n  }\r\n\r\n\r\n\r\n\r\n\r\n  useEffect(() => {\r\n    setBtnClickedBottom(null)\r\n    revealHabitant()\r\n  }, [position])\r\n\r\n\r\n  useEffect(() => {\r\n    if (carte.length > 0) relacherHabitant()\r\n\r\n  }, [position, mursH, mursV])\r\n\r\n\r\n\r\n\r\n  // useEffect(() => {\r\n  //   console.log(\"Stocks\")\r\n  //   console.log(stocks)\r\n  // }, [stocks])\r\n\r\n\r\n\r\n  useEffect(() => {\r\n    if (configuration != null) {\r\n      var inter = {...interventions}\r\n      const interKeys = Object.keys(inter)\r\n      // console.log(Math.floor(budget / configuration[\"coutInter\" + \"Habitant\"].valeur))\r\n      interKeys.forEach(action => {\r\n        try {\r\n          if (configuration[\"coutInter\" + action].valeur > 0) {\r\n            // if(action==\"Habitant\"){\r\n            //   console.log(stocks !== null && stocks[action] != null && stocks[action] != undefined && stocks[action] != \"NaN\" ? stocks[action] : 1000)\r\n            // }\r\n            inter[action] = Math.min(\r\n              configuration[\"coutEq\" + action] != null && configuration[\"coutEq\" + action] != undefined ? Math.floor(budget / (configuration[\"coutInter\" + action].valeur + configuration[\"coutEq\" + action].valeur)) : Math.floor(budget / configuration[\"coutInter\" + action].valeur),\r\n              stocks !== null && stocks[action] != null && stocks[action] != undefined && stocks[action] != \"NaN\" ? stocks[action] : 1000\r\n            )\r\n          }\r\n        } catch (error) {\r\n          // console.log(error, action)\r\n        }\r\n\r\n      })\r\n      console.log(inter)\r\n      setInterventions(inter)\r\n\r\n    } else {\r\n      // getPlayParameters()\r\n    }\r\n  }, [budget, configuration, numPompier, stocks])\r\n\r\n  // SOCKETS\r\n\r\n  // SOCKETS \r\n  const onTourChange = async (e) => {\r\n    e.preventDefault()\r\n    // console.log(\"nouveau tour todo\")\r\n  }\r\n\r\n  const modifyBudgetsFin = async (cycle, sequence,prochainPomp,prochainTour,prochainCycle,prochaineSequence,prochainChrono) => {\r\n    // console.log(\"budgets modified 0\")\r\n    setTimeout(async() => {\r\n      PlayAPI.getBudgetsPompFin(session, equipe).then(\r\n        (res) => {\r\n          console.log(res)\r\n          var budgetsFin = JSON.parse(res.valeur)\r\n  \r\n          try {\r\n            budgetsFin.interventions.forEach((b, index) => {\r\n              if (b.numCycle == cycle && b.numSeq == sequence) {\r\n  \r\n                budgetsFin[\"interventions\"][index][\"pomp\" + numPompier] = budget\r\n              }\r\n  \r\n            })\r\n          } catch (error) {\r\n  \r\n          }\r\n  \r\n          try {\r\n            budgetsFin.equipements.forEach((e, index) => {\r\n              if (e.numCycle == cycle && e.numSeq == sequence) {\r\n                budgetsFin[\"equipements\"][index][\"Feu\"][\"pomp\" + numPompier] = stocks.Feu\r\n                budgetsFin[\"equipements\"][index][\"FeuFum\"][\"pomp\" + numPompier] = stocks.FeuFum\r\n                budgetsFin[\"equipements\"][index][\"Fum\"][\"pomp\" + numPompier] = stocks.Fum\r\n                budgetsFin[\"equipements\"][index][\"Marqueur\"][\"pomp\" + numPompier] = stocks.Marqueur\r\n              }\r\n  \r\n            })\r\n          } catch (error) {\r\n  \r\n          }\r\n          // console.log(\"budgets modified 1\")\r\n          PlayAPI.saveBudgetsPompFin(budgetsFin, session, equipe).then(() => {\r\n            const newCarte = evenementsAleatoire()\r\n             PlayAPI.nouveauTour(socket, prochainPomp, newCarte, mursH, mursV, prochaineSequence, prochainCycle, prochainTour, resultats.Decedes, resultats.Sauves, session, equipe,prochainChrono )\r\n            // return budgetsFin\r\n          }\r\n  \r\n  \r\n          )\r\n        })\r\n    }, numPompier*100);\r\n    \r\n\r\n  }\r\n\r\n  const getBudget = async (cycle, sequence) => {\r\n    setTimeout(async() => {\r\n      var nouveauBudget = await PlayAPI.getBudgetsPompFin(session, equipe)\r\n    nouveauBudget = nouveauBudget.valeur\r\n    // console.log(nouveauBudget)\r\n    nouveauBudget = JSON.parse(nouveauBudget)\r\n\r\n    let budgetInter = 0\r\n    let stocksEq = stocks !== null && stocks !== undefined ? { ...stocks } : { Feu: 0, FeuFum: 0, Fum: 0, Marqueur: 0 }\r\n\r\n    try {\r\n      nouveauBudget.interventions.forEach((b) => {\r\n        if (b.numCycle == cycle && b.numSeq == sequence) {\r\n\r\n          budgetInter = b[\"pomp\" + numPompier]\r\n        }\r\n\r\n      })\r\n    } catch (error) {\r\n\r\n    }\r\n\r\n    try {\r\n      nouveauBudget.equipements.forEach((e) => {\r\n        if (e.numCycle == cycle && e.numSeq == sequence) {\r\n          stocksEq.Feu += e.Feu[\"pomp\" + numPompier]\r\n          stocksEq.FeuFum += e.FeuFum[\"pomp\" + numPompier]\r\n          stocksEq.Fum += e.Fum[\"pomp\" + numPompier]\r\n          stocksEq.Marqueur += e.Marqueur[\"pomp\" + numPompier]\r\n        }\r\n\r\n      })\r\n    } catch (error) {\r\n\r\n    }\r\n\r\n    // console.log(nouveauBudget)\r\n    if (budgetInter !== budget) {\r\n      setBudget(budgetInter)\r\n      setBudgetDepense(0)\r\n\r\n    }\r\n    setStocks(stocksEq)\r\n\r\n    }, numPompier*100);\r\n    \r\n\r\n  }\r\n\r\n  const [socket, setSocket] = useState(null)\r\n\r\n  // console.log(socket)\r\n  useEffect(() => {\r\n    if (socket === null && configuration !== null) {\r\n      const s = io.connect(\"https://www.back.leaders-extreme.fr\",\r\n      {\r\n        transports: ['websocket']\r\n      \r\n      })\r\n      \r\n\r\n\r\n      s.on('changementTour', (data) => {\r\n        if (currentPomp != data.currentPomp || currentCycle !== data.currentCycle || currentTour !== data.currentTour || currentSequence !== data.currentSequence) {\r\n          // console.log(\"changement tour\")\r\n          setTimeout(() => {\r\n            getPlayState(session, equipe)\r\n          }, numPompier*100);\r\n          \r\n        }\r\n      })\r\n\r\n      s.on(\"connect_error\", (err) => {\r\n        console.log(`connect_error due to ${err.message}`);\r\n      });\r\n     \r\n\r\n      // s.on('revealHabitant', (data) => {\r\n      //   if (carte !== null && carte.length > 0) {\r\n      //     // console.log(carte[data.y][data.x])\r\n      //     console.log(carte[data.y])\r\n      //     if (carte[data.y][data.x] == 20) {\r\n      //       // console.log([data.y,data.x])\r\n      //       updateCarte([data.y, data.x], data.type)\r\n      //       // console.log(\"socket hab\")\r\n      //       // console.log(data)\r\n      //     }\r\n      //   }\r\n      // })\r\n\r\n      s.on('startStopPartie', (data) => {\r\n        setTimeout(() => {\r\n          getPlayState(session, equipe)\r\n        }, numPompier*100);\r\n        \r\n      });\r\n      setSocket(s)\r\n    }\r\n\r\n\r\n\r\n  }, [socket, configuration]);\r\n\r\n\r\n\r\n  // TESTS\r\n\r\n  const test = async () => {\r\n\r\n    console.log(\"test function\")\r\n\r\n  }\r\n\r\n// useEffect(()=>{\r\n//   console.log(interventions,budget)\r\n// },[interventions,budget])\r\n\r\n\r\n  // AUTORISATIONS \r\n  const deplacementAutorise = (deplacement) => {\r\n    // return true\r\n    var dpl = [...deplacement]\r\n    if (dpl[0] == 0 && dpl[1] == 0) return false\r\n    if (position[0] + dpl[0] > carte.length - 1 || position[1] + dpl[1] > carte[0].length - 1 || position[0] + dpl[0] < 0 || position[1] + dpl[1] < 0) return false\r\n\r\n\r\n    const dplInterditsCases = [1000, 20, 3, 4]\r\n\r\n    try {\r\n      const valeurCaseDeplacement = carte[position[0] + dpl[0]][position[1] + dpl[1]]\r\n      if (Math.floor(valeurCaseDeplacement / 1000) == 1) return false\r\n      if (Math.floor(valeurCaseDeplacement / 10) == 2) return false\r\n      if (dplInterditsCases.includes(valeurCaseDeplacement)) return false\r\n    } catch (error) { }\r\n\r\n    const dplInterditsMurs = [1, 2, 3, 5]\r\n    try {\r\n      if (dpl[0] != 0) { // haut bas\r\n        if (dpl[0] < 0) {\r\n          dpl[0] = 0\r\n        }\r\n        if (typeof (mursH[position[0] + dpl[0]][position[1]]) === 'undefined') return false\r\n        if (dplInterditsMurs.includes(mursH[position[0] + dpl[0]][position[1]])) return false\r\n      } else { // gauche droite\r\n        if (dpl[1] < 0) {\r\n          dpl[1] = 0\r\n        }\r\n        if (typeof (mursV[position[0]][position[1] + dpl[1]]) === 'undefined') return false\r\n        if (dplInterditsMurs.includes(mursV[position[0]][position[1] + dpl[1]])) return false\r\n      }\r\n    } catch (error) { }\r\n\r\n\r\n\r\n\r\n    return true\r\n  }\r\n  const testRelacherHabitant = () => {\r\n    if (carte[position[0]][position[1]] % 100 < 10) return false // pas de transport d'habitant\r\n\r\n    const mursBloquants = [1, 2, 3, 5]\r\n\r\n    if (position[0] == 0 && !mursBloquants.includes(mursH[position[0]][position[1]])) return true // haut\r\n    if (position[0] == nbLignesGrille - 1 && !mursBloquants.includes(mursH[position[0] + 1][position[1]])) return true // bas\r\n\r\n    if (position[1] == 0 && !mursBloquants.includes(mursV[position[0]][position[1]])) return true // gauche\r\n    if (position[1] == nbColonnesGrille - 1 && !mursBloquants.includes(mursV[position[0]][position[1] + 1])) return true // droite\r\n\r\n    return false\r\n  }\r\n  const relacherHabitant = () => {\r\n    if (testRelacherHabitant()) {\r\n      setTimeout(() => {\r\n        updateResultats(true)\r\n        updateCarte(position, carte[position[0]][position[1]] - (carte[position[0]][position[1]] % 100 - carte[position[0]][position[1]] % 10))\r\n      }, 1000);\r\n    }\r\n  }\r\n\r\n  const revealHabitant = async () => {\r\n\r\n    if (configuration != null) {\r\n      const casesAutour = getCasesAutour()\r\n\r\n      try {\r\n        if (casesAutour.dessus == 20) {\r\n          updateCarte([position[0] - 1, position[1]], 0)\r\n          resetHistAction()\r\n          // const response = await PlayAPI.revealHabitant(socket, [position[0] - 1, position[1]], 0)\r\n        }\r\n      } catch (error) { }\r\n      try {\r\n        if (casesAutour.droite == 20) {\r\n          updateCarte([position[0], position[1] + 1], 0)\r\n          resetHistAction()\r\n          // const response = await PlayAPI.revealHabitant(socket, [position[0], position[1] + 1], 0)\r\n\r\n        }\r\n      } catch (error) { }\r\n      try {\r\n        if (casesAutour.dessous == 20) {\r\n          updateCarte([position[0] + 1, position[1]], 0)\r\n          resetHistAction()\r\n          // const response = await PlayAPI.revealHabitant(socket, [position[0] + 1, position[1]], 0)\r\n\r\n        }\r\n      } catch (error) { }\r\n      try {\r\n        if (casesAutour.gauche == 20) {\r\n          updateCarte([position[0], position[1] - 1], 0)\r\n          resetHistAction()\r\n          // const response = await PlayAPI.revealHabitant(socket, [position[0], position[1] - 1], 0)\r\n\r\n        }\r\n      } catch (error) { }\r\n\r\n    }\r\n\r\n  }\r\n\r\n  const getCasesAutour = () => {\r\n    var cases = {}\r\n\r\n    try {\r\n      cases[\"dessus\"] = (carte[position[0] - 1][position[1]]) // dessus\r\n    } catch (error) { }\r\n    try {\r\n      cases[\"droite\"] = (carte[position[0]][position[1] + 1]) // droite\r\n    } catch (error) { }\r\n    try {\r\n      cases[\"dessous\"] = (carte[position[0] + 1][position[1]]) // dessous\r\n    } catch (error) { }\r\n    try {\r\n      cases[\"gauche\"] = (carte[position[0]][position[1] - 1]) // gauche\r\n    } catch (error) { }\r\n    return cases\r\n  }\r\n  const getMursAutour = (position) => {\r\n    var murs = []\r\n\r\n    try {\r\n      if (mursH[position[0]][position[1]] != 4 || (mursH[position[0]][position[1] - 1] < 6 && mursH[position[0]][position[1] + 1] < 6)) {\r\n        murs.push(mursH[position[0]][position[1]]) // dessus\r\n      } else {\r\n        murs.push(0)\r\n      }\r\n    } catch (error) { }\r\n\r\n    try {\r\n      if (mursV[position[0]][position[1] + 1] != 4 || (mursV[position[0] - 1][position[1] + 1] < 6 && mursV[position[0] + 1][position[1] + 1] < 6)) {\r\n        murs.push(mursV[position[0]][position[1] + 1])  // droite\r\n      } else {\r\n        murs.push(0)\r\n      }\r\n    } catch (error) { }\r\n\r\n    try {\r\n      if (mursH[position[0] + 1][position[1]] != 4 || (mursH[position[0] + 1][position[1] - 1] < 6 && mursH[position[0] + 1][position[1] + 1] < 6)) {\r\n        murs.push(mursH[position[0] + 1][position[1]]) // dessous\r\n      } else {\r\n        murs.push(0)\r\n      }\r\n\r\n    } catch (error) { }\r\n    try {\r\n      if (mursV[position[0]][position[1]] != 4 || (mursV[position[0] - 1][position[1]] < 6 && mursV[position[0] + 1][position[1]] < 6)) {\r\n        murs.push(mursV[position[0]][position[1]])  // gauche\r\n      } else {\r\n        murs.push(0)\r\n      }\r\n    } catch (error) { }\r\n    // console.log(murs)\r\n    return murs\r\n  }\r\n\r\n  const resetHistAction = () => {\r\n    setTimeout(() => {\r\n      setHistActions([{\r\n        carte: JSON.stringify(carte),\r\n        budget: JSON.stringify(budget),\r\n        budgetDepense: JSON.stringify(budgetDepense),\r\n        mursH: JSON.stringify(mursH),\r\n        mursV: JSON.stringify(mursV),\r\n        stocks: JSON.stringify(stocks),\r\n        resultats: JSON.stringify(resultats),\r\n        interventions: JSON.stringify(interventions)\r\n      }])\r\n    }, 300);\r\n  }\r\n\r\n\r\n  const [btnClickedBottom, setBtnClickedBottom] = useState(null)\r\n  const [propositionsCase, setPropositionsCase] = useState([]) // Extincteurs\r\n  const [propositionMursDetruire, setPropositionMursDetruire] = useState([[], []]) // Horizontaux  , Verticaux\r\n  useEffect(() => {\r\n    if (btnClickedBottom != 3 || btnClickedBottom == null) {\r\n      setPropositionMursDetruire([[], []])\r\n    }\r\n    if ((btnClickedBottom > 2 && btnClickedBottom < 6) || btnClickedBottom == null) {\r\n      setPropositionsCase([])\r\n    }\r\n  }, [btnClickedBottom])\r\n\r\n\r\n\r\n\r\n  // HANDLERS CLIC GRILLE\r\n\r\n  const handleClicCase = (valeurAvant, valeurApres, coordX, coordY) => {\r\n    try {\r\n      updateCarte([coordY, coordX], valeurApres)\r\n      setPropositionsCase([])\r\n      setBtnClickedBottom(null)\r\n\r\n      if (valeurAvant == 4 && valeurApres == 0) { // Extincteur flamme\r\n        doAction(\"Feu\")\r\n      }\r\n      if (valeurAvant == 4 && valeurApres == 3) { // Feu Fumée\r\n        doAction(\"FeuFum\")\r\n      }\r\n      if (valeurAvant == 3 && valeurApres == 0) { // Fumée\r\n        doAction(\"Fum\")\r\n      }\r\n      if (Math.floor(valeurAvant / 10) == 2 && valeurApres == 0) { // Habitant\r\n        doAction(\"Habitant\")\r\n        // console.log(carte[position[0]][position[1]] + (valeurAvant % 10)*10)\r\n        updateCarte(position, carte[position[0]][position[1]] + (valeurAvant % 10)*10)\r\n      }\r\n    } catch (error) { }\r\n  }\r\n\r\n  const handleClicMur = (num, valeurAvant, coordX, coordY) => { // marqueur dégat\r\n    if (propositionMursDetruire[0].length > 0 || propositionMursDetruire[1].length > 0) {\r\n\r\n      const checkInCoords = (index) => {\r\n        // console.log(\"coordx\",coordX,\"coordy\",coordY,\"position\",position)\r\n\r\n        let numClic = null\r\n\r\n        if (coordX == position[1] && (coordY < position[0] || (coordY == position[0] && num == 0))) { // top\r\n          numClic = 0  // case en question\r\n          // console.log(\"top\",numClic)\r\n        }\r\n        if (coordX == position[1] && (coordY > position[0] || (coordY == position[0] && num == 2))) { // bottom\r\n          numClic = 2  // case en question\r\n          // console.log(\"bottom\",numClic)\r\n        }\r\n        if (coordY == position[0] && (coordX < position[1] || (coordX == position[1] && num == 3))) { // left\r\n          numClic = 3  // case en question\r\n          // console.log(\"left\",numClic)\r\n        }\r\n        if (coordY == position[0] && (coordX > position[1] || (coordX == position[1] && num == 1))) { // right\r\n          numClic = 1  // case en question\r\n          // console.log(\"right\",numClic)\r\n        }\r\n\r\n        return numClic\r\n      }\r\n\r\n      var cote = checkInCoords(num % 2)\r\n      let valeurApres = 4\r\n      if (valeurAvant == 1) valeurApres = 3\r\n\r\n      if (cote != null) {\r\n        try {\r\n          switch (cote) {\r\n            case 0:\r\n              updateMurH([position[0], position[1]], valeurApres)\r\n              // if(valeurAvant==5 ||)\r\n              break;\r\n            case 1:\r\n              updateMurV([position[0], position[1] + 1], valeurApres)\r\n              break;\r\n            case 2:\r\n              updateMurH([position[0] + 1, position[1]], valeurApres)\r\n              break;\r\n            case 3:\r\n              updateMurV([position[0], position[1]], valeurApres)\r\n              break;\r\n          }\r\n\r\n          doAction(\"Marqueur\")\r\n\r\n\r\n        } catch (error) {\r\n        }\r\n\r\n\r\n\r\n        setPropositionMursDetruire([[], []])\r\n        setBtnClickedBottom(null)\r\n      }\r\n\r\n    }\r\n\r\n  }\r\n\r\n\r\n\r\n  // HANDLER CLICS BOUTONS\r\n\r\n  const handleClicFleche = (num) => {\r\n    // Position y x\r\n    let deplacement\r\n    let rotation\r\n    switch (num) {\r\n      case 0: // haut\r\n        // console.log(\"haut\")\r\n        deplacement = [-1, 0]\r\n        rotation = 1\r\n        break;\r\n\r\n      case 1: // droite\r\n        // console.log(\"droite\")\r\n        deplacement = [0, 1]\r\n        rotation = 2\r\n        break;\r\n\r\n      case 2: // bas\r\n        // console.log(\"bas\")\r\n        deplacement = [1, 0]\r\n        rotation = 3\r\n        break;\r\n\r\n      case 3: // gauche\r\n        // console.log(\"gauche\")\r\n        deplacement = [0, -1]\r\n        rotation = 4\r\n        break;\r\n    }\r\n    if (deplacementAutorise(deplacement)) {\r\n\r\n      // ANIMATION MARCHE\r\n\r\n      setDeplacementEnCours({\r\n        type: 1,\r\n        rotation: rotation\r\n      })\r\n      setTimeout(() => {\r\n        updateCarte([position[0] + deplacement[0], position[1] + deplacement[1]], carte[position[0]][position[1]] - carte[position[0]][position[1]] % 10 + rotation)\r\n        // setPosition(position => [position[0] + deplacement[0], position[1] + deplacement[1]])\r\n        if((carte[position[0]][position[1]]%100 - carte[position[0]][position[1]]%10)/10>0){\r\n          doAction(\"DeplacementHab\")\r\n        }else{\r\n          doAction(\"Deplacement\")\r\n        }\r\n        \r\n        updateCarte(position, 0)\r\n\r\n\r\n        setDeplacementEnCours({\r\n          type: 2,\r\n          rotation: rotation\r\n        })\r\n        setTimeout(() => {\r\n          setDeplacementEnCours({\r\n            type: 0,\r\n            rotation: rotation\r\n          })\r\n        }, 500);\r\n\r\n      }, 500);\r\n\r\n\r\n    }\r\n  }\r\n\r\n  const handleChangePiece = () => {\r\n    resetHistAction()\r\n  }\r\n\r\n  const handleClicDoor = (ouvrir) => { // position, ouvert/fermé\r\n    setBtnClickedBottom(ouvrir ? 4 : 5)\r\n    let valueAvant\r\n    let valueApres\r\n\r\n    if (ouvrir) {\r\n      valueAvant = 5\r\n      valueApres = 6\r\n\r\n    } else {\r\n      valueAvant = 6\r\n      valueApres = 5\r\n    }\r\n    doAction(\"Porte\")\r\n    try {\r\n      if (mursH[position[0]][position[1]] == valueAvant) updateMurH([position[0], position[1]], valueApres)\r\n      if (mursH[position[0] + 1][position[1]] == valueAvant) updateMurH([position[0] + 1, position[1]], valueApres)\r\n      if (mursV[position[0]][position[1]] == valueAvant) updateMurV([position[0], position[1]], valueApres)\r\n      if (mursV[position[0]][position[1] + 1] == valueAvant) updateMurV([position[0], position[1] + 1], valueApres)\r\n    } catch (error) {\r\n\r\n    }\r\n  }\r\n\r\n  const handleClicExtincteur = (num) => {\r\n    // 0 FEU, 1 FEUFUM, 2 FUM\r\n    if (btnClickedBottom != num) {\r\n      var listeCasesAction = []\r\n      let valeurAvant = 4\r\n      let valeurApres = 0\r\n      setBtnClickedBottom(num)\r\n      switch (num) {\r\n        case 0: // ETEINDRE FEU\r\n          break;\r\n\r\n        case 1: // FEU FUM\r\n          valeurApres = 3\r\n          break;\r\n        case 2: // ETEINDRE FUMEE\r\n          valeurAvant = 3\r\n          break;\r\n      }\r\n\r\n      try {\r\n        if (carte[position[0] - 1][position[1]] == valeurAvant) listeCasesAction.push([position[0] - 1, position[1], valeurAvant, valeurApres]) // TOP\r\n      } catch (error) { }\r\n      try {\r\n        if (carte[position[0]][position[1] + 1] == valeurAvant) listeCasesAction.push([position[0], position[1] + 1, valeurAvant, valeurApres]) // RIGHT\r\n      } catch (error) { }\r\n      try {\r\n        if (carte[position[0] + 1][position[1]] == valeurAvant) listeCasesAction.push([position[0] + 1, position[1], valeurAvant, valeurApres]) // BOTTOM\r\n      } catch (error) { }\r\n      try {\r\n        if (carte[position[0]][position[1] - 1] == valeurAvant) listeCasesAction.push([position[0], position[1] - 1, valeurAvant, valeurApres]) // LEFT\r\n      } catch (error) { }\r\n\r\n      setPropositionsCase(listeCasesAction)\r\n    } else {\r\n      setBtnClickedBottom(null)\r\n    }\r\n\r\n  }\r\n\r\n  const handleClicMarqueur = () => {\r\n    if (btnClickedBottom != 3) {\r\n      setBtnClickedBottom(3)\r\n      if (propositionMursDetruire[0].length > 0 || propositionMursDetruire[1].length > 0) {\r\n        setPropositionMursDetruire([[], []])\r\n      } else {\r\n        const mursADetruire = [1, 3, 5, 6]\r\n        var propositions = [\r\n          [],\r\n          []\r\n        ]\r\n        const mursAutour = getMursAutour(position)\r\n\r\n        try {\r\n          if (mursADetruire.includes(mursAutour[0])) propositions[0].push([position[1], position[0]]) // top\r\n          if (mursADetruire.includes(mursAutour[1])) propositions[1].push([position[1] + 1, position[0]]) // right\r\n          if (mursADetruire.includes(mursAutour[2])) propositions[0].push([position[1], position[0] + 1]) // bottom\r\n          if (mursADetruire.includes(mursAutour[3])) propositions[1].push([position[1], position[0]]) // left\r\n\r\n        } catch (error) {\r\n\r\n        }\r\n        setPropositionMursDetruire(propositions)\r\n\r\n      }\r\n    } else {\r\n      setBtnClickedBottom(null)\r\n    }\r\n\r\n\r\n  }\r\n\r\n  const handleClicValidated = async (bool) => {\r\n    // console.log(\"handle Clic\")\r\n    if (configuration != null) {\r\n      if (bool) {\r\n\r\n\r\n        let prochainPomp = currentPomp + 1\r\n        let prochainTour = currentTour\r\n        let prochainCycle = currentCycle\r\n        let prochaineSequence = currentSequence\r\n        let prochainChrono = configuration.chronoTourTact.valeur\r\n\r\n\r\n        if (numPompier == configuration.nbPompEquipe.valeur) { // DERNIER POMP DU TOUR\r\n          if (currentTour == configuration.nbToursParCycle.valeur) { // SEND TO INTER\r\n            prochainTour = 1\r\n            prochainPomp = 0 // A CHANGER AVEC STRATEGIQUE\r\n\r\n            prochainChrono = configuration.chronoTourInter.valeur\r\n\r\n            if (prochainCycle == configuration.nbCyclesParSequence.valeur) {\r\n              prochainCycle = 1\r\n              prochaineSequence = prochaineSequence + 1\r\n            } else {\r\n              prochainCycle = prochainCycle + 1\r\n            }\r\n\r\n\r\n\r\n          } else { // PAS DERNIER TOUR DU CYCLE\r\n            // console.log(\"pas dernier tour\")\r\n            prochainPomp = 1\r\n            prochainTour = prochainTour + 1\r\n            // prochainChrono = configuration.chronoTourTact.valeur\r\n\r\n          }\r\n\r\n        }\r\n\r\n        // console.log(prochainPomp,prochainTour,prochainCycle)\r\n\r\n\r\n        \r\n        // console.log(\"budgets fin 1\")\r\n        const res = modifyBudgetsFin(currentCycle, currentSequence,prochainPomp,prochainTour,prochainCycle,prochaineSequence,prochainChrono)\r\n        \r\n        resetHistAction()\r\n\r\n        // setChrono(null)\r\n      } else {\r\n        retourAction()\r\n        console.log(\"retour\")\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  const handleNoClicked = () => {\r\n    setPropositionMursDetruire([[], []])\r\n    setPropositionsCase([])\r\n  }\r\n\r\n  const handleClicHabitant = () => {\r\n    if (btnClickedBottom != 6) {\r\n      setBtnClickedBottom(6)\r\n      const valeurApres = 0\r\n      var listeCasesAction = []\r\n      try {\r\n        const valeurDessus = carte[position[0] - 1][position[1]]\r\n        if (Math.floor(valeurDessus / 10) == 2) listeCasesAction.push([position[0] - 1, position[1], valeurDessus, valeurApres]) // TOP\r\n      } catch (error) { }\r\n      try {\r\n        const valeurDroite = carte[position[0]][position[1] + 1]\r\n        if (Math.floor(valeurDroite / 10) == 2) listeCasesAction.push([position[0], position[1] + 1, valeurDroite, valeurApres]) // RIGHT\r\n      } catch (error) { }\r\n      try {\r\n        const valeurDessous = carte[position[0] + 1][position[1]]\r\n        if (Math.floor(valeurDessous / 10) == 2) listeCasesAction.push([position[0] + 1, position[1], valeurDessous, valeurApres]) // BOTTOM\r\n      } catch (error) { }\r\n      try {\r\n        const valeurGauche = carte[position[0]][position[1] - 1]\r\n        if (Math.floor(valeurGauche / 10) == 2) listeCasesAction.push([position[0], position[1] - 1, valeurGauche, valeurApres]) // LEFT\r\n      } catch (error) { }\r\n\r\n      setPropositionsCase(listeCasesAction)\r\n\r\n\r\n      // console.log(\"handle clic habitant\")\r\n    } else {\r\n      setBtnClickedBottom(null)\r\n    }\r\n\r\n  }\r\n\r\n\r\n\r\n\r\n  const getRandomCoords = (mini, maxi) => {\r\n    if (carte !== null && carte !== undefined && carte.length > 0) {\r\n      var y = Math.floor(Math.random() * (maxi[0] - mini[0])) + mini[0]\r\n      var x = Math.floor(Math.random() * (maxi[1] - mini[1])) + mini[1]\r\n\r\n      var type = carte[y][x]\r\n      while (Math.floor(type / 1000) == 1 || Math.floor(type / 10) == 2) {\r\n        y = Math.floor(Math.random() * (maxi[0] - mini[0])) + mini[0]\r\n        x = Math.floor(Math.random() * (maxi[1] - mini[1])) + mini[1]\r\n        type = carte[y][x]\r\n      }\r\n      // console.log(\"getRandomCoords\", y, x)\r\n      return [y, x]\r\n    }\r\n    return null\r\n  }\r\n\r\n\r\n\r\n  const handleMortHab=()=>{\r\n    var r = {...resultats}\r\n    r.Decedes=r.Decedes+1\r\n    setResultats(r)\r\n    // console.log(\"mort d'un habitant\")\r\n    \r\n  }\r\n\r\n\r\n  const handleExplosion=(randomPos,c)=>{\r\n    const mursAutour = getMursAutour(randomPos)\r\n    // console.log(mursAutour)\r\n\r\n    // MARQUEURS SUR LA CASE QUI EXPLOSE\r\n    mursAutour.forEach((val,index)=>{\r\n      var valeurFin =val\r\n      if([3,5].includes(val)) valeurFin = 4 // DESTRUCTION TOTALE\r\n      if(valeurFin==1) valeurFin=3\r\n\r\n\r\n\r\n      if(valeurFin==3 || valeurFin==4){\r\n        switch (index) {\r\n          case 0:\r\n            try {\r\n              updateMurH([randomPos[0], randomPos[1]], valeurFin)\r\n            }catch{}\r\n            break;\r\n          case 1:\r\n            try {\r\n              updateMurV([randomPos[0], randomPos[1] + 1], valeurFin)\r\n            }catch{}\r\n            \r\n            break;\r\n          case 2:\r\n            try {\r\n              updateMurH([randomPos[0] + 1, randomPos[1]], valeurFin)\r\n            }catch{}\r\n           \r\n            break;\r\n          case 3:\r\n            try {\r\n              updateMurV([randomPos[0], randomPos[1]], valeurFin)\r\n            }catch{}\r\n            \r\n            break;\r\n        }\r\n      \r\n      }\r\n    })\r\n\r\n    // PROPAGATION DANS LES DIFFERENTES DIRECTIONS\r\n\r\n    const mursInterdits= [1,2,3,5]\r\n    if(randomPos[1]<nbColonnesGrille-1 && c[randomPos[0]][randomPos[1]+1]==4){ // Propagation droite\r\n      // console.log(\"propa droite\")\r\n      let j=1\r\n      while(randomPos[1]+1+j<nbColonnesGrille){\r\n        \r\n        const type = c[randomPos[0]][randomPos[1]+1+j]\r\n        if(Math.floor( type/ 10)==2){\r\n          c[randomPos[0]][randomPos[1]+1+j]=4\r\n          handleMortHab()\r\n        }\r\n\r\n        if(Math.floor(type / 1000) == 1){\r\n          if (type % 100 < 10){\r\n            c[randomPos[0]][randomPos[1]+1+j]=type - (type % 100 - type % 10)\r\n            handleMortHab()\r\n          }else{\r\n            // console.log(\"mort d'un pompier solo\")\r\n          }\r\n        } \r\n\r\n\r\n        if(c[randomPos[0]][randomPos[1]+1+j]==3 || c[randomPos[0]][randomPos[1]+1+j] ==0) {\r\n          c[randomPos[0]][randomPos[1]+1+j]=4\r\n          break\r\n        }\r\n        const mur = getMursAutour([randomPos[0],randomPos[1]+1+j])[1]\r\n        if(mursInterdits.includes(mur)) {\r\n            try {\r\n              updateMurV([randomPos[0], randomPos[1] + 2 +j], 4)\r\n              break\r\n            }catch{}\r\n          \r\n        }\r\n        j+=1\r\n        \r\n      }\r\n    }\r\n    if(randomPos[1]>0 && c[randomPos[0]][randomPos[1]-1]==4){ // Propagation gauche\r\n      // console.log(\"propa gauche\")\r\n      let j=1\r\n      while(randomPos[1]-1-j>=0){\r\n        \r\n        const type = c[randomPos[0]][randomPos[1]-1-j]\r\n        if(Math.floor( type/ 10)==2){\r\n          c[randomPos[0]][randomPos[1]-1-j]=4\r\n          handleMortHab()\r\n        }\r\n\r\n        if(Math.floor(type / 1000) == 1){\r\n          if (type % 100 < 10){\r\n            c[randomPos[0]][randomPos[1]-1-j]=type - (type % 100 - type % 10)\r\n            handleMortHab()\r\n          }else{\r\n            // console.log(\"mort d'un pompier solo\")\r\n          }\r\n        } \r\n\r\n\r\n        if(c[randomPos[0]][randomPos[1]-1-j]==3 || c[randomPos[0]][randomPos[1]-1-j] ==0) {\r\n          c[randomPos[0]][randomPos[1]-1-j]=4\r\n          // console.log(\"break type\",randomPos[1]-1-j)\r\n          break\r\n        }\r\n        const mur = getMursAutour([randomPos[0],randomPos[1]-1-j])[3]\r\n        // console.log(murs)\r\n        if(mursInterdits.includes(mur)) {\r\n            try {\r\n              updateMurV([randomPos[0], randomPos[1]-j-1], 4)\r\n              break\r\n            }catch{}\r\n          \r\n        }\r\n        j-=1\r\n        \r\n      }\r\n    }\r\n    if(randomPos[0]>0 && c[randomPos[0]-1][randomPos[1]]==4){ // Propagation haut\r\n      // console.log(\"propa haut\")\r\n      let i=1\r\n      while(randomPos[0]-1-i>=0){\r\n        \r\n        const type = c[randomPos[0]-1-i][randomPos[1]]\r\n        if(Math.floor( type/ 10)==2){\r\n          c[randomPos[0]-1-i][randomPos[1]]=4\r\n          handleMortHab()\r\n        }\r\n\r\n        if(Math.floor(type / 1000) == 1){\r\n          if (type % 100 < 10){\r\n            c[randomPos[0]-1-i][randomPos[1]]=type - (type % 100 - type % 10)\r\n            handleMortHab()\r\n          }else{\r\n            // console.log(\"mort d'un pompier solo\")\r\n          }\r\n        } \r\n\r\n\r\n        if(c[randomPos[0]-1-i][randomPos[1]]==3 || c[randomPos[0]-1-i][randomPos[1]] ==0) {\r\n          c[randomPos[0]-1-i][randomPos[1]]=4\r\n          // console.log(\"break type\",randomPos[1]-1-j)\r\n          break\r\n        }\r\n        const mur = getMursAutour([randomPos[0]-1-i,randomPos[1]])[0]\r\n        // console.log(murs)\r\n        if(mursInterdits.includes(mur)) {\r\n            try {\r\n              updateMurH([randomPos[0]-1-i,randomPos[1]], 4)\r\n              break\r\n            }catch{}\r\n          \r\n        }\r\n        i-=1\r\n        \r\n      }\r\n    }\r\n\r\n    if(randomPos[0]<nbLignesGrille-1 && c[randomPos[0]+1][randomPos[1]]==4){ // Propagation bas\r\n      // console.log(\"propa bas\")\r\n      let i=0\r\n      while(randomPos[0]+1+i>=0){\r\n        \r\n        const type = c[randomPos[0]+1+i][randomPos[1]]\r\n        if(Math.floor( type/ 10)==2){\r\n          c[randomPos[0]+1+i][randomPos[1]]=4\r\n          handleMortHab()\r\n        }\r\n\r\n        if(Math.floor(type / 1000) == 1){\r\n          if (type % 100 < 10){\r\n            c[randomPos[0]+1+i][randomPos[1]]=type - (type % 100 - type % 10)\r\n            handleMortHab()\r\n          }else{\r\n            // console.log(\"mort d'un pompier solo\")\r\n          }\r\n        } \r\n\r\n\r\n        if(c[randomPos[0]+1+i][randomPos[1]]==3 || c[randomPos[0]+1+i][randomPos[1]] ==0) {\r\n          c[randomPos[0]+1+i][randomPos[1]]=4\r\n          // console.log(\"break type\")\r\n\r\n          break\r\n        }\r\n        const mur = getMursAutour([randomPos[0]+1+i,randomPos[1]])[2]\r\n        if(mursInterdits.includes(mur)) {\r\n            try {\r\n              updateMurH([randomPos[0]+2+i,randomPos[1]], 4)\r\n              break\r\n            }catch{}\r\n          \r\n        }\r\n        i+=1\r\n        \r\n      }\r\n    }\r\n    return c\r\n\r\n  }\r\n\r\n  const addFumToCarte = (randomPos) => {\r\n\r\n    var c = [...carte]\r\n    if (carte !== null && carte !== undefined && carte.length > 0 && randomPos !== null) {\r\n      // console.log(\"addFumToCarte\", randomPos[0], randomPos[1])\r\n\r\n      switch (c[randomPos[0]][randomPos[1]]) {\r\n        case 0: // VIDE\r\n        // console.log(\"vide => fum\")\r\n          c[randomPos[0]][randomPos[1]] = 3\r\n          break;\r\n\r\n        case 3: // FUMEE\r\n        // console.log(\"fum => feu\")\r\n          c[randomPos[0]][randomPos[1]] = 4\r\n          break;\r\n\r\n        case 4: // FEU\r\n\r\n          c=handleExplosion(randomPos,c)\r\n\r\n          // console.log(\"feu => explosion\")\r\n          break;\r\n\r\n        default:\r\n          // console.log(\"error\")\r\n          break;\r\n      }\r\n    }\r\n    return c\r\n  }\r\n\r\n\r\n  const embrasementFum = (c) => {\r\n    var modified = false\r\n    if (c !== null && c !== undefined && c.length > 0) {\r\n      const mursInterdits = [1, 2, 3, 5]\r\n      var i = -1\r\n      var j = -1\r\n      \r\n      while (i < nbLignesGrille - 1 ) {\r\n        i = i + 1\r\n        while (j < nbColonnesGrille - 1 ) {\r\n          j = j + 1\r\n          const mursCote = [mursH[i][j], mursV[i][j + 1], mursH[i + 1][j], mursV[i][j]]\r\n\r\n          if (i < c.length && j < c[0].length && c[i][j] == 4) { // ON PARCOURT LES FEUX\r\n            if (i > 0 && c[i - 1][j] == 3 && !mursInterdits.includes(mursCote[0])) {// juste dessus\r\n              c[i - 1][j] = 4\r\n              modified = true\r\n            }\r\n            if (j < nbColonnesGrille - 1 && c[i][j + 1] == 3 && !mursInterdits.includes(mursCote[1])) { // juste droite\r\n              c[i][j + 1] = 4\r\n              modified = true\r\n            }\r\n            if (i < nbLignesGrille - 1 && c[i + 1][j] == 3 && !mursInterdits.includes(mursCote[2])) { // juste dessous\r\n              c[i + 1][j] = 4\r\n              modified = true\r\n            }else{\r\n              \r\n            }\r\n            if (j > 0 && c[i][j - 1] == 3 && !mursInterdits.includes(mursCote[3])) { // GAUCHE\r\n              c[i][j - 1] = 4 \r\n              modified = true\r\n            }\r\n            \r\n          }\r\n        }\r\n        j = -1\r\n      }\r\n\r\n      if(modified){\r\n          embrasementFum(c)\r\n        \r\n        modified = false\r\n      }\r\n\r\n\r\n\r\n\r\n      // console.log(mursCote)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n      \r\n    }else{\r\n      // console.log(\"test\")\r\n    }\r\n    // console.log(\"embrasementFum\")\r\n    return c\r\n  }\r\n  const countHab = (carte) => {\r\n    if (carte != null && carte.length > 0) {\r\n      var count = 0\r\n      carte.forEach((ligne, indexI) => {\r\n        ligne.forEach((valeur, indexJ) => {\r\n\r\n          if (Math.floor(valeur / 10) == 2) {\r\n            count+=1\r\n          }\r\n\r\n        })\r\n      });\r\n      return count\r\n    }\r\n   \r\n  }\r\n\r\n  const addHabitants=(c)=>{\r\n    const count = countHab(c)\r\n    // console.log(count)\r\n    for(let i=0;i<configuration.nbHabitantsASauver.valeur-count;i++){\r\n      const newPos = getRandomCoords([0, 0], [nbLignesGrille, nbColonnesGrille])\r\n      c[newPos[0]][newPos[1]]=20+Math.round(Math.random())\r\n    }\r\n    // console.log(countHab(c))\r\n    return c\r\n\r\n  }\r\n\r\n\r\n  const evenementsAleatoire = () => {\r\n    const randomPos = getRandomCoords([0, 0], [nbLignesGrille, nbColonnesGrille])\r\n    // const randomPos=[2,9]\r\n    var c = addFumToCarte(randomPos)\r\n    c = embrasementFum(c)\r\n    c = addHabitants(c)\r\n    return c\r\n  }\r\n\r\n\r\n  // const [tester,setTester]=useState(false)\r\n\r\n\r\n  // useEffect(()=>{\r\n  //   if(!tester && carte !== null && carte !== undefined && carte.length>0 && nbLignesGrille>0 && nbColonnesGrille>0){\r\n  //     setTester(true)\r\n  //     console.log([...carte])\r\n  //     evenementsAleatoire()\r\n      \r\n  //   }\r\n\r\n    \r\n  // },[tester,carte,nbLignesGrille,nbColonnesGrille])\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  const [textes, setTextes] = useState(null)\r\n\r\n  useEffect(() => {\r\n    const getTextes = async () => {\r\n      const textes = ContentsAPI.getTexts(\"jeuTactInterface\").then(\r\n        (res) => { setTextes(res) }\r\n      )\r\n    }\r\n    if (textes == null) {\r\n      getTextes()\r\n    }\r\n    // console.log(textes)\r\n  }, [textes])\r\n\r\n\r\n\r\n\r\n  const getText = (name) => {\r\n    if (textes == null) {\r\n      return name\r\n    } else {\r\n      try {\r\n        return textes[name].contenu\r\n      } catch (error) {\r\n        // console.log(textes)\r\n        return name\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  const renderAttenteLancement = () => {\r\n\r\n    return (\r\n      <div style={{ color: \"gray\", textAlign: \"center\", fontSize: 20 }}>\r\n        <Typography >{getText('attenteLancement')}</Typography>\r\n        <Typography >{getText('infoLancement')}</Typography>\r\n      </div>\r\n    )\r\n  }\r\n  \r\n  return (\r\n\r\n\r\n\r\n    <div style={{ position: \"absolute\", display: \"flex\", alignItems: \"center\", flexDirection: \"column\", justifyContent: \"center\", flex: 1, width: \"100%\", height: \"100%\" }}>\r\n\r\n      {\r\n        carte.length > 0 && position != null && stocks !== null && numPompier !== null && play ?\r\n          <>\r\n\r\n            <Grille\r\n              nbColonnesGrille={nbColonnesGrille}\r\n              nbLignesGrille={nbLignesGrille}\r\n              carte={carte}\r\n              position={position}\r\n              mursH={mursH}\r\n              mursV={mursV}\r\n              propositionMursDetruire={propositionMursDetruire}\r\n              propositionsCase={propositionsCase}\r\n              handleClicMur={handleClicMur}\r\n              handleClicCase={handleClicCase}\r\n              handleChangePiece={handleChangePiece}\r\n              deplacementEnCours={deplacementEnCours}\r\n\r\n            />\r\n\r\n            <TactBandeauTop\r\n              stocks={stocks}\r\n              resultats={resultats}\r\n              numeroPompier={numPompier}\r\n              sequence={currentSequence}\r\n              cycle={currentCycle}\r\n              tour={currentTour}\r\n              pomp={currentPomp}\r\n              configuration={configuration}\r\n              budget={budget}\r\n              budgetDepense={budgetDepense}\r\n              equipe={equipe}\r\n              handleClicValidated={handleClicValidated}\r\n              play={play}\r\n              chronoInit={chrono}\r\n              numEquipe={equipe}\r\n              numSession={session}\r\n            />\r\n\r\n            <TactBandeauBottom\r\n              interventions={interventions}\r\n              stocks={stocks}\r\n              numeroPompier={numPompier}\r\n              tour={currentTour}\r\n              pomp={currentPomp}\r\n              handleClicFleche={handleClicFleche}\r\n              handleClicValidated={handleClicValidated}\r\n              handleClicDoor={handleClicDoor}\r\n              handleClicMarqueur={handleClicMarqueur}\r\n              handleClicExt={handleClicExtincteur}\r\n              handleNoClicked={handleNoClicked}\r\n              handleClicHabitant={handleClicHabitant}\r\n              btnClickedBottom={btnClickedBottom}\r\n              mursAutour={getMursAutour(position)}\r\n              casesAutour={getCasesAutour()}\r\n              currentCase={carte[position[0]][position[1]]}\r\n              histActions={histActions}\r\n              configuration={configuration}\r\n              deplacementEnCours={deplacementEnCours}\r\n              budgetMaxAtteint={budgetDepense >= configuration.budgetTourMax.valeur}\r\n              isLoading={false}\r\n            />\r\n            <TactBandeauDroite\r\n              handleDisconnect={handleDisconnect}\r\n              configuration={configuration}\r\n            />\r\n          </>\r\n          :\r\n          renderAttenteLancement()\r\n\r\n      }\r\n    </div>\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  );\r\n\r\n}\r\n\r\nexport default TactInterface;\r\n\r\n\r\n// export default React.memo(TactInterface)"]},"metadata":{},"sourceType":"module"}